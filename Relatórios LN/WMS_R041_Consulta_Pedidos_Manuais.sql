SELECT 
    FILIAL.DSC_FILIAL                              FILIAL,
    cisli940.t$docn$l                              NF,
    cisli940.t$seri$l                              SERIE,

    NVL(WMS_OA_ORDERS_SH.ORDERKEY, 
        NVL(WMS_OA_ORDERS_OV.ORDERKEY, 
            WMS_OA_ORDERS_OA.ORDERKEY))            PEDIDO_WMS,

    NVL(WMS_OA_ORDERS_SH.REFERENCEDOCUMENT, 
        NVL(WMS_OA_ORDERS_OV.REFERENCEDOCUMENT, 
            WMS_OA_ORDERS_OA.REFERENCEDOCUMENT))   ORDEM_MOVIMENTACAO,
   
    NVL(CODELKUP_SH.DESCRIPTION, 
        NVL(CODELKUP_OV.DESCRIPTION, 
            CODELKUP_OA.DESCRIPTION))              DESCRICAO_PEDIDO,
   
    CAST((FROM_TZ(TO_TIMESTAMP(TO_CHAR(cisli940.t$date$l, 
      'DD-MON-YYYY HH24:MI:SS'), 'DD-MON-YYYY HH24:MI:SS'), 'GMT')
        AT time zone 'America/Sao_Paulo') AS DATE) DT_EMISSAO,
            
    cisli940.t$ccfo$l                              CFO,
    cisli940.t$opor$l                              SEQ_CFO,    
    tcmcs940.t$dsca$l                              NOME_CFO,
    znsls400.t$idca$c                              CANAL,
    TRIM(cisli941.t$item$l)                        ID_ITEM,
    tcibd001.t$dsca                                NOME_ITEM,
    sum(cisli941.t$dqua$l)                         QTD_FATURADA,
 
    CASE WHEN cisli941.t$iprt$l = 0 
           THEN round(tdsls401.t$pric,2) 
         ELSE   round(cisli941.t$pric$l,2)
     END                                           VL_PRODUTO,
  
    CASE WHEN sum(cisli941.t$amnt$l) = 0 
           THEN sum(tdsls401.t$oamt) 
         ELSE   sum(cisli941.t$amnt$l)
     END                                           VL_TOTAL_ITEM,
  
    CASE WHEN cisli941.t$gamt$l = 0 
           THEN round(tdsls401.t$pric,2) 
         ELSE   round(cisli941.t$gamt$l,2)
     END                                           VL_MERCADORIA,
  
    CASE WHEN sum(cisli941.t$fght$l) = 0 
           THEN sum(nvl(znsls401.t$vlfr$c,0)) 
         ELSE   sum(cisli941.t$fght$l)
     END                                           VL_FRETE,
 
    CASE WHEN sum(cisli941.t$ldam$l) = 0 
           THEN sum(nvl(znsls401.t$vlde$c,0)) 
         ELSE   sum(cisli941.t$ldam$l) 
     END                                           VL_DESC_INC,
    
    sum( NVL(( select sum(cisli943.t$amnt$l) 
                 from baandb.tcisli943301 cisli943
                where cisli943.t$fire$l = cisli941.t$fire$l
                  and cisli943.t$LINE$l = cisli941.t$LINE$l
                  and cisli943.t$brty$l = 1 ), 0) )VL_ICMS,
    
    sum( NVL(( select sum(cisli943.t$amnt$l) 
                 from baandb.tcisli943301 cisli943
                where cisli943.t$fire$l = cisli941.t$fire$l
                  and cisli943.t$line$l = cisli941.t$line$l
                  and cisli943.t$brty$l = 5 ), 0) )VL_PIS,
    
    sum( NVL(( select sum(cisli943.t$amnt$l) 
                 from baandb.tcisli943301 cisli943
                where cisli943.t$fire$l = cisli941.t$fire$l
                  and cisli943.t$line$l = cisli941.t$line$l
                  and cisli943.t$brty$l = 6 ), 0) )VL_COFINS,
       
    cisli940.t$itbp$l                              ID_CLIENTE,
    cisli940.t$itbn$l                              NOME_CLIENTE,
    tccom130.t$namc                                ENDERECO,
    tccom130.t$dist$l                              BAIRRO,
    tccom130.t$pstc                                CEP,
    tccom130.t$dsca                                MUNICIPIO,
    tccom130.t$cste                                UF,
    tccom130.t$telp                                TEL1,
    tccom130.t$telx                                TEL2,
    tccom130.t$enfs$l                              EMAIL,
    cisli940.t$fdtc$l                              ID_TIPO_DOC_FIS,
    tcmcs966.t$dsca$l                              DESCR_TIPO_DOC_FIS,
    FGET.DESC_TIPO_DOCTO                           DESC_TIPO_DOCTO,
    tccom130f.t$fovn$l                             CNPJ_FABRICANTE,
    tcmcs060.t$dsca                                NOME_FABRICANTE,
    Q1.CMV_UNIT
                             
FROM       baandb.tcisli940301 cisli940

INNER JOIN ( select tcemm030.t$eunt CHAVE_FILIAL,
                    tcemm030.t$dsca DSC_FILIAL,
                    tcemm124.t$cwoc
               from baandb.ttcemm124301 tcemm124, 
                    baandb.ttcemm030301 tcemm030
              where tcemm030.t$eunt = tcemm124.t$grid
                and tcemm124.t$loco = 301 ) FILIAL
        ON FILIAL.t$cwoc = cisli940.t$cofc$l 

 LEFT JOIN baandb.ttcmcs940301 tcmcs940 
        ON tcmcs940.T$OFSO$L = cisli940.t$ccfo$l

INNER JOIN baandb.tcisli941301 cisli941
        ON cisli941.t$fire$l = cisli940.t$fire$l
  
 LEFT JOIN ( select whwmd217.t$item,
                    whwmd217.t$cwar,
                    case when ( max(whwmd215.t$qhnd) - 
                                max(whwmd215.t$qchd) - 
                                max(whwmd215.t$qnhd) ) = 0 
                           then 0
                         else round(sum(whwmd217.t$mauc$1) /
                                   (max(whwmd215.t$qhnd) - max(whwmd215.t$qchd) - max(whwmd215.t$qnhd)), 4) 
                    end cmv_unit
               from baandb.twhwmd217301 whwmd217
         inner join baandb.twhwmd215301 whwmd215
                 on whwmd215.t$cwar = whwmd217.t$cwar
                and whwmd215.t$item = whwmd217.t$item
           group by whwmd217.t$item, whwmd217.t$cwar ) Q1
        ON Q1.t$item = cisli941.t$item$l 
       AND Q1.t$cwar = cisli941.t$cwar$l
  
INNER JOIN baandb.tcisli245301 cisli245
        ON cisli245.t$fire$l = cisli941.t$fire$l
       AND cisli245.t$line$l = cisli941.t$line$l

 LEFT JOIN baandb.tznsls401301 znsls401
        ON znsls401.t$orno$c = cisli245.t$slso
       AND znsls401.t$pono$c = cisli245.t$pono
    
 LEFT JOIN baandb.ttdsls401301 tdsls401 
        ON tdsls401.t$orno = cisli245.t$slso 
       AND tdsls401.t$pono = cisli245.t$pono 
        
 LEFT JOIN baandb.tznsls400301 znsls400
        ON znsls400.t$ncia$c = znsls401.t$ncia$c
       AND znsls400.t$uneg$c = znsls401.t$uneg$c
       AND znsls400.t$pecl$c = znsls401.t$pecl$c
       AND znsls400.t$sqpd$c = znsls401.t$sqpd$c
  
INNER JOIN baandb.ttccom130301 tccom130
        ON tccom130.t$cadr  = cisli940.t$itoa$l
  
INNER JOIN baandb.ttcibd001301 tcibd001
        ON tcibd001.t$item  = cisli941.t$item$l
  
 LEFT JOIN baandb.ttcmcs060301 tcmcs060
        ON tcmcs060.t$cmnf  = tcibd001.t$cmnf

 LEFT JOIN baandb.ttccom130301 tccom130f
        ON tccom130f.t$cadr  = tcmcs060.t$cadr  
  
 LEFT JOIN baandb.ttcmcs966301 tcmcs966
        ON tcmcs966.t$fdtc$l = cisli940.t$fdtc$l
  
 LEFT JOIN ( SELECT d.t$cnst CNST, l.t$desc DESC_TIPO_DOCTO
               FROM baandb.tttadv401000 d, 
                    baandb.tttadv140000 l 
              WHERE d.t$cpac = 'ci' 
                AND d.t$cdom = 'sli.tdff.l'
                AND l.t$clan = 'p'
                AND l.t$cpac = 'ci'
                AND l.t$clab = d.t$za_clab
                AND rpad(d.t$vers,4) ||
                    rpad(d.t$rele,2) ||
                    rpad(d.t$cust,4) = ( select max(rpad(l1.t$vers,4) ||
                                                    rpad(l1.t$rele,2) ||
                                                    rpad(l1.t$cust,4)) 
                                           from baandb.tttadv401000 l1 
                                          where l1.t$cpac = d.t$cpac 
                                            and l1.t$cdom = d.t$cdom )
                AND rpad(l.t$vers,4) ||
                    rpad(l.t$rele,2) ||
                    rpad(l.t$cust,4) = ( select max(rpad(l1.t$vers,4) ||
                                                    rpad(l1.t$rele,2) || 
                                                    rpad(l1.t$cust,4)) 
                                           from baandb.tttadv140000 l1 
                                          where l1.t$clab = l.t$clab 
                                            and l1.t$clan = l.t$clan 
                                            and l1.t$cpac = l.t$cpac ) ) FGET
        ON cisli940.t$fdty$l = FGET.CNST

     
 LEFT JOIN WMWHSE5.ORDERS@DL_LN_WMS WMS_OA_ORDERS_SH
        ON SUBSTR(WMS_OA_ORDERS_SH.EXTERNORDERKEY,5,9) = CISLI245.T$SHPM
               
 LEFT JOIN ( select MAX(a.ORDERKEY) ORDERKEY,
                    MAX(a.TYPE) TYPE,
                    a.REFERENCEDOCUMENT
               from WMWHSE5.ORDERS@DL_LN_WMS a 
             group by a.REFERENCEDOCUMENT ) WMS_OA_ORDERS_OA
        ON SUBSTR(WMS_OA_ORDERS_OA.REFERENCEDOCUMENT,4,9) = CISLI245.T$SLSO       
        
  LEFT JOIN ( select MAX(a.ORDERKEY) ORDERKEY,
                     MAX(a.TYPE) TYPE,
                     a.REFERENCEDOCUMENT
                from WMWHSE5.ORDERS@DL_LN_WMS a
            group by a.REFERENCEDOCUMENT ) WMS_OA_ORDERS_OV
         ON WMS_OA_ORDERS_OV.REFERENCEDOCUMENT = CISLI245.T$SLSO
        
 LEFT JOIN WMWHSE5.CODELKUP@DL_LN_WMS CODELKUP_SH
        ON CODELKUP_SH.LISTNAME = 'ORDERTYPE'
       AND CODELKUP_SH.CODE = WMS_OA_ORDERS_SH.TYPE
       
 LEFT JOIN WMWHSE5.CODELKUP@DL_LN_WMS CODELKUP_OA
        ON CODELKUP_OA.LISTNAME = 'ORDERTYPE'
       AND CODELKUP_OA.CODE = WMS_OA_ORDERS_OA.TYPE

 LEFT JOIN WMWHSE5.CODELKUP@DL_LN_WMS CODELKUP_OV
        ON CODELKUP_OV.LISTNAME = 'ORDERTYPE'
       AND CODELKUP_OV.CODE = WMS_OA_ORDERS_OV.TYPE
       
 LEFT JOIN baandb.tznsls000301 znsls000
        ON znsls000.t$indt$c = TO_DATE('01-01-1970','DD-MM-YYYY')
                 
WHERE cisli940.t$fdty$l != 11
  AND cisli940.t$docn$l != 0
  AND cisli940.t$stat$l NOT IN (2, 101)
  AND cisli941.t$item$l != znsls000.t$itmd$c
  AND cisli941.t$item$l != znsls000.t$itmf$c
  AND cisli941.t$item$l != znsls000.t$itjl$c
  AND cisli940.t$fdty$l != 14

  AND Trunc(CAST((FROM_TZ(TO_TIMESTAMP(TO_CHAR(cisli940.t$date$l, 
                'DD-MON-YYYY HH24:MI:SS'), 'DD-MON-YYYY HH24:MI:SS'), 'GMT')
                  AT time zone 'America/Sao_Paulo') AS DATE)) 
        Between :EmissaoDe
            And :EmissaoAte

GROUP BY FILIAL.DSC_FILIAL,
         cisli940.t$docn$l,                  
         cisli940.t$seri$l,                  
      NVL(WMS_OA_ORDERS_SH.ORDERKEY, 
             NVL(WMS_OA_ORDERS_OV.ORDERKEY, 
                 WMS_OA_ORDERS_OA.ORDERKEY)),
         
      NVL(WMS_OA_ORDERS_SH.REFERENCEDOCUMENT, 
             NVL(WMS_OA_ORDERS_OV.REFERENCEDOCUMENT, 
                 WMS_OA_ORDERS_OA.REFERENCEDOCUMENT)),
        
      NVL(CODELKUP_SH.DESCRIPTION, 
             NVL(CODELKUP_OV.DESCRIPTION, 
                 CODELKUP_OA.DESCRIPTION)),
         CAST((FROM_TZ(TO_TIMESTAMP(TO_CHAR(cisli940.t$date$l, 
           'DD-MON-YYYY HH24:MI:SS'), 'DD-MON-YYYY HH24:MI:SS'), 'GMT')
             AT time zone 'America/Sao_Paulo') AS DATE), 
         cisli940.t$ccfo$l,                  
         cisli940.t$opor$l,                  
         tcmcs940.t$dsca$l,                  
         znsls400.t$idca$c,                  
         TRIM(cisli941.t$item$l),            
         tcibd001.t$dsca ,                   
         CASE WHEN cisli941.t$iprt$l = 0 
                THEN round(tdsls401.t$pric,2) 
              ELSE   round(cisli941.t$pric$l,2)
          END,                               
         CASE WHEN cisli941.t$gamt$l = 0 
                THEN round(tdsls401.t$pric,2) 
              ELSE   round(cisli941.t$gamt$l,2)
          END,                               
         cisli940.t$itbp$l,                    
         cisli940.t$itbn$l,                    
         tccom130.t$namc,                      
         tccom130.t$dist$l,                    
         tccom130.t$pstc,                      
         tccom130.t$dsca,                      
         tccom130.t$cste,                      
         tccom130.t$telp,                      
         tccom130.t$telx,                      
         tccom130.t$enfs$l,                    
         cisli940.t$fdtc$l,                    
         tcmcs966.t$dsca$l,                    
         FGET.DESC_TIPO_DOCTO,                 
         tccom130f.t$fovn$l,               
         tcmcs060.t$dsca,
         Q1.CMV_UNIT
   
 ORDER BY FILIAL, 
          DT_EMISSAO, 
          NF

--B2C***************************************************************************************************************************************************
= IIF(Parameters!Table.Value <> "AAA", 

" SELECT FILIAL.DSC_FILIAL FILIAL, cisli940.t$docn$l NF, cisli940.t$seri$l SERIE, NVL(WMS_OA_ORDERS_SH.ORDERKEY, NVL(WMS_OA_ORDERS_OV.ORDERKEY, WMS_OA_ORDERS_OA.ORDERKEY)) PEDIDO_WMS, NVL(WMS_OA_ORDERS_SH.REFERENCEDOCUMENT, NVL(WMS_OA_ORDERS_OV.REFERENCEDOCUMENT, WMS_OA_ORDERS_OA.REFERENCEDOCUMENT)) ORDEM_MOVIMENTACAO, NVL(CODELKUP_SH.DESCRIPTION, NVL(CODELKUP_OV.DESCRIPTION, CODELKUP_OA.DESCRIPTION)) DESCRICAO_PEDIDO, CAST((FROM_TZ(TO_TIMESTAMP(TO_CHAR(cisli940.t$date$l, 'DD-MON-YYYY HH24:MI:SS'), 'DD-MON-YYYY HH24:MI:SS'), 'GMT') AT time zone 'America/Sao_Paulo') AS DATE) DT_EMISSAO, cisli940.t$ccfo$l CFO, cisli940.t$opor$l SEQ_CFO, tcmcs940.t$dsca$l NOME_CFO, znsls400.t$idca$c CANAL, TRIM(cisli941.t$item$l) ID_ITEM, tcibd001.t$dsca NOME_ITEM, sum(cisli941.t$dqua$l) QTD_FATURADA, CASE WHEN cisli941.t$iprt$l = 0 THEN round(tdsls401.t$pric,2) ELSE round(cisli941.t$pric$l,2) END VL_PRODUTO, CASE WHEN sum(cisli941.t$amnt$l) = 0 THEN sum(tdsls401.t$oamt) ELSE sum(cisli941.t$amnt$l) END VL_TOTAL_ITEM, CASE WHEN cisli941.t$gamt$l = 0 THEN round(tdsls401.t$pric,2) ELSE round(cisli941.t$gamt$l,2) END VL_MERCADORIA, CASE WHEN sum(cisli941.t$fght$l) = 0 THEN sum(nvl(znsls401.t$vlfr$c,0)) ELSE sum(cisli941.t$fght$l) END VL_FRETE, CASE WHEN sum(cisli941.t$ldam$l) = 0 THEN sum(nvl(znsls401.t$vlde$c,0)) ELSE sum(cisli941.t$ldam$l) END VL_DESC_INC, sum( NVL(( select sum(cisli943.t$amnt$l) from baandb.tcisli943301 cisli943 where cisli943.t$fire$l = cisli941.t$fire$l and cisli943.t$LINE$l = cisli941.t$LINE$l and cisli943.t$brty$l = 1 ), 0) )VL_ICMS, sum( NVL(( select sum(cisli943.t$amnt$l) from baandb.tcisli943301 cisli943 where cisli943.t$fire$l = cisli941.t$fire$l and cisli943.t$line$l = cisli941.t$line$l and cisli943.t$brty$l = 5 ), 0) )VL_PIS, sum( NVL(( select sum(cisli943.t$amnt$l) from baandb.tcisli943301 cisli943 where cisli943.t$fire$l = cisli941.t$fire$l and cisli943.t$line$l = cisli941.t$line$l and cisli943.t$brty$l = 6 ), 0) )VL_COFINS, cisli940.t$itbp$l ID_CLIENTE, cisli940.t$itbn$l NOME_CLIENTE, tccom130.t$namc ENDERECO, tccom130.t$dist$l BAIRRO, tccom130.t$pstc CEP, tccom130.t$dsca MUNICIPIO, tccom130.t$cste UF, tccom130.t$telp TEL1, tccom130.t$telx TEL2, tccom130.t$enfs$l EMAIL, cisli940.t$fdtc$l ID_TIPO_DOC_FIS, tcmcs966.t$dsca$l DESCR_TIPO_DOC_FIS, FGET.DESC_TIPO_DOCTO DESC_TIPO_DOCTO, tccom130f.t$fovn$l CNPJ_FABRICANTE, tcmcs060.t$dsca NOME_FABRICANTE, Q1.CMV_UNIT FROM baandb.tcisli940301 cisli940 INNER JOIN ( select tcemm030.t$eunt CHAVE_FILIAL, tcemm030.t$dsca DSC_FILIAL, tcemm124.t$cwoc from baandb.ttcemm124301 tcemm124, baandb.ttcemm030301 tcemm030 where tcemm030.t$eunt = tcemm124.t$grid and tcemm124.t$loco = 301 ) FILIAL ON FILIAL.t$cwoc = cisli940.t$cofc$l LEFT JOIN baandb.ttcmcs940301 tcmcs940 ON tcmcs940.T$OFSO$L = cisli940.t$ccfo$l INNER JOIN baandb.tcisli941301 cisli941 ON cisli941.t$fire$l = cisli940.t$fire$l LEFT JOIN ( select whwmd217.t$item, whwmd217.t$cwar, case when ( max(whwmd215.t$qhnd) - max(whwmd215.t$qchd) - max(whwmd215.t$qnhd) ) = 0 then 0 else round(sum(whwmd217.t$mauc$1) / (max(whwmd215.t$qhnd) - max(whwmd215.t$qchd) - max(whwmd215.t$qnhd)), 4) end CMV_UNIT from baandb.twhwmd217301 whwmd217 inner join baandb.twhwmd215301 whwmd215 on whwmd215.t$cwar = whwmd217.t$cwar and whwmd215.t$item = whwmd217.t$item group by whwmd217.t$item, whwmd217.t$cwar ) Q1 ON Q1.t$item = cisli941.t$item$l AND Q1.t$cwar = cisli941.t$cwar$l INNER JOIN baandb.tcisli245301 cisli245 ON cisli245.t$fire$l = cisli941.t$fire$l AND cisli245.t$line$l = cisli941.t$line$l LEFT JOIN baandb.tznsls401301 znsls401 ON znsls401.t$orno$c = cisli245.t$slso AND znsls401.t$pono$c = cisli245.t$pono LEFT JOIN baandb.ttdsls401301 tdsls401 ON tdsls401.t$orno = cisli245.t$slso AND tdsls401.t$pono = cisli245.t$pono LEFT JOIN baandb.tznsls400301 znsls400 ON znsls400.t$ncia$c = znsls401.t$ncia$c AND znsls400.t$uneg$c = znsls401.t$uneg$c AND znsls400.t$pecl$c = znsls401.t$pecl$c AND znsls400.t$sqpd$c = znsls401.t$sqpd$c INNER JOIN baandb.ttccom130301 tccom130 ON tccom130.t$cadr = cisli940.t$itoa$l INNER JOIN baandb.ttcibd001301 tcibd001 ON tcibd001.t$item = cisli941.t$item$l LEFT JOIN baandb.ttcmcs060301 tcmcs060 ON tcmcs060.t$cmnf = tcibd001.t$cmnf LEFT JOIN baandb.ttccom130301 tccom130f ON tccom130f.t$cadr = tcmcs060.t$cadr LEFT JOIN baandb.ttcmcs966301 tcmcs966 ON tcmcs966.t$fdtc$l = cisli940.t$fdtc$l LEFT JOIN ( SELECT d.t$cnst CNST, l.t$desc DESC_TIPO_DOCTO FROM baandb.tttadv401000 d, baandb.tttadv140000 l WHERE d.t$cpac = 'ci' AND d.t$cdom = 'sli.tdff.l' AND l.t$clan = 'p' AND l.t$cpac = 'ci' AND l.t$clab = d.t$za_clab AND rpad(d.t$vers,4) || rpad(d.t$rele,2) || rpad(d.t$cust,4) = ( select max(rpad(l1.t$vers,4) || rpad(l1.t$rele,2) || rpad(l1.t$cust,4)) from baandb.tttadv401000 l1 where l1.t$cpac = d.t$cpac and l1.t$cdom = d.t$cdom ) AND rpad(l.t$vers,4) || rpad(l.t$rele,2) || rpad(l.t$cust,4) = ( select max(rpad(l1.t$vers,4) || rpad(l1.t$rele,2) || rpad(l1.t$cust,4)) from baandb.tttadv140000 l1 where l1.t$clab = l.t$clab and l1.t$clan = l.t$clan and l1.t$cpac = l.t$cpac ) ) FGET ON cisli940.t$fdty$l = FGET.CNST LEFT JOIN " + Parameters!Table.Value + ".ORDERS@DL_LN_WMS WMS_OA_ORDERS_SH ON SUBSTR(WMS_OA_ORDERS_SH.EXTERNORDERKEY,5,9) = CISLI245.T$SHPM LEFT JOIN ( select MAX(a.ORDERKEY) ORDERKEY, MAX(a.TYPE) TYPE, a.REFERENCEDOCUMENT from " + Parameters!Table.Value + ".ORDERS@DL_LN_WMS a group by a.REFERENCEDOCUMENT ) WMS_OA_ORDERS_OA ON SUBSTR(WMS_OA_ORDERS_OA.REFERENCEDOCUMENT,4,9) = CISLI245.T$SLSO LEFT JOIN ( select MAX(a.ORDERKEY) ORDERKEY, MAX(a.TYPE) TYPE, a.REFERENCEDOCUMENT from " + Parameters!Table.Value + ".ORDERS@DL_LN_WMS a group by a.REFERENCEDOCUMENT ) WMS_OA_ORDERS_OV ON WMS_OA_ORDERS_OV.REFERENCEDOCUMENT = CISLI245.T$SLSO LEFT JOIN " + Parameters!Table.Value + ".CODELKUP@DL_LN_WMS CODELKUP_SH ON CODELKUP_SH.LISTNAME = 'ORDERTYPE' AND CODELKUP_SH.CODE = WMS_OA_ORDERS_SH.TYPE LEFT JOIN " + Parameters!Table.Value + ".CODELKUP@DL_LN_WMS CODELKUP_OA ON CODELKUP_OA.LISTNAME = 'ORDERTYPE' AND CODELKUP_OA.CODE = WMS_OA_ORDERS_OA.TYPE LEFT JOIN " + Parameters!Table.Value + ".CODELKUP@DL_LN_WMS CODELKUP_OV ON CODELKUP_OV.LISTNAME = 'ORDERTYPE' AND CODELKUP_OV.CODE = WMS_OA_ORDERS_OV.TYPE LEFT JOIN baandb.tznsls000301 znsls000 ON znsls000.t$indt$c = TO_DATE('01-01-1970','DD-MM-YYYY') WHERE cisli940.t$fdty$l != 11 AND cisli940.t$docn$l != 0 AND cisli940.t$stat$l NOT IN (2, 101) AND cisli941.t$item$l != znsls000.t$itmd$c AND cisli941.t$item$l != znsls000.t$itmf$c AND cisli941.t$item$l != znsls000.t$itjl$c AND cisli940.t$fdty$l != 14 AND Trunc(CAST((FROM_TZ(TO_TIMESTAMP(TO_CHAR(cisli940.t$date$l, 'DD-MON-YYYY HH24:MI:SS'), 'DD-MON-YYYY HH24:MI:SS'), 'GMT') AT time zone 'America/Sao_Paulo') AS DATE)) Between '" + Parameters!EmissaoDe.Value + "' AND '" + Parameters!EmissaoAte.Value + "' GROUP BY FILIAL.DSC_FILIAL, cisli940.t$docn$l, cisli940.t$seri$l, NVL(WMS_OA_ORDERS_SH.ORDERKEY, NVL(WMS_OA_ORDERS_OV.ORDERKEY, WMS_OA_ORDERS_OA.ORDERKEY)), NVL(WMS_OA_ORDERS_SH.REFERENCEDOCUMENT, NVL(WMS_OA_ORDERS_OV.REFERENCEDOCUMENT, WMS_OA_ORDERS_OA.REFERENCEDOCUMENT)), NVL(CODELKUP_SH.DESCRIPTION, NVL(CODELKUP_OV.DESCRIPTION, CODELKUP_OA.DESCRIPTION)), CAST((FROM_TZ(TO_TIMESTAMP(TO_CHAR(cisli940.t$date$l, 'DD-MON-YYYY HH24:MI:SS'), 'DD-MON-YYYY HH24:MI:SS'), 'GMT') AT time zone 'America/Sao_Paulo') AS DATE), cisli940.t$ccfo$l, cisli940.t$opor$l, tcmcs940.t$dsca$l, znsls400.t$idca$c, TRIM(cisli941.t$item$l), tcibd001.t$dsca , CASE WHEN cisli941.t$iprt$l = 0 THEN round(tdsls401.t$pric,2) ELSE round(cisli941.t$pric$l,2) END, CASE WHEN cisli941.t$gamt$l = 0 THEN round(tdsls401.t$pric,2) ELSE round(cisli941.t$gamt$l,2) END, cisli940.t$itbp$l, cisli940.t$itbn$l, tccom130.t$namc, tccom130.t$dist$l, tccom130.t$pstc, tccom130.t$dsca, tccom130.t$cste, tccom130.t$telp, tccom130.t$telx, tccom130.t$enfs$l, cisli940.t$fdtc$l, tcmcs966.t$dsca$l, FGET.DESC_TIPO_DOCTO, tccom130f.t$fovn$l, tcmcs060.t$dsca, Q1.CMV_UNIT ORDER BY FILIAL, DT_EMISSAO, NF  "

,
 
"       SELECT FILIAL.DSC_FILIAL FILIAL, cisli940.t$docn$l NF, cisli940.t$seri$l SERIE, NVL(WMS_OA_ORDERS_SH.ORDERKEY, NVL(WMS_OA_ORDERS_OV.ORDERKEY, WMS_OA_ORDERS_OA.ORDERKEY)) PEDIDO_WMS, NVL(WMS_OA_ORDERS_SH.REFERENCEDOCUMENT, NVL(WMS_OA_ORDERS_OV.REFERENCEDOCUMENT, WMS_OA_ORDERS_OA.REFERENCEDOCUMENT)) ORDEM_MOVIMENTACAO, NVL(CODELKUP_SH.DESCRIPTION, NVL(CODELKUP_OV.DESCRIPTION, CODELKUP_OA.DESCRIPTION)) DESCRICAO_PEDIDO, CAST((FROM_TZ(TO_TIMESTAMP(TO_CHAR(cisli940.t$date$l, 'DD-MON-YYYY HH24:MI:SS'), 'DD-MON-YYYY HH24:MI:SS'), 'GMT') AT time zone 'America/Sao_Paulo') AS DATE) DT_EMISSAO, cisli940.t$ccfo$l CFO, cisli940.t$opor$l SEQ_CFO, tcmcs940.t$dsca$l NOME_CFO, znsls400.t$idca$c CANAL, TRIM(cisli941.t$item$l) ID_ITEM, tcibd001.t$dsca NOME_ITEM, sum(cisli941.t$dqua$l) QTD_FATURADA, CASE WHEN cisli941.t$iprt$l = 0 THEN round(tdsls401.t$pric,2) ELSE round(cisli941.t$pric$l,2) END VL_PRODUTO, CASE WHEN sum(cisli941.t$amnt$l) = 0 THEN sum(tdsls401.t$oamt) ELSE sum(cisli941.t$amnt$l) END VL_TOTAL_ITEM, CASE WHEN cisli941.t$gamt$l = 0 THEN round(tdsls401.t$pric,2) ELSE round(cisli941.t$gamt$l,2) END VL_MERCADORIA, CASE WHEN sum(cisli941.t$fght$l) = 0 THEN sum(nvl(znsls401.t$vlfr$c,0)) ELSE sum(cisli941.t$fght$l) END VL_FRETE, CASE WHEN sum(cisli941.t$ldam$l) = 0 THEN sum(nvl(znsls401.t$vlde$c,0)) ELSE sum(cisli941.t$ldam$l) END VL_DESC_INC, sum( NVL(( select sum(cisli943.t$amnt$l) from baandb.tcisli943301 cisli943 where cisli943.t$fire$l = cisli941.t$fire$l and cisli943.t$LINE$l = cisli941.t$LINE$l and cisli943.t$brty$l = 1 ), 0) )VL_ICMS, sum( NVL(( select sum(cisli943.t$amnt$l) from baandb.tcisli943301 cisli943 where cisli943.t$fire$l = cisli941.t$fire$l and cisli943.t$line$l = cisli941.t$line$l and cisli943.t$brty$l = 5 ), 0) )VL_PIS, sum( NVL(( select sum(cisli943.t$amnt$l) from baandb.tcisli943301 cisli943 where cisli943.t$fire$l = cisli941.t$fire$l and cisli943.t$line$l = cisli941.t$line$l and cisli943.t$brty$l = 6 ), 0) )VL_COFINS, cisli940.t$itbp$l ID_CLIENTE, cisli940.t$itbn$l NOME_CLIENTE, tccom130.t$namc ENDERECO, tccom130.t$dist$l BAIRRO, tccom130.t$pstc CEP, tccom130.t$dsca MUNICIPIO, tccom130.t$cste UF, tccom130.t$telp TEL1, tccom130.t$telx TEL2, tccom130.t$enfs$l EMAIL, cisli940.t$fdtc$l ID_TIPO_DOC_FIS, tcmcs966.t$dsca$l DESCR_TIPO_DOC_FIS, FGET.DESC_TIPO_DOCTO DESC_TIPO_DOCTO, tccom130f.t$fovn$l CNPJ_FABRICANTE, tcmcs060.t$dsca NOME_FABRICANTE, Q1.CMV_UNIT FROM baandb.tcisli940301 cisli940 INNER JOIN ( select tcemm030.t$eunt CHAVE_FILIAL, tcemm030.t$dsca DSC_FILIAL, tcemm124.t$cwoc from baandb.ttcemm124301 tcemm124, baandb.ttcemm030301 tcemm030 where tcemm030.t$eunt = tcemm124.t$grid and tcemm124.t$loco = 301 ) FILIAL ON FILIAL.t$cwoc = cisli940.t$cofc$l LEFT JOIN baandb.ttcmcs940301 tcmcs940 ON tcmcs940.T$OFSO$L = cisli940.t$ccfo$l INNER JOIN baandb.tcisli941301 cisli941 ON cisli941.t$fire$l = cisli940.t$fire$l LEFT JOIN ( select whwmd217.t$item, whwmd217.t$cwar, case when ( max(whwmd215.t$qhnd) - max(whwmd215.t$qchd) - max(whwmd215.t$qnhd) ) = 0 then 0 else round(sum(whwmd217.t$mauc$1) / (max(whwmd215.t$qhnd) - max(whwmd215.t$qchd) - max(whwmd215.t$qnhd)), 4) end CMV_UNIT from baandb.twhwmd217301 whwmd217 inner join baandb.twhwmd215301 whwmd215 on whwmd215.t$cwar = whwmd217.t$cwar and whwmd215.t$item = whwmd217.t$item group by whwmd217.t$item, whwmd217.t$cwar ) Q1 ON Q1.t$item = cisli941.t$item$l AND Q1.t$cwar = cisli941.t$cwar$l INNER JOIN baandb.tcisli245301 cisli245 ON cisli245.t$fire$l = cisli941.t$fire$l AND cisli245.t$line$l = cisli941.t$line$l LEFT JOIN baandb.tznsls401301 znsls401 ON znsls401.t$orno$c = cisli245.t$slso AND znsls401.t$pono$c = cisli245.t$pono LEFT JOIN baandb.ttdsls401301 tdsls401 ON tdsls401.t$orno = cisli245.t$slso AND tdsls401.t$pono = cisli245.t$pono LEFT JOIN baandb.tznsls400301 znsls400 ON znsls400.t$ncia$c = znsls401.t$ncia$c AND znsls400.t$uneg$c = znsls401.t$uneg$c AND znsls400.t$pecl$c = znsls401.t$pecl$c AND znsls400.t$sqpd$c = znsls401.t$sqpd$c INNER JOIN baandb.ttccom130301 tccom130 ON tccom130.t$cadr = cisli940.t$itoa$l INNER JOIN baandb.ttcibd001301 tcibd001 ON tcibd001.t$item = cisli941.t$item$l LEFT JOIN baandb.ttcmcs060301 tcmcs060 ON tcmcs060.t$cmnf = tcibd001.t$cmnf LEFT JOIN baandb.ttccom130301 tccom130f ON tccom130f.t$cadr = tcmcs060.t$cadr LEFT JOIN baandb.ttcmcs966301 tcmcs966 ON tcmcs966.t$fdtc$l = cisli940.t$fdtc$l LEFT JOIN ( SELECT d.t$cnst CNST, l.t$desc DESC_TIPO_DOCTO FROM baandb.tttadv401000 d, baandb.tttadv140000 l WHERE d.t$cpac = 'ci' AND d.t$cdom = 'sli.tdff.l' AND l.t$clan = 'p' AND l.t$cpac = 'ci' AND l.t$clab = d.t$za_clab AND rpad(d.t$vers,4) || rpad(d.t$rele,2) || rpad(d.t$cust,4) = ( select max(rpad(l1.t$vers,4) || rpad(l1.t$rele,2) || rpad(l1.t$cust,4)) from baandb.tttadv401000 l1 where l1.t$cpac = d.t$cpac and l1.t$cdom = d.t$cdom ) AND rpad(l.t$vers,4) || rpad(l.t$rele,2) || rpad(l.t$cust,4) = ( select max(rpad(l1.t$vers,4) || rpad(l1.t$rele,2) || rpad(l1.t$cust,4)) from baandb.tttadv140000 l1 where l1.t$clab = l.t$clab and l1.t$clan = l.t$clan and l1.t$cpac = l.t$cpac ) ) FGET ON cisli940.t$fdty$l = FGET.CNST LEFT JOIN WMWHSE1.ORDERS@DL_LN_WMS WMS_OA_ORDERS_SH ON SUBSTR(WMS_OA_ORDERS_SH.EXTERNORDERKEY,5,9) = CISLI245.T$SHPM LEFT JOIN ( select MAX(a.ORDERKEY) ORDERKEY, MAX(a.TYPE) TYPE, a.REFERENCEDOCUMENT from WMWHSE1.ORDERS@DL_LN_WMS a group by a.REFERENCEDOCUMENT ) WMS_OA_ORDERS_OA ON SUBSTR(WMS_OA_ORDERS_OA.REFERENCEDOCUMENT,4,9) = CISLI245.T$SLSO LEFT JOIN ( select MAX(a.ORDERKEY) ORDERKEY, MAX(a.TYPE) TYPE, a.REFERENCEDOCUMENT from WMWHSE1.ORDERS@DL_LN_WMS a group by a.REFERENCEDOCUMENT ) WMS_OA_ORDERS_OV ON WMS_OA_ORDERS_OV.REFERENCEDOCUMENT = CISLI245.T$SLSO LEFT JOIN WMWHSE1.CODELKUP@DL_LN_WMS CODELKUP_SH ON CODELKUP_SH.LISTNAME = 'ORDERTYPE' AND CODELKUP_SH.CODE = WMS_OA_ORDERS_SH.TYPE LEFT JOIN WMWHSE1.CODELKUP@DL_LN_WMS CODELKUP_OA ON CODELKUP_OA.LISTNAME = 'ORDERTYPE' AND CODELKUP_OA.CODE = WMS_OA_ORDERS_OA.TYPE LEFT JOIN WMWHSE1.CODELKUP@DL_LN_WMS CODELKUP_OV ON CODELKUP_OV.LISTNAME = 'ORDERTYPE' AND CODELKUP_OV.CODE = WMS_OA_ORDERS_OV.TYPE LEFT JOIN baandb.tznsls000301 znsls000 ON znsls000.t$indt$c = TO_DATE('01-01-1970','DD-MM-YYYY') WHERE cisli940.t$fdty$l != 11 AND cisli940.t$docn$l != 0 AND cisli940.t$stat$l NOT IN (2, 101) AND cisli941.t$item$l != znsls000.t$itmd$c AND cisli941.t$item$l != znsls000.t$itmf$c AND cisli941.t$item$l != znsls000.t$itjl$c AND cisli940.t$fdty$l != 14 AND Trunc(CAST((FROM_TZ(TO_TIMESTAMP(TO_CHAR(cisli940.t$date$l, 'DD-MON-YYYY HH24:MI:SS'), 'DD-MON-YYYY HH24:MI:SS'), 'GMT') AT time zone 'America/Sao_Paulo') AS DATE)) Between '" + Parameters!EmissaoDe.Value + "' AND '" + Parameters!EmissaoAte.Value + "' GROUP BY FILIAL.DSC_FILIAL, cisli940.t$docn$l, cisli940.t$seri$l, NVL(WMS_OA_ORDERS_SH.ORDERKEY, NVL(WMS_OA_ORDERS_OV.ORDERKEY, WMS_OA_ORDERS_OA.ORDERKEY)), NVL(WMS_OA_ORDERS_SH.REFERENCEDOCUMENT, NVL(WMS_OA_ORDERS_OV.REFERENCEDOCUMENT, WMS_OA_ORDERS_OA.REFERENCEDOCUMENT)), NVL(CODELKUP_SH.DESCRIPTION, NVL(CODELKUP_OV.DESCRIPTION, CODELKUP_OA.DESCRIPTION)), CAST((FROM_TZ(TO_TIMESTAMP(TO_CHAR(cisli940.t$date$l, 'DD-MON-YYYY HH24:MI:SS'), 'DD-MON-YYYY HH24:MI:SS'), 'GMT') AT time zone 'America/Sao_Paulo') AS DATE), cisli940.t$ccfo$l, cisli940.t$opor$l, tcmcs940.t$dsca$l, znsls400.t$idca$c, TRIM(cisli941.t$item$l), tcibd001.t$dsca , CASE WHEN cisli941.t$iprt$l = 0 THEN round(tdsls401.t$pric,2) ELSE round(cisli941.t$pric$l,2) END, CASE WHEN cisli941.t$gamt$l = 0 THEN round(tdsls401.t$pric,2) ELSE round(cisli941.t$gamt$l,2) END, cisli940.t$itbp$l, cisli940.t$itbn$l, tccom130.t$namc, tccom130.t$dist$l, tccom130.t$pstc, tccom130.t$dsca, tccom130.t$cste, tccom130.t$telp, tccom130.t$telx, tccom130.t$enfs$l, cisli940.t$fdtc$l, tcmcs966.t$dsca$l, FGET.DESC_TIPO_DOCTO, tccom130f.t$fovn$l, tcmcs060.t$dsca, Q1.CMV_UNIT  " &
" Union SELECT FILIAL.DSC_FILIAL FILIAL, cisli940.t$docn$l NF, cisli940.t$seri$l SERIE, NVL(WMS_OA_ORDERS_SH.ORDERKEY, NVL(WMS_OA_ORDERS_OV.ORDERKEY, WMS_OA_ORDERS_OA.ORDERKEY)) PEDIDO_WMS, NVL(WMS_OA_ORDERS_SH.REFERENCEDOCUMENT, NVL(WMS_OA_ORDERS_OV.REFERENCEDOCUMENT, WMS_OA_ORDERS_OA.REFERENCEDOCUMENT)) ORDEM_MOVIMENTACAO, NVL(CODELKUP_SH.DESCRIPTION, NVL(CODELKUP_OV.DESCRIPTION, CODELKUP_OA.DESCRIPTION)) DESCRICAO_PEDIDO, CAST((FROM_TZ(TO_TIMESTAMP(TO_CHAR(cisli940.t$date$l, 'DD-MON-YYYY HH24:MI:SS'), 'DD-MON-YYYY HH24:MI:SS'), 'GMT') AT time zone 'America/Sao_Paulo') AS DATE) DT_EMISSAO, cisli940.t$ccfo$l CFO, cisli940.t$opor$l SEQ_CFO, tcmcs940.t$dsca$l NOME_CFO, znsls400.t$idca$c CANAL, TRIM(cisli941.t$item$l) ID_ITEM, tcibd001.t$dsca NOME_ITEM, sum(cisli941.t$dqua$l) QTD_FATURADA, CASE WHEN cisli941.t$iprt$l = 0 THEN round(tdsls401.t$pric,2) ELSE round(cisli941.t$pric$l,2) END VL_PRODUTO, CASE WHEN sum(cisli941.t$amnt$l) = 0 THEN sum(tdsls401.t$oamt) ELSE sum(cisli941.t$amnt$l) END VL_TOTAL_ITEM, CASE WHEN cisli941.t$gamt$l = 0 THEN round(tdsls401.t$pric,2) ELSE round(cisli941.t$gamt$l,2) END VL_MERCADORIA, CASE WHEN sum(cisli941.t$fght$l) = 0 THEN sum(nvl(znsls401.t$vlfr$c,0)) ELSE sum(cisli941.t$fght$l) END VL_FRETE, CASE WHEN sum(cisli941.t$ldam$l) = 0 THEN sum(nvl(znsls401.t$vlde$c,0)) ELSE sum(cisli941.t$ldam$l) END VL_DESC_INC, sum( NVL(( select sum(cisli943.t$amnt$l) from baandb.tcisli943301 cisli943 where cisli943.t$fire$l = cisli941.t$fire$l and cisli943.t$LINE$l = cisli941.t$LINE$l and cisli943.t$brty$l = 1 ), 0) )VL_ICMS, sum( NVL(( select sum(cisli943.t$amnt$l) from baandb.tcisli943301 cisli943 where cisli943.t$fire$l = cisli941.t$fire$l and cisli943.t$line$l = cisli941.t$line$l and cisli943.t$brty$l = 5 ), 0) )VL_PIS, sum( NVL(( select sum(cisli943.t$amnt$l) from baandb.tcisli943301 cisli943 where cisli943.t$fire$l = cisli941.t$fire$l and cisli943.t$line$l = cisli941.t$line$l and cisli943.t$brty$l = 6 ), 0) )VL_COFINS, cisli940.t$itbp$l ID_CLIENTE, cisli940.t$itbn$l NOME_CLIENTE, tccom130.t$namc ENDERECO, tccom130.t$dist$l BAIRRO, tccom130.t$pstc CEP, tccom130.t$dsca MUNICIPIO, tccom130.t$cste UF, tccom130.t$telp TEL1, tccom130.t$telx TEL2, tccom130.t$enfs$l EMAIL, cisli940.t$fdtc$l ID_TIPO_DOC_FIS, tcmcs966.t$dsca$l DESCR_TIPO_DOC_FIS, FGET.DESC_TIPO_DOCTO DESC_TIPO_DOCTO, tccom130f.t$fovn$l CNPJ_FABRICANTE, tcmcs060.t$dsca NOME_FABRICANTE, Q1.CMV_UNIT FROM baandb.tcisli940301 cisli940 INNER JOIN ( select tcemm030.t$eunt CHAVE_FILIAL, tcemm030.t$dsca DSC_FILIAL, tcemm124.t$cwoc from baandb.ttcemm124301 tcemm124, baandb.ttcemm030301 tcemm030 where tcemm030.t$eunt = tcemm124.t$grid and tcemm124.t$loco = 301 ) FILIAL ON FILIAL.t$cwoc = cisli940.t$cofc$l LEFT JOIN baandb.ttcmcs940301 tcmcs940 ON tcmcs940.T$OFSO$L = cisli940.t$ccfo$l INNER JOIN baandb.tcisli941301 cisli941 ON cisli941.t$fire$l = cisli940.t$fire$l LEFT JOIN ( select whwmd217.t$item, whwmd217.t$cwar, case when ( max(whwmd215.t$qhnd) - max(whwmd215.t$qchd) - max(whwmd215.t$qnhd) ) = 0 then 0 else round(sum(whwmd217.t$mauc$1) / (max(whwmd215.t$qhnd) - max(whwmd215.t$qchd) - max(whwmd215.t$qnhd)), 4) end CMV_UNIT from baandb.twhwmd217301 whwmd217 inner join baandb.twhwmd215301 whwmd215 on whwmd215.t$cwar = whwmd217.t$cwar and whwmd215.t$item = whwmd217.t$item group by whwmd217.t$item, whwmd217.t$cwar ) Q1 ON Q1.t$item = cisli941.t$item$l AND Q1.t$cwar = cisli941.t$cwar$l INNER JOIN baandb.tcisli245301 cisli245 ON cisli245.t$fire$l = cisli941.t$fire$l AND cisli245.t$line$l = cisli941.t$line$l LEFT JOIN baandb.tznsls401301 znsls401 ON znsls401.t$orno$c = cisli245.t$slso AND znsls401.t$pono$c = cisli245.t$pono LEFT JOIN baandb.ttdsls401301 tdsls401 ON tdsls401.t$orno = cisli245.t$slso AND tdsls401.t$pono = cisli245.t$pono LEFT JOIN baandb.tznsls400301 znsls400 ON znsls400.t$ncia$c = znsls401.t$ncia$c AND znsls400.t$uneg$c = znsls401.t$uneg$c AND znsls400.t$pecl$c = znsls401.t$pecl$c AND znsls400.t$sqpd$c = znsls401.t$sqpd$c INNER JOIN baandb.ttccom130301 tccom130 ON tccom130.t$cadr = cisli940.t$itoa$l INNER JOIN baandb.ttcibd001301 tcibd001 ON tcibd001.t$item = cisli941.t$item$l LEFT JOIN baandb.ttcmcs060301 tcmcs060 ON tcmcs060.t$cmnf = tcibd001.t$cmnf LEFT JOIN baandb.ttccom130301 tccom130f ON tccom130f.t$cadr = tcmcs060.t$cadr LEFT JOIN baandb.ttcmcs966301 tcmcs966 ON tcmcs966.t$fdtc$l = cisli940.t$fdtc$l LEFT JOIN ( SELECT d.t$cnst CNST, l.t$desc DESC_TIPO_DOCTO FROM baandb.tttadv401000 d, baandb.tttadv140000 l WHERE d.t$cpac = 'ci' AND d.t$cdom = 'sli.tdff.l' AND l.t$clan = 'p' AND l.t$cpac = 'ci' AND l.t$clab = d.t$za_clab AND rpad(d.t$vers,4) || rpad(d.t$rele,2) || rpad(d.t$cust,4) = ( select max(rpad(l1.t$vers,4) || rpad(l1.t$rele,2) || rpad(l1.t$cust,4)) from baandb.tttadv401000 l1 where l1.t$cpac = d.t$cpac and l1.t$cdom = d.t$cdom ) AND rpad(l.t$vers,4) || rpad(l.t$rele,2) || rpad(l.t$cust,4) = ( select max(rpad(l1.t$vers,4) || rpad(l1.t$rele,2) || rpad(l1.t$cust,4)) from baandb.tttadv140000 l1 where l1.t$clab = l.t$clab and l1.t$clan = l.t$clan and l1.t$cpac = l.t$cpac ) ) FGET ON cisli940.t$fdty$l = FGET.CNST LEFT JOIN WMWHSE2.ORDERS@DL_LN_WMS WMS_OA_ORDERS_SH ON SUBSTR(WMS_OA_ORDERS_SH.EXTERNORDERKEY,5,9) = CISLI245.T$SHPM LEFT JOIN ( select MAX(a.ORDERKEY) ORDERKEY, MAX(a.TYPE) TYPE, a.REFERENCEDOCUMENT from WMWHSE2.ORDERS@DL_LN_WMS a group by a.REFERENCEDOCUMENT ) WMS_OA_ORDERS_OA ON SUBSTR(WMS_OA_ORDERS_OA.REFERENCEDOCUMENT,4,9) = CISLI245.T$SLSO LEFT JOIN ( select MAX(a.ORDERKEY) ORDERKEY, MAX(a.TYPE) TYPE, a.REFERENCEDOCUMENT from WMWHSE2.ORDERS@DL_LN_WMS a group by a.REFERENCEDOCUMENT ) WMS_OA_ORDERS_OV ON WMS_OA_ORDERS_OV.REFERENCEDOCUMENT = CISLI245.T$SLSO LEFT JOIN WMWHSE2.CODELKUP@DL_LN_WMS CODELKUP_SH ON CODELKUP_SH.LISTNAME = 'ORDERTYPE' AND CODELKUP_SH.CODE = WMS_OA_ORDERS_SH.TYPE LEFT JOIN WMWHSE2.CODELKUP@DL_LN_WMS CODELKUP_OA ON CODELKUP_OA.LISTNAME = 'ORDERTYPE' AND CODELKUP_OA.CODE = WMS_OA_ORDERS_OA.TYPE LEFT JOIN WMWHSE2.CODELKUP@DL_LN_WMS CODELKUP_OV ON CODELKUP_OV.LISTNAME = 'ORDERTYPE' AND CODELKUP_OV.CODE = WMS_OA_ORDERS_OV.TYPE LEFT JOIN baandb.tznsls000301 znsls000 ON znsls000.t$indt$c = TO_DATE('01-01-1970','DD-MM-YYYY') WHERE cisli940.t$fdty$l != 11 AND cisli940.t$docn$l != 0 AND cisli940.t$stat$l NOT IN (2, 101) AND cisli941.t$item$l != znsls000.t$itmd$c AND cisli941.t$item$l != znsls000.t$itmf$c AND cisli941.t$item$l != znsls000.t$itjl$c AND cisli940.t$fdty$l != 14 AND Trunc(CAST((FROM_TZ(TO_TIMESTAMP(TO_CHAR(cisli940.t$date$l, 'DD-MON-YYYY HH24:MI:SS'), 'DD-MON-YYYY HH24:MI:SS'), 'GMT') AT time zone 'America/Sao_Paulo') AS DATE)) Between '" + Parameters!EmissaoDe.Value + "' AND '" + Parameters!EmissaoAte.Value + "' GROUP BY FILIAL.DSC_FILIAL, cisli940.t$docn$l, cisli940.t$seri$l, NVL(WMS_OA_ORDERS_SH.ORDERKEY, NVL(WMS_OA_ORDERS_OV.ORDERKEY, WMS_OA_ORDERS_OA.ORDERKEY)), NVL(WMS_OA_ORDERS_SH.REFERENCEDOCUMENT, NVL(WMS_OA_ORDERS_OV.REFERENCEDOCUMENT, WMS_OA_ORDERS_OA.REFERENCEDOCUMENT)), NVL(CODELKUP_SH.DESCRIPTION, NVL(CODELKUP_OV.DESCRIPTION, CODELKUP_OA.DESCRIPTION)), CAST((FROM_TZ(TO_TIMESTAMP(TO_CHAR(cisli940.t$date$l, 'DD-MON-YYYY HH24:MI:SS'), 'DD-MON-YYYY HH24:MI:SS'), 'GMT') AT time zone 'America/Sao_Paulo') AS DATE), cisli940.t$ccfo$l, cisli940.t$opor$l, tcmcs940.t$dsca$l, znsls400.t$idca$c, TRIM(cisli941.t$item$l), tcibd001.t$dsca , CASE WHEN cisli941.t$iprt$l = 0 THEN round(tdsls401.t$pric,2) ELSE round(cisli941.t$pric$l,2) END, CASE WHEN cisli941.t$gamt$l = 0 THEN round(tdsls401.t$pric,2) ELSE round(cisli941.t$gamt$l,2) END, cisli940.t$itbp$l, cisli940.t$itbn$l, tccom130.t$namc, tccom130.t$dist$l, tccom130.t$pstc, tccom130.t$dsca, tccom130.t$cste, tccom130.t$telp, tccom130.t$telx, tccom130.t$enfs$l, cisli940.t$fdtc$l, tcmcs966.t$dsca$l, FGET.DESC_TIPO_DOCTO, tccom130f.t$fovn$l, tcmcs060.t$dsca, Q1.CMV_UNIT  " &
" Union SELECT FILIAL.DSC_FILIAL FILIAL, cisli940.t$docn$l NF, cisli940.t$seri$l SERIE, NVL(WMS_OA_ORDERS_SH.ORDERKEY, NVL(WMS_OA_ORDERS_OV.ORDERKEY, WMS_OA_ORDERS_OA.ORDERKEY)) PEDIDO_WMS, NVL(WMS_OA_ORDERS_SH.REFERENCEDOCUMENT, NVL(WMS_OA_ORDERS_OV.REFERENCEDOCUMENT, WMS_OA_ORDERS_OA.REFERENCEDOCUMENT)) ORDEM_MOVIMENTACAO, NVL(CODELKUP_SH.DESCRIPTION, NVL(CODELKUP_OV.DESCRIPTION, CODELKUP_OA.DESCRIPTION)) DESCRICAO_PEDIDO, CAST((FROM_TZ(TO_TIMESTAMP(TO_CHAR(cisli940.t$date$l, 'DD-MON-YYYY HH24:MI:SS'), 'DD-MON-YYYY HH24:MI:SS'), 'GMT') AT time zone 'America/Sao_Paulo') AS DATE) DT_EMISSAO, cisli940.t$ccfo$l CFO, cisli940.t$opor$l SEQ_CFO, tcmcs940.t$dsca$l NOME_CFO, znsls400.t$idca$c CANAL, TRIM(cisli941.t$item$l) ID_ITEM, tcibd001.t$dsca NOME_ITEM, sum(cisli941.t$dqua$l) QTD_FATURADA, CASE WHEN cisli941.t$iprt$l = 0 THEN round(tdsls401.t$pric,2) ELSE round(cisli941.t$pric$l,2) END VL_PRODUTO, CASE WHEN sum(cisli941.t$amnt$l) = 0 THEN sum(tdsls401.t$oamt) ELSE sum(cisli941.t$amnt$l) END VL_TOTAL_ITEM, CASE WHEN cisli941.t$gamt$l = 0 THEN round(tdsls401.t$pric,2) ELSE round(cisli941.t$gamt$l,2) END VL_MERCADORIA, CASE WHEN sum(cisli941.t$fght$l) = 0 THEN sum(nvl(znsls401.t$vlfr$c,0)) ELSE sum(cisli941.t$fght$l) END VL_FRETE, CASE WHEN sum(cisli941.t$ldam$l) = 0 THEN sum(nvl(znsls401.t$vlde$c,0)) ELSE sum(cisli941.t$ldam$l) END VL_DESC_INC, sum( NVL(( select sum(cisli943.t$amnt$l) from baandb.tcisli943301 cisli943 where cisli943.t$fire$l = cisli941.t$fire$l and cisli943.t$LINE$l = cisli941.t$LINE$l and cisli943.t$brty$l = 1 ), 0) )VL_ICMS, sum( NVL(( select sum(cisli943.t$amnt$l) from baandb.tcisli943301 cisli943 where cisli943.t$fire$l = cisli941.t$fire$l and cisli943.t$line$l = cisli941.t$line$l and cisli943.t$brty$l = 5 ), 0) )VL_PIS, sum( NVL(( select sum(cisli943.t$amnt$l) from baandb.tcisli943301 cisli943 where cisli943.t$fire$l = cisli941.t$fire$l and cisli943.t$line$l = cisli941.t$line$l and cisli943.t$brty$l = 6 ), 0) )VL_COFINS, cisli940.t$itbp$l ID_CLIENTE, cisli940.t$itbn$l NOME_CLIENTE, tccom130.t$namc ENDERECO, tccom130.t$dist$l BAIRRO, tccom130.t$pstc CEP, tccom130.t$dsca MUNICIPIO, tccom130.t$cste UF, tccom130.t$telp TEL1, tccom130.t$telx TEL2, tccom130.t$enfs$l EMAIL, cisli940.t$fdtc$l ID_TIPO_DOC_FIS, tcmcs966.t$dsca$l DESCR_TIPO_DOC_FIS, FGET.DESC_TIPO_DOCTO DESC_TIPO_DOCTO, tccom130f.t$fovn$l CNPJ_FABRICANTE, tcmcs060.t$dsca NOME_FABRICANTE, Q1.CMV_UNIT FROM baandb.tcisli940301 cisli940 INNER JOIN ( select tcemm030.t$eunt CHAVE_FILIAL, tcemm030.t$dsca DSC_FILIAL, tcemm124.t$cwoc from baandb.ttcemm124301 tcemm124, baandb.ttcemm030301 tcemm030 where tcemm030.t$eunt = tcemm124.t$grid and tcemm124.t$loco = 301 ) FILIAL ON FILIAL.t$cwoc = cisli940.t$cofc$l LEFT JOIN baandb.ttcmcs940301 tcmcs940 ON tcmcs940.T$OFSO$L = cisli940.t$ccfo$l INNER JOIN baandb.tcisli941301 cisli941 ON cisli941.t$fire$l = cisli940.t$fire$l LEFT JOIN ( select whwmd217.t$item, whwmd217.t$cwar, case when ( max(whwmd215.t$qhnd) - max(whwmd215.t$qchd) - max(whwmd215.t$qnhd) ) = 0 then 0 else round(sum(whwmd217.t$mauc$1) / (max(whwmd215.t$qhnd) - max(whwmd215.t$qchd) - max(whwmd215.t$qnhd)), 4) end CMV_UNIT from baandb.twhwmd217301 whwmd217 inner join baandb.twhwmd215301 whwmd215 on whwmd215.t$cwar = whwmd217.t$cwar and whwmd215.t$item = whwmd217.t$item group by whwmd217.t$item, whwmd217.t$cwar ) Q1 ON Q1.t$item = cisli941.t$item$l AND Q1.t$cwar = cisli941.t$cwar$l INNER JOIN baandb.tcisli245301 cisli245 ON cisli245.t$fire$l = cisli941.t$fire$l AND cisli245.t$line$l = cisli941.t$line$l LEFT JOIN baandb.tznsls401301 znsls401 ON znsls401.t$orno$c = cisli245.t$slso AND znsls401.t$pono$c = cisli245.t$pono LEFT JOIN baandb.ttdsls401301 tdsls401 ON tdsls401.t$orno = cisli245.t$slso AND tdsls401.t$pono = cisli245.t$pono LEFT JOIN baandb.tznsls400301 znsls400 ON znsls400.t$ncia$c = znsls401.t$ncia$c AND znsls400.t$uneg$c = znsls401.t$uneg$c AND znsls400.t$pecl$c = znsls401.t$pecl$c AND znsls400.t$sqpd$c = znsls401.t$sqpd$c INNER JOIN baandb.ttccom130301 tccom130 ON tccom130.t$cadr = cisli940.t$itoa$l INNER JOIN baandb.ttcibd001301 tcibd001 ON tcibd001.t$item = cisli941.t$item$l LEFT JOIN baandb.ttcmcs060301 tcmcs060 ON tcmcs060.t$cmnf = tcibd001.t$cmnf LEFT JOIN baandb.ttccom130301 tccom130f ON tccom130f.t$cadr = tcmcs060.t$cadr LEFT JOIN baandb.ttcmcs966301 tcmcs966 ON tcmcs966.t$fdtc$l = cisli940.t$fdtc$l LEFT JOIN ( SELECT d.t$cnst CNST, l.t$desc DESC_TIPO_DOCTO FROM baandb.tttadv401000 d, baandb.tttadv140000 l WHERE d.t$cpac = 'ci' AND d.t$cdom = 'sli.tdff.l' AND l.t$clan = 'p' AND l.t$cpac = 'ci' AND l.t$clab = d.t$za_clab AND rpad(d.t$vers,4) || rpad(d.t$rele,2) || rpad(d.t$cust,4) = ( select max(rpad(l1.t$vers,4) || rpad(l1.t$rele,2) || rpad(l1.t$cust,4)) from baandb.tttadv401000 l1 where l1.t$cpac = d.t$cpac and l1.t$cdom = d.t$cdom ) AND rpad(l.t$vers,4) || rpad(l.t$rele,2) || rpad(l.t$cust,4) = ( select max(rpad(l1.t$vers,4) || rpad(l1.t$rele,2) || rpad(l1.t$cust,4)) from baandb.tttadv140000 l1 where l1.t$clab = l.t$clab and l1.t$clan = l.t$clan and l1.t$cpac = l.t$cpac ) ) FGET ON cisli940.t$fdty$l = FGET.CNST LEFT JOIN WMWHSE3.ORDERS@DL_LN_WMS WMS_OA_ORDERS_SH ON SUBSTR(WMS_OA_ORDERS_SH.EXTERNORDERKEY,5,9) = CISLI245.T$SHPM LEFT JOIN ( select MAX(a.ORDERKEY) ORDERKEY, MAX(a.TYPE) TYPE, a.REFERENCEDOCUMENT from WMWHSE3.ORDERS@DL_LN_WMS a group by a.REFERENCEDOCUMENT ) WMS_OA_ORDERS_OA ON SUBSTR(WMS_OA_ORDERS_OA.REFERENCEDOCUMENT,4,9) = CISLI245.T$SLSO LEFT JOIN ( select MAX(a.ORDERKEY) ORDERKEY, MAX(a.TYPE) TYPE, a.REFERENCEDOCUMENT from WMWHSE3.ORDERS@DL_LN_WMS a group by a.REFERENCEDOCUMENT ) WMS_OA_ORDERS_OV ON WMS_OA_ORDERS_OV.REFERENCEDOCUMENT = CISLI245.T$SLSO LEFT JOIN WMWHSE3.CODELKUP@DL_LN_WMS CODELKUP_SH ON CODELKUP_SH.LISTNAME = 'ORDERTYPE' AND CODELKUP_SH.CODE = WMS_OA_ORDERS_SH.TYPE LEFT JOIN WMWHSE3.CODELKUP@DL_LN_WMS CODELKUP_OA ON CODELKUP_OA.LISTNAME = 'ORDERTYPE' AND CODELKUP_OA.CODE = WMS_OA_ORDERS_OA.TYPE LEFT JOIN WMWHSE3.CODELKUP@DL_LN_WMS CODELKUP_OV ON CODELKUP_OV.LISTNAME = 'ORDERTYPE' AND CODELKUP_OV.CODE = WMS_OA_ORDERS_OV.TYPE LEFT JOIN baandb.tznsls000301 znsls000 ON znsls000.t$indt$c = TO_DATE('01-01-1970','DD-MM-YYYY') WHERE cisli940.t$fdty$l != 11 AND cisli940.t$docn$l != 0 AND cisli940.t$stat$l NOT IN (2, 101) AND cisli941.t$item$l != znsls000.t$itmd$c AND cisli941.t$item$l != znsls000.t$itmf$c AND cisli941.t$item$l != znsls000.t$itjl$c AND cisli940.t$fdty$l != 14 AND Trunc(CAST((FROM_TZ(TO_TIMESTAMP(TO_CHAR(cisli940.t$date$l, 'DD-MON-YYYY HH24:MI:SS'), 'DD-MON-YYYY HH24:MI:SS'), 'GMT') AT time zone 'America/Sao_Paulo') AS DATE)) Between '" + Parameters!EmissaoDe.Value + "' AND '" + Parameters!EmissaoAte.Value + "' GROUP BY FILIAL.DSC_FILIAL, cisli940.t$docn$l, cisli940.t$seri$l, NVL(WMS_OA_ORDERS_SH.ORDERKEY, NVL(WMS_OA_ORDERS_OV.ORDERKEY, WMS_OA_ORDERS_OA.ORDERKEY)), NVL(WMS_OA_ORDERS_SH.REFERENCEDOCUMENT, NVL(WMS_OA_ORDERS_OV.REFERENCEDOCUMENT, WMS_OA_ORDERS_OA.REFERENCEDOCUMENT)), NVL(CODELKUP_SH.DESCRIPTION, NVL(CODELKUP_OV.DESCRIPTION, CODELKUP_OA.DESCRIPTION)), CAST((FROM_TZ(TO_TIMESTAMP(TO_CHAR(cisli940.t$date$l, 'DD-MON-YYYY HH24:MI:SS'), 'DD-MON-YYYY HH24:MI:SS'), 'GMT') AT time zone 'America/Sao_Paulo') AS DATE), cisli940.t$ccfo$l, cisli940.t$opor$l, tcmcs940.t$dsca$l, znsls400.t$idca$c, TRIM(cisli941.t$item$l), tcibd001.t$dsca , CASE WHEN cisli941.t$iprt$l = 0 THEN round(tdsls401.t$pric,2) ELSE round(cisli941.t$pric$l,2) END, CASE WHEN cisli941.t$gamt$l = 0 THEN round(tdsls401.t$pric,2) ELSE round(cisli941.t$gamt$l,2) END, cisli940.t$itbp$l, cisli940.t$itbn$l, tccom130.t$namc, tccom130.t$dist$l, tccom130.t$pstc, tccom130.t$dsca, tccom130.t$cste, tccom130.t$telp, tccom130.t$telx, tccom130.t$enfs$l, cisli940.t$fdtc$l, tcmcs966.t$dsca$l, FGET.DESC_TIPO_DOCTO, tccom130f.t$fovn$l, tcmcs060.t$dsca, Q1.CMV_UNIT  " &
" Union SELECT FILIAL.DSC_FILIAL FILIAL, cisli940.t$docn$l NF, cisli940.t$seri$l SERIE, NVL(WMS_OA_ORDERS_SH.ORDERKEY, NVL(WMS_OA_ORDERS_OV.ORDERKEY, WMS_OA_ORDERS_OA.ORDERKEY)) PEDIDO_WMS, NVL(WMS_OA_ORDERS_SH.REFERENCEDOCUMENT, NVL(WMS_OA_ORDERS_OV.REFERENCEDOCUMENT, WMS_OA_ORDERS_OA.REFERENCEDOCUMENT)) ORDEM_MOVIMENTACAO, NVL(CODELKUP_SH.DESCRIPTION, NVL(CODELKUP_OV.DESCRIPTION, CODELKUP_OA.DESCRIPTION)) DESCRICAO_PEDIDO, CAST((FROM_TZ(TO_TIMESTAMP(TO_CHAR(cisli940.t$date$l, 'DD-MON-YYYY HH24:MI:SS'), 'DD-MON-YYYY HH24:MI:SS'), 'GMT') AT time zone 'America/Sao_Paulo') AS DATE) DT_EMISSAO, cisli940.t$ccfo$l CFO, cisli940.t$opor$l SEQ_CFO, tcmcs940.t$dsca$l NOME_CFO, znsls400.t$idca$c CANAL, TRIM(cisli941.t$item$l) ID_ITEM, tcibd001.t$dsca NOME_ITEM, sum(cisli941.t$dqua$l) QTD_FATURADA, CASE WHEN cisli941.t$iprt$l = 0 THEN round(tdsls401.t$pric,2) ELSE round(cisli941.t$pric$l,2) END VL_PRODUTO, CASE WHEN sum(cisli941.t$amnt$l) = 0 THEN sum(tdsls401.t$oamt) ELSE sum(cisli941.t$amnt$l) END VL_TOTAL_ITEM, CASE WHEN cisli941.t$gamt$l = 0 THEN round(tdsls401.t$pric,2) ELSE round(cisli941.t$gamt$l,2) END VL_MERCADORIA, CASE WHEN sum(cisli941.t$fght$l) = 0 THEN sum(nvl(znsls401.t$vlfr$c,0)) ELSE sum(cisli941.t$fght$l) END VL_FRETE, CASE WHEN sum(cisli941.t$ldam$l) = 0 THEN sum(nvl(znsls401.t$vlde$c,0)) ELSE sum(cisli941.t$ldam$l) END VL_DESC_INC, sum( NVL(( select sum(cisli943.t$amnt$l) from baandb.tcisli943301 cisli943 where cisli943.t$fire$l = cisli941.t$fire$l and cisli943.t$LINE$l = cisli941.t$LINE$l and cisli943.t$brty$l = 1 ), 0) )VL_ICMS, sum( NVL(( select sum(cisli943.t$amnt$l) from baandb.tcisli943301 cisli943 where cisli943.t$fire$l = cisli941.t$fire$l and cisli943.t$line$l = cisli941.t$line$l and cisli943.t$brty$l = 5 ), 0) )VL_PIS, sum( NVL(( select sum(cisli943.t$amnt$l) from baandb.tcisli943301 cisli943 where cisli943.t$fire$l = cisli941.t$fire$l and cisli943.t$line$l = cisli941.t$line$l and cisli943.t$brty$l = 6 ), 0) )VL_COFINS, cisli940.t$itbp$l ID_CLIENTE, cisli940.t$itbn$l NOME_CLIENTE, tccom130.t$namc ENDERECO, tccom130.t$dist$l BAIRRO, tccom130.t$pstc CEP, tccom130.t$dsca MUNICIPIO, tccom130.t$cste UF, tccom130.t$telp TEL1, tccom130.t$telx TEL2, tccom130.t$enfs$l EMAIL, cisli940.t$fdtc$l ID_TIPO_DOC_FIS, tcmcs966.t$dsca$l DESCR_TIPO_DOC_FIS, FGET.DESC_TIPO_DOCTO DESC_TIPO_DOCTO, tccom130f.t$fovn$l CNPJ_FABRICANTE, tcmcs060.t$dsca NOME_FABRICANTE, Q1.CMV_UNIT FROM baandb.tcisli940301 cisli940 INNER JOIN ( select tcemm030.t$eunt CHAVE_FILIAL, tcemm030.t$dsca DSC_FILIAL, tcemm124.t$cwoc from baandb.ttcemm124301 tcemm124, baandb.ttcemm030301 tcemm030 where tcemm030.t$eunt = tcemm124.t$grid and tcemm124.t$loco = 301 ) FILIAL ON FILIAL.t$cwoc = cisli940.t$cofc$l LEFT JOIN baandb.ttcmcs940301 tcmcs940 ON tcmcs940.T$OFSO$L = cisli940.t$ccfo$l INNER JOIN baandb.tcisli941301 cisli941 ON cisli941.t$fire$l = cisli940.t$fire$l LEFT JOIN ( select whwmd217.t$item, whwmd217.t$cwar, case when ( max(whwmd215.t$qhnd) - max(whwmd215.t$qchd) - max(whwmd215.t$qnhd) ) = 0 then 0 else round(sum(whwmd217.t$mauc$1) / (max(whwmd215.t$qhnd) - max(whwmd215.t$qchd) - max(whwmd215.t$qnhd)), 4) end CMV_UNIT from baandb.twhwmd217301 whwmd217 inner join baandb.twhwmd215301 whwmd215 on whwmd215.t$cwar = whwmd217.t$cwar and whwmd215.t$item = whwmd217.t$item group by whwmd217.t$item, whwmd217.t$cwar ) Q1 ON Q1.t$item = cisli941.t$item$l AND Q1.t$cwar = cisli941.t$cwar$l INNER JOIN baandb.tcisli245301 cisli245 ON cisli245.t$fire$l = cisli941.t$fire$l AND cisli245.t$line$l = cisli941.t$line$l LEFT JOIN baandb.tznsls401301 znsls401 ON znsls401.t$orno$c = cisli245.t$slso AND znsls401.t$pono$c = cisli245.t$pono LEFT JOIN baandb.ttdsls401301 tdsls401 ON tdsls401.t$orno = cisli245.t$slso AND tdsls401.t$pono = cisli245.t$pono LEFT JOIN baandb.tznsls400301 znsls400 ON znsls400.t$ncia$c = znsls401.t$ncia$c AND znsls400.t$uneg$c = znsls401.t$uneg$c AND znsls400.t$pecl$c = znsls401.t$pecl$c AND znsls400.t$sqpd$c = znsls401.t$sqpd$c INNER JOIN baandb.ttccom130301 tccom130 ON tccom130.t$cadr = cisli940.t$itoa$l INNER JOIN baandb.ttcibd001301 tcibd001 ON tcibd001.t$item = cisli941.t$item$l LEFT JOIN baandb.ttcmcs060301 tcmcs060 ON tcmcs060.t$cmnf = tcibd001.t$cmnf LEFT JOIN baandb.ttccom130301 tccom130f ON tccom130f.t$cadr = tcmcs060.t$cadr LEFT JOIN baandb.ttcmcs966301 tcmcs966 ON tcmcs966.t$fdtc$l = cisli940.t$fdtc$l LEFT JOIN ( SELECT d.t$cnst CNST, l.t$desc DESC_TIPO_DOCTO FROM baandb.tttadv401000 d, baandb.tttadv140000 l WHERE d.t$cpac = 'ci' AND d.t$cdom = 'sli.tdff.l' AND l.t$clan = 'p' AND l.t$cpac = 'ci' AND l.t$clab = d.t$za_clab AND rpad(d.t$vers,4) || rpad(d.t$rele,2) || rpad(d.t$cust,4) = ( select max(rpad(l1.t$vers,4) || rpad(l1.t$rele,2) || rpad(l1.t$cust,4)) from baandb.tttadv401000 l1 where l1.t$cpac = d.t$cpac and l1.t$cdom = d.t$cdom ) AND rpad(l.t$vers,4) || rpad(l.t$rele,2) || rpad(l.t$cust,4) = ( select max(rpad(l1.t$vers,4) || rpad(l1.t$rele,2) || rpad(l1.t$cust,4)) from baandb.tttadv140000 l1 where l1.t$clab = l.t$clab and l1.t$clan = l.t$clan and l1.t$cpac = l.t$cpac ) ) FGET ON cisli940.t$fdty$l = FGET.CNST LEFT JOIN WMWHSE4.ORDERS@DL_LN_WMS WMS_OA_ORDERS_SH ON SUBSTR(WMS_OA_ORDERS_SH.EXTERNORDERKEY,5,9) = CISLI245.T$SHPM LEFT JOIN ( select MAX(a.ORDERKEY) ORDERKEY, MAX(a.TYPE) TYPE, a.REFERENCEDOCUMENT from WMWHSE4.ORDERS@DL_LN_WMS a group by a.REFERENCEDOCUMENT ) WMS_OA_ORDERS_OA ON SUBSTR(WMS_OA_ORDERS_OA.REFERENCEDOCUMENT,4,9) = CISLI245.T$SLSO LEFT JOIN ( select MAX(a.ORDERKEY) ORDERKEY, MAX(a.TYPE) TYPE, a.REFERENCEDOCUMENT from WMWHSE4.ORDERS@DL_LN_WMS a group by a.REFERENCEDOCUMENT ) WMS_OA_ORDERS_OV ON WMS_OA_ORDERS_OV.REFERENCEDOCUMENT = CISLI245.T$SLSO LEFT JOIN WMWHSE4.CODELKUP@DL_LN_WMS CODELKUP_SH ON CODELKUP_SH.LISTNAME = 'ORDERTYPE' AND CODELKUP_SH.CODE = WMS_OA_ORDERS_SH.TYPE LEFT JOIN WMWHSE4.CODELKUP@DL_LN_WMS CODELKUP_OA ON CODELKUP_OA.LISTNAME = 'ORDERTYPE' AND CODELKUP_OA.CODE = WMS_OA_ORDERS_OA.TYPE LEFT JOIN WMWHSE4.CODELKUP@DL_LN_WMS CODELKUP_OV ON CODELKUP_OV.LISTNAME = 'ORDERTYPE' AND CODELKUP_OV.CODE = WMS_OA_ORDERS_OV.TYPE LEFT JOIN baandb.tznsls000301 znsls000 ON znsls000.t$indt$c = TO_DATE('01-01-1970','DD-MM-YYYY') WHERE cisli940.t$fdty$l != 11 AND cisli940.t$docn$l != 0 AND cisli940.t$stat$l NOT IN (2, 101) AND cisli941.t$item$l != znsls000.t$itmd$c AND cisli941.t$item$l != znsls000.t$itmf$c AND cisli941.t$item$l != znsls000.t$itjl$c AND cisli940.t$fdty$l != 14 AND Trunc(CAST((FROM_TZ(TO_TIMESTAMP(TO_CHAR(cisli940.t$date$l, 'DD-MON-YYYY HH24:MI:SS'), 'DD-MON-YYYY HH24:MI:SS'), 'GMT') AT time zone 'America/Sao_Paulo') AS DATE)) Between '" + Parameters!EmissaoDe.Value + "' AND '" + Parameters!EmissaoAte.Value + "' GROUP BY FILIAL.DSC_FILIAL, cisli940.t$docn$l, cisli940.t$seri$l, NVL(WMS_OA_ORDERS_SH.ORDERKEY, NVL(WMS_OA_ORDERS_OV.ORDERKEY, WMS_OA_ORDERS_OA.ORDERKEY)), NVL(WMS_OA_ORDERS_SH.REFERENCEDOCUMENT, NVL(WMS_OA_ORDERS_OV.REFERENCEDOCUMENT, WMS_OA_ORDERS_OA.REFERENCEDOCUMENT)), NVL(CODELKUP_SH.DESCRIPTION, NVL(CODELKUP_OV.DESCRIPTION, CODELKUP_OA.DESCRIPTION)), CAST((FROM_TZ(TO_TIMESTAMP(TO_CHAR(cisli940.t$date$l, 'DD-MON-YYYY HH24:MI:SS'), 'DD-MON-YYYY HH24:MI:SS'), 'GMT') AT time zone 'America/Sao_Paulo') AS DATE), cisli940.t$ccfo$l, cisli940.t$opor$l, tcmcs940.t$dsca$l, znsls400.t$idca$c, TRIM(cisli941.t$item$l), tcibd001.t$dsca , CASE WHEN cisli941.t$iprt$l = 0 THEN round(tdsls401.t$pric,2) ELSE round(cisli941.t$pric$l,2) END, CASE WHEN cisli941.t$gamt$l = 0 THEN round(tdsls401.t$pric,2) ELSE round(cisli941.t$gamt$l,2) END, cisli940.t$itbp$l, cisli940.t$itbn$l, tccom130.t$namc, tccom130.t$dist$l, tccom130.t$pstc, tccom130.t$dsca, tccom130.t$cste, tccom130.t$telp, tccom130.t$telx, tccom130.t$enfs$l, cisli940.t$fdtc$l, tcmcs966.t$dsca$l, FGET.DESC_TIPO_DOCTO, tccom130f.t$fovn$l, tcmcs060.t$dsca, Q1.CMV_UNIT  " &
" Union SELECT FILIAL.DSC_FILIAL FILIAL, cisli940.t$docn$l NF, cisli940.t$seri$l SERIE, NVL(WMS_OA_ORDERS_SH.ORDERKEY, NVL(WMS_OA_ORDERS_OV.ORDERKEY, WMS_OA_ORDERS_OA.ORDERKEY)) PEDIDO_WMS, NVL(WMS_OA_ORDERS_SH.REFERENCEDOCUMENT, NVL(WMS_OA_ORDERS_OV.REFERENCEDOCUMENT, WMS_OA_ORDERS_OA.REFERENCEDOCUMENT)) ORDEM_MOVIMENTACAO, NVL(CODELKUP_SH.DESCRIPTION, NVL(CODELKUP_OV.DESCRIPTION, CODELKUP_OA.DESCRIPTION)) DESCRICAO_PEDIDO, CAST((FROM_TZ(TO_TIMESTAMP(TO_CHAR(cisli940.t$date$l, 'DD-MON-YYYY HH24:MI:SS'), 'DD-MON-YYYY HH24:MI:SS'), 'GMT') AT time zone 'America/Sao_Paulo') AS DATE) DT_EMISSAO, cisli940.t$ccfo$l CFO, cisli940.t$opor$l SEQ_CFO, tcmcs940.t$dsca$l NOME_CFO, znsls400.t$idca$c CANAL, TRIM(cisli941.t$item$l) ID_ITEM, tcibd001.t$dsca NOME_ITEM, sum(cisli941.t$dqua$l) QTD_FATURADA, CASE WHEN cisli941.t$iprt$l = 0 THEN round(tdsls401.t$pric,2) ELSE round(cisli941.t$pric$l,2) END VL_PRODUTO, CASE WHEN sum(cisli941.t$amnt$l) = 0 THEN sum(tdsls401.t$oamt) ELSE sum(cisli941.t$amnt$l) END VL_TOTAL_ITEM, CASE WHEN cisli941.t$gamt$l = 0 THEN round(tdsls401.t$pric,2) ELSE round(cisli941.t$gamt$l,2) END VL_MERCADORIA, CASE WHEN sum(cisli941.t$fght$l) = 0 THEN sum(nvl(znsls401.t$vlfr$c,0)) ELSE sum(cisli941.t$fght$l) END VL_FRETE, CASE WHEN sum(cisli941.t$ldam$l) = 0 THEN sum(nvl(znsls401.t$vlde$c,0)) ELSE sum(cisli941.t$ldam$l) END VL_DESC_INC, sum( NVL(( select sum(cisli943.t$amnt$l) from baandb.tcisli943301 cisli943 where cisli943.t$fire$l = cisli941.t$fire$l and cisli943.t$LINE$l = cisli941.t$LINE$l and cisli943.t$brty$l = 1 ), 0) )VL_ICMS, sum( NVL(( select sum(cisli943.t$amnt$l) from baandb.tcisli943301 cisli943 where cisli943.t$fire$l = cisli941.t$fire$l and cisli943.t$line$l = cisli941.t$line$l and cisli943.t$brty$l = 5 ), 0) )VL_PIS, sum( NVL(( select sum(cisli943.t$amnt$l) from baandb.tcisli943301 cisli943 where cisli943.t$fire$l = cisli941.t$fire$l and cisli943.t$line$l = cisli941.t$line$l and cisli943.t$brty$l = 6 ), 0) )VL_COFINS, cisli940.t$itbp$l ID_CLIENTE, cisli940.t$itbn$l NOME_CLIENTE, tccom130.t$namc ENDERECO, tccom130.t$dist$l BAIRRO, tccom130.t$pstc CEP, tccom130.t$dsca MUNICIPIO, tccom130.t$cste UF, tccom130.t$telp TEL1, tccom130.t$telx TEL2, tccom130.t$enfs$l EMAIL, cisli940.t$fdtc$l ID_TIPO_DOC_FIS, tcmcs966.t$dsca$l DESCR_TIPO_DOC_FIS, FGET.DESC_TIPO_DOCTO DESC_TIPO_DOCTO, tccom130f.t$fovn$l CNPJ_FABRICANTE, tcmcs060.t$dsca NOME_FABRICANTE, Q1.CMV_UNIT FROM baandb.tcisli940301 cisli940 INNER JOIN ( select tcemm030.t$eunt CHAVE_FILIAL, tcemm030.t$dsca DSC_FILIAL, tcemm124.t$cwoc from baandb.ttcemm124301 tcemm124, baandb.ttcemm030301 tcemm030 where tcemm030.t$eunt = tcemm124.t$grid and tcemm124.t$loco = 301 ) FILIAL ON FILIAL.t$cwoc = cisli940.t$cofc$l LEFT JOIN baandb.ttcmcs940301 tcmcs940 ON tcmcs940.T$OFSO$L = cisli940.t$ccfo$l INNER JOIN baandb.tcisli941301 cisli941 ON cisli941.t$fire$l = cisli940.t$fire$l LEFT JOIN ( select whwmd217.t$item, whwmd217.t$cwar, case when ( max(whwmd215.t$qhnd) - max(whwmd215.t$qchd) - max(whwmd215.t$qnhd) ) = 0 then 0 else round(sum(whwmd217.t$mauc$1) / (max(whwmd215.t$qhnd) - max(whwmd215.t$qchd) - max(whwmd215.t$qnhd)), 4) end CMV_UNIT from baandb.twhwmd217301 whwmd217 inner join baandb.twhwmd215301 whwmd215 on whwmd215.t$cwar = whwmd217.t$cwar and whwmd215.t$item = whwmd217.t$item group by whwmd217.t$item, whwmd217.t$cwar ) Q1 ON Q1.t$item = cisli941.t$item$l AND Q1.t$cwar = cisli941.t$cwar$l INNER JOIN baandb.tcisli245301 cisli245 ON cisli245.t$fire$l = cisli941.t$fire$l AND cisli245.t$line$l = cisli941.t$line$l LEFT JOIN baandb.tznsls401301 znsls401 ON znsls401.t$orno$c = cisli245.t$slso AND znsls401.t$pono$c = cisli245.t$pono LEFT JOIN baandb.ttdsls401301 tdsls401 ON tdsls401.t$orno = cisli245.t$slso AND tdsls401.t$pono = cisli245.t$pono LEFT JOIN baandb.tznsls400301 znsls400 ON znsls400.t$ncia$c = znsls401.t$ncia$c AND znsls400.t$uneg$c = znsls401.t$uneg$c AND znsls400.t$pecl$c = znsls401.t$pecl$c AND znsls400.t$sqpd$c = znsls401.t$sqpd$c INNER JOIN baandb.ttccom130301 tccom130 ON tccom130.t$cadr = cisli940.t$itoa$l INNER JOIN baandb.ttcibd001301 tcibd001 ON tcibd001.t$item = cisli941.t$item$l LEFT JOIN baandb.ttcmcs060301 tcmcs060 ON tcmcs060.t$cmnf = tcibd001.t$cmnf LEFT JOIN baandb.ttccom130301 tccom130f ON tccom130f.t$cadr = tcmcs060.t$cadr LEFT JOIN baandb.ttcmcs966301 tcmcs966 ON tcmcs966.t$fdtc$l = cisli940.t$fdtc$l LEFT JOIN ( SELECT d.t$cnst CNST, l.t$desc DESC_TIPO_DOCTO FROM baandb.tttadv401000 d, baandb.tttadv140000 l WHERE d.t$cpac = 'ci' AND d.t$cdom = 'sli.tdff.l' AND l.t$clan = 'p' AND l.t$cpac = 'ci' AND l.t$clab = d.t$za_clab AND rpad(d.t$vers,4) || rpad(d.t$rele,2) || rpad(d.t$cust,4) = ( select max(rpad(l1.t$vers,4) || rpad(l1.t$rele,2) || rpad(l1.t$cust,4)) from baandb.tttadv401000 l1 where l1.t$cpac = d.t$cpac and l1.t$cdom = d.t$cdom ) AND rpad(l.t$vers,4) || rpad(l.t$rele,2) || rpad(l.t$cust,4) = ( select max(rpad(l1.t$vers,4) || rpad(l1.t$rele,2) || rpad(l1.t$cust,4)) from baandb.tttadv140000 l1 where l1.t$clab = l.t$clab and l1.t$clan = l.t$clan and l1.t$cpac = l.t$cpac ) ) FGET ON cisli940.t$fdty$l = FGET.CNST LEFT JOIN WMWHSE5.ORDERS@DL_LN_WMS WMS_OA_ORDERS_SH ON SUBSTR(WMS_OA_ORDERS_SH.EXTERNORDERKEY,5,9) = CISLI245.T$SHPM LEFT JOIN ( select MAX(a.ORDERKEY) ORDERKEY, MAX(a.TYPE) TYPE, a.REFERENCEDOCUMENT from WMWHSE5.ORDERS@DL_LN_WMS a group by a.REFERENCEDOCUMENT ) WMS_OA_ORDERS_OA ON SUBSTR(WMS_OA_ORDERS_OA.REFERENCEDOCUMENT,4,9) = CISLI245.T$SLSO LEFT JOIN ( select MAX(a.ORDERKEY) ORDERKEY, MAX(a.TYPE) TYPE, a.REFERENCEDOCUMENT from WMWHSE5.ORDERS@DL_LN_WMS a group by a.REFERENCEDOCUMENT ) WMS_OA_ORDERS_OV ON WMS_OA_ORDERS_OV.REFERENCEDOCUMENT = CISLI245.T$SLSO LEFT JOIN WMWHSE5.CODELKUP@DL_LN_WMS CODELKUP_SH ON CODELKUP_SH.LISTNAME = 'ORDERTYPE' AND CODELKUP_SH.CODE = WMS_OA_ORDERS_SH.TYPE LEFT JOIN WMWHSE5.CODELKUP@DL_LN_WMS CODELKUP_OA ON CODELKUP_OA.LISTNAME = 'ORDERTYPE' AND CODELKUP_OA.CODE = WMS_OA_ORDERS_OA.TYPE LEFT JOIN WMWHSE5.CODELKUP@DL_LN_WMS CODELKUP_OV ON CODELKUP_OV.LISTNAME = 'ORDERTYPE' AND CODELKUP_OV.CODE = WMS_OA_ORDERS_OV.TYPE LEFT JOIN baandb.tznsls000301 znsls000 ON znsls000.t$indt$c = TO_DATE('01-01-1970','DD-MM-YYYY') WHERE cisli940.t$fdty$l != 11 AND cisli940.t$docn$l != 0 AND cisli940.t$stat$l NOT IN (2, 101) AND cisli941.t$item$l != znsls000.t$itmd$c AND cisli941.t$item$l != znsls000.t$itmf$c AND cisli941.t$item$l != znsls000.t$itjl$c AND cisli940.t$fdty$l != 14 AND Trunc(CAST((FROM_TZ(TO_TIMESTAMP(TO_CHAR(cisli940.t$date$l, 'DD-MON-YYYY HH24:MI:SS'), 'DD-MON-YYYY HH24:MI:SS'), 'GMT') AT time zone 'America/Sao_Paulo') AS DATE)) Between '" + Parameters!EmissaoDe.Value + "' AND '" + Parameters!EmissaoAte.Value + "' GROUP BY FILIAL.DSC_FILIAL, cisli940.t$docn$l, cisli940.t$seri$l, NVL(WMS_OA_ORDERS_SH.ORDERKEY, NVL(WMS_OA_ORDERS_OV.ORDERKEY, WMS_OA_ORDERS_OA.ORDERKEY)), NVL(WMS_OA_ORDERS_SH.REFERENCEDOCUMENT, NVL(WMS_OA_ORDERS_OV.REFERENCEDOCUMENT, WMS_OA_ORDERS_OA.REFERENCEDOCUMENT)), NVL(CODELKUP_SH.DESCRIPTION, NVL(CODELKUP_OV.DESCRIPTION, CODELKUP_OA.DESCRIPTION)), CAST((FROM_TZ(TO_TIMESTAMP(TO_CHAR(cisli940.t$date$l, 'DD-MON-YYYY HH24:MI:SS'), 'DD-MON-YYYY HH24:MI:SS'), 'GMT') AT time zone 'America/Sao_Paulo') AS DATE), cisli940.t$ccfo$l, cisli940.t$opor$l, tcmcs940.t$dsca$l, znsls400.t$idca$c, TRIM(cisli941.t$item$l), tcibd001.t$dsca , CASE WHEN cisli941.t$iprt$l = 0 THEN round(tdsls401.t$pric,2) ELSE round(cisli941.t$pric$l,2) END, CASE WHEN cisli941.t$gamt$l = 0 THEN round(tdsls401.t$pric,2) ELSE round(cisli941.t$gamt$l,2) END, cisli940.t$itbp$l, cisli940.t$itbn$l, tccom130.t$namc, tccom130.t$dist$l, tccom130.t$pstc, tccom130.t$dsca, tccom130.t$cste, tccom130.t$telp, tccom130.t$telx, tccom130.t$enfs$l, cisli940.t$fdtc$l, tcmcs966.t$dsca$l, FGET.DESC_TIPO_DOCTO, tccom130f.t$fovn$l, tcmcs060.t$dsca, Q1.CMV_UNIT  " &
" Union SELECT FILIAL.DSC_FILIAL FILIAL, cisli940.t$docn$l NF, cisli940.t$seri$l SERIE, NVL(WMS_OA_ORDERS_SH.ORDERKEY, NVL(WMS_OA_ORDERS_OV.ORDERKEY, WMS_OA_ORDERS_OA.ORDERKEY)) PEDIDO_WMS, NVL(WMS_OA_ORDERS_SH.REFERENCEDOCUMENT, NVL(WMS_OA_ORDERS_OV.REFERENCEDOCUMENT, WMS_OA_ORDERS_OA.REFERENCEDOCUMENT)) ORDEM_MOVIMENTACAO, NVL(CODELKUP_SH.DESCRIPTION, NVL(CODELKUP_OV.DESCRIPTION, CODELKUP_OA.DESCRIPTION)) DESCRICAO_PEDIDO, CAST((FROM_TZ(TO_TIMESTAMP(TO_CHAR(cisli940.t$date$l, 'DD-MON-YYYY HH24:MI:SS'), 'DD-MON-YYYY HH24:MI:SS'), 'GMT') AT time zone 'America/Sao_Paulo') AS DATE) DT_EMISSAO, cisli940.t$ccfo$l CFO, cisli940.t$opor$l SEQ_CFO, tcmcs940.t$dsca$l NOME_CFO, znsls400.t$idca$c CANAL, TRIM(cisli941.t$item$l) ID_ITEM, tcibd001.t$dsca NOME_ITEM, sum(cisli941.t$dqua$l) QTD_FATURADA, CASE WHEN cisli941.t$iprt$l = 0 THEN round(tdsls401.t$pric,2) ELSE round(cisli941.t$pric$l,2) END VL_PRODUTO, CASE WHEN sum(cisli941.t$amnt$l) = 0 THEN sum(tdsls401.t$oamt) ELSE sum(cisli941.t$amnt$l) END VL_TOTAL_ITEM, CASE WHEN cisli941.t$gamt$l = 0 THEN round(tdsls401.t$pric,2) ELSE round(cisli941.t$gamt$l,2) END VL_MERCADORIA, CASE WHEN sum(cisli941.t$fght$l) = 0 THEN sum(nvl(znsls401.t$vlfr$c,0)) ELSE sum(cisli941.t$fght$l) END VL_FRETE, CASE WHEN sum(cisli941.t$ldam$l) = 0 THEN sum(nvl(znsls401.t$vlde$c,0)) ELSE sum(cisli941.t$ldam$l) END VL_DESC_INC, sum( NVL(( select sum(cisli943.t$amnt$l) from baandb.tcisli943301 cisli943 where cisli943.t$fire$l = cisli941.t$fire$l and cisli943.t$LINE$l = cisli941.t$LINE$l and cisli943.t$brty$l = 1 ), 0) )VL_ICMS, sum( NVL(( select sum(cisli943.t$amnt$l) from baandb.tcisli943301 cisli943 where cisli943.t$fire$l = cisli941.t$fire$l and cisli943.t$line$l = cisli941.t$line$l and cisli943.t$brty$l = 5 ), 0) )VL_PIS, sum( NVL(( select sum(cisli943.t$amnt$l) from baandb.tcisli943301 cisli943 where cisli943.t$fire$l = cisli941.t$fire$l and cisli943.t$line$l = cisli941.t$line$l and cisli943.t$brty$l = 6 ), 0) )VL_COFINS, cisli940.t$itbp$l ID_CLIENTE, cisli940.t$itbn$l NOME_CLIENTE, tccom130.t$namc ENDERECO, tccom130.t$dist$l BAIRRO, tccom130.t$pstc CEP, tccom130.t$dsca MUNICIPIO, tccom130.t$cste UF, tccom130.t$telp TEL1, tccom130.t$telx TEL2, tccom130.t$enfs$l EMAIL, cisli940.t$fdtc$l ID_TIPO_DOC_FIS, tcmcs966.t$dsca$l DESCR_TIPO_DOC_FIS, FGET.DESC_TIPO_DOCTO DESC_TIPO_DOCTO, tccom130f.t$fovn$l CNPJ_FABRICANTE, tcmcs060.t$dsca NOME_FABRICANTE, Q1.CMV_UNIT FROM baandb.tcisli940301 cisli940 INNER JOIN ( select tcemm030.t$eunt CHAVE_FILIAL, tcemm030.t$dsca DSC_FILIAL, tcemm124.t$cwoc from baandb.ttcemm124301 tcemm124, baandb.ttcemm030301 tcemm030 where tcemm030.t$eunt = tcemm124.t$grid and tcemm124.t$loco = 301 ) FILIAL ON FILIAL.t$cwoc = cisli940.t$cofc$l LEFT JOIN baandb.ttcmcs940301 tcmcs940 ON tcmcs940.T$OFSO$L = cisli940.t$ccfo$l INNER JOIN baandb.tcisli941301 cisli941 ON cisli941.t$fire$l = cisli940.t$fire$l LEFT JOIN ( select whwmd217.t$item, whwmd217.t$cwar, case when ( max(whwmd215.t$qhnd) - max(whwmd215.t$qchd) - max(whwmd215.t$qnhd) ) = 0 then 0 else round(sum(whwmd217.t$mauc$1) / (max(whwmd215.t$qhnd) - max(whwmd215.t$qchd) - max(whwmd215.t$qnhd)), 4) end CMV_UNIT from baandb.twhwmd217301 whwmd217 inner join baandb.twhwmd215301 whwmd215 on whwmd215.t$cwar = whwmd217.t$cwar and whwmd215.t$item = whwmd217.t$item group by whwmd217.t$item, whwmd217.t$cwar ) Q1 ON Q1.t$item = cisli941.t$item$l AND Q1.t$cwar = cisli941.t$cwar$l INNER JOIN baandb.tcisli245301 cisli245 ON cisli245.t$fire$l = cisli941.t$fire$l AND cisli245.t$line$l = cisli941.t$line$l LEFT JOIN baandb.tznsls401301 znsls401 ON znsls401.t$orno$c = cisli245.t$slso AND znsls401.t$pono$c = cisli245.t$pono LEFT JOIN baandb.ttdsls401301 tdsls401 ON tdsls401.t$orno = cisli245.t$slso AND tdsls401.t$pono = cisli245.t$pono LEFT JOIN baandb.tznsls400301 znsls400 ON znsls400.t$ncia$c = znsls401.t$ncia$c AND znsls400.t$uneg$c = znsls401.t$uneg$c AND znsls400.t$pecl$c = znsls401.t$pecl$c AND znsls400.t$sqpd$c = znsls401.t$sqpd$c INNER JOIN baandb.ttccom130301 tccom130 ON tccom130.t$cadr = cisli940.t$itoa$l INNER JOIN baandb.ttcibd001301 tcibd001 ON tcibd001.t$item = cisli941.t$item$l LEFT JOIN baandb.ttcmcs060301 tcmcs060 ON tcmcs060.t$cmnf = tcibd001.t$cmnf LEFT JOIN baandb.ttccom130301 tccom130f ON tccom130f.t$cadr = tcmcs060.t$cadr LEFT JOIN baandb.ttcmcs966301 tcmcs966 ON tcmcs966.t$fdtc$l = cisli940.t$fdtc$l LEFT JOIN ( SELECT d.t$cnst CNST, l.t$desc DESC_TIPO_DOCTO FROM baandb.tttadv401000 d, baandb.tttadv140000 l WHERE d.t$cpac = 'ci' AND d.t$cdom = 'sli.tdff.l' AND l.t$clan = 'p' AND l.t$cpac = 'ci' AND l.t$clab = d.t$za_clab AND rpad(d.t$vers,4) || rpad(d.t$rele,2) || rpad(d.t$cust,4) = ( select max(rpad(l1.t$vers,4) || rpad(l1.t$rele,2) || rpad(l1.t$cust,4)) from baandb.tttadv401000 l1 where l1.t$cpac = d.t$cpac and l1.t$cdom = d.t$cdom ) AND rpad(l.t$vers,4) || rpad(l.t$rele,2) || rpad(l.t$cust,4) = ( select max(rpad(l1.t$vers,4) || rpad(l1.t$rele,2) || rpad(l1.t$cust,4)) from baandb.tttadv140000 l1 where l1.t$clab = l.t$clab and l1.t$clan = l.t$clan and l1.t$cpac = l.t$cpac ) ) FGET ON cisli940.t$fdty$l = FGET.CNST LEFT JOIN WMWHSE6.ORDERS@DL_LN_WMS WMS_OA_ORDERS_SH ON SUBSTR(WMS_OA_ORDERS_SH.EXTERNORDERKEY,5,9) = CISLI245.T$SHPM LEFT JOIN ( select MAX(a.ORDERKEY) ORDERKEY, MAX(a.TYPE) TYPE, a.REFERENCEDOCUMENT from WMWHSE6.ORDERS@DL_LN_WMS a group by a.REFERENCEDOCUMENT ) WMS_OA_ORDERS_OA ON SUBSTR(WMS_OA_ORDERS_OA.REFERENCEDOCUMENT,4,9) = CISLI245.T$SLSO LEFT JOIN ( select MAX(a.ORDERKEY) ORDERKEY, MAX(a.TYPE) TYPE, a.REFERENCEDOCUMENT from WMWHSE6.ORDERS@DL_LN_WMS a group by a.REFERENCEDOCUMENT ) WMS_OA_ORDERS_OV ON WMS_OA_ORDERS_OV.REFERENCEDOCUMENT = CISLI245.T$SLSO LEFT JOIN WMWHSE6.CODELKUP@DL_LN_WMS CODELKUP_SH ON CODELKUP_SH.LISTNAME = 'ORDERTYPE' AND CODELKUP_SH.CODE = WMS_OA_ORDERS_SH.TYPE LEFT JOIN WMWHSE6.CODELKUP@DL_LN_WMS CODELKUP_OA ON CODELKUP_OA.LISTNAME = 'ORDERTYPE' AND CODELKUP_OA.CODE = WMS_OA_ORDERS_OA.TYPE LEFT JOIN WMWHSE6.CODELKUP@DL_LN_WMS CODELKUP_OV ON CODELKUP_OV.LISTNAME = 'ORDERTYPE' AND CODELKUP_OV.CODE = WMS_OA_ORDERS_OV.TYPE LEFT JOIN baandb.tznsls000301 znsls000 ON znsls000.t$indt$c = TO_DATE('01-01-1970','DD-MM-YYYY') WHERE cisli940.t$fdty$l != 11 AND cisli940.t$docn$l != 0 AND cisli940.t$stat$l NOT IN (2, 101) AND cisli941.t$item$l != znsls000.t$itmd$c AND cisli941.t$item$l != znsls000.t$itmf$c AND cisli941.t$item$l != znsls000.t$itjl$c AND cisli940.t$fdty$l != 14 AND Trunc(CAST((FROM_TZ(TO_TIMESTAMP(TO_CHAR(cisli940.t$date$l, 'DD-MON-YYYY HH24:MI:SS'), 'DD-MON-YYYY HH24:MI:SS'), 'GMT') AT time zone 'America/Sao_Paulo') AS DATE)) Between '" + Parameters!EmissaoDe.Value + "' AND '" + Parameters!EmissaoAte.Value + "' GROUP BY FILIAL.DSC_FILIAL, cisli940.t$docn$l, cisli940.t$seri$l, NVL(WMS_OA_ORDERS_SH.ORDERKEY, NVL(WMS_OA_ORDERS_OV.ORDERKEY, WMS_OA_ORDERS_OA.ORDERKEY)), NVL(WMS_OA_ORDERS_SH.REFERENCEDOCUMENT, NVL(WMS_OA_ORDERS_OV.REFERENCEDOCUMENT, WMS_OA_ORDERS_OA.REFERENCEDOCUMENT)), NVL(CODELKUP_SH.DESCRIPTION, NVL(CODELKUP_OV.DESCRIPTION, CODELKUP_OA.DESCRIPTION)), CAST((FROM_TZ(TO_TIMESTAMP(TO_CHAR(cisli940.t$date$l, 'DD-MON-YYYY HH24:MI:SS'), 'DD-MON-YYYY HH24:MI:SS'), 'GMT') AT time zone 'America/Sao_Paulo') AS DATE), cisli940.t$ccfo$l, cisli940.t$opor$l, tcmcs940.t$dsca$l, znsls400.t$idca$c, TRIM(cisli941.t$item$l), tcibd001.t$dsca , CASE WHEN cisli941.t$iprt$l = 0 THEN round(tdsls401.t$pric,2) ELSE round(cisli941.t$pric$l,2) END, CASE WHEN cisli941.t$gamt$l = 0 THEN round(tdsls401.t$pric,2) ELSE round(cisli941.t$gamt$l,2) END, cisli940.t$itbp$l, cisli940.t$itbn$l, tccom130.t$namc, tccom130.t$dist$l, tccom130.t$pstc, tccom130.t$dsca, tccom130.t$cste, tccom130.t$telp, tccom130.t$telx, tccom130.t$enfs$l, cisli940.t$fdtc$l, tcmcs966.t$dsca$l, FGET.DESC_TIPO_DOCTO, tccom130f.t$fovn$l, tcmcs060.t$dsca, Q1.CMV_UNIT  " &
" Union SELECT FILIAL.DSC_FILIAL FILIAL, cisli940.t$docn$l NF, cisli940.t$seri$l SERIE, NVL(WMS_OA_ORDERS_SH.ORDERKEY, NVL(WMS_OA_ORDERS_OV.ORDERKEY, WMS_OA_ORDERS_OA.ORDERKEY)) PEDIDO_WMS, NVL(WMS_OA_ORDERS_SH.REFERENCEDOCUMENT, NVL(WMS_OA_ORDERS_OV.REFERENCEDOCUMENT, WMS_OA_ORDERS_OA.REFERENCEDOCUMENT)) ORDEM_MOVIMENTACAO, NVL(CODELKUP_SH.DESCRIPTION, NVL(CODELKUP_OV.DESCRIPTION, CODELKUP_OA.DESCRIPTION)) DESCRICAO_PEDIDO, CAST((FROM_TZ(TO_TIMESTAMP(TO_CHAR(cisli940.t$date$l, 'DD-MON-YYYY HH24:MI:SS'), 'DD-MON-YYYY HH24:MI:SS'), 'GMT') AT time zone 'America/Sao_Paulo') AS DATE) DT_EMISSAO, cisli940.t$ccfo$l CFO, cisli940.t$opor$l SEQ_CFO, tcmcs940.t$dsca$l NOME_CFO, znsls400.t$idca$c CANAL, TRIM(cisli941.t$item$l) ID_ITEM, tcibd001.t$dsca NOME_ITEM, sum(cisli941.t$dqua$l) QTD_FATURADA, CASE WHEN cisli941.t$iprt$l = 0 THEN round(tdsls401.t$pric,2) ELSE round(cisli941.t$pric$l,2) END VL_PRODUTO, CASE WHEN sum(cisli941.t$amnt$l) = 0 THEN sum(tdsls401.t$oamt) ELSE sum(cisli941.t$amnt$l) END VL_TOTAL_ITEM, CASE WHEN cisli941.t$gamt$l = 0 THEN round(tdsls401.t$pric,2) ELSE round(cisli941.t$gamt$l,2) END VL_MERCADORIA, CASE WHEN sum(cisli941.t$fght$l) = 0 THEN sum(nvl(znsls401.t$vlfr$c,0)) ELSE sum(cisli941.t$fght$l) END VL_FRETE, CASE WHEN sum(cisli941.t$ldam$l) = 0 THEN sum(nvl(znsls401.t$vlde$c,0)) ELSE sum(cisli941.t$ldam$l) END VL_DESC_INC, sum( NVL(( select sum(cisli943.t$amnt$l) from baandb.tcisli943301 cisli943 where cisli943.t$fire$l = cisli941.t$fire$l and cisli943.t$LINE$l = cisli941.t$LINE$l and cisli943.t$brty$l = 1 ), 0) )VL_ICMS, sum( NVL(( select sum(cisli943.t$amnt$l) from baandb.tcisli943301 cisli943 where cisli943.t$fire$l = cisli941.t$fire$l and cisli943.t$line$l = cisli941.t$line$l and cisli943.t$brty$l = 5 ), 0) )VL_PIS, sum( NVL(( select sum(cisli943.t$amnt$l) from baandb.tcisli943301 cisli943 where cisli943.t$fire$l = cisli941.t$fire$l and cisli943.t$line$l = cisli941.t$line$l and cisli943.t$brty$l = 6 ), 0) )VL_COFINS, cisli940.t$itbp$l ID_CLIENTE, cisli940.t$itbn$l NOME_CLIENTE, tccom130.t$namc ENDERECO, tccom130.t$dist$l BAIRRO, tccom130.t$pstc CEP, tccom130.t$dsca MUNICIPIO, tccom130.t$cste UF, tccom130.t$telp TEL1, tccom130.t$telx TEL2, tccom130.t$enfs$l EMAIL, cisli940.t$fdtc$l ID_TIPO_DOC_FIS, tcmcs966.t$dsca$l DESCR_TIPO_DOC_FIS, FGET.DESC_TIPO_DOCTO DESC_TIPO_DOCTO, tccom130f.t$fovn$l CNPJ_FABRICANTE, tcmcs060.t$dsca NOME_FABRICANTE, Q1.CMV_UNIT FROM baandb.tcisli940301 cisli940 INNER JOIN ( select tcemm030.t$eunt CHAVE_FILIAL, tcemm030.t$dsca DSC_FILIAL, tcemm124.t$cwoc from baandb.ttcemm124301 tcemm124, baandb.ttcemm030301 tcemm030 where tcemm030.t$eunt = tcemm124.t$grid and tcemm124.t$loco = 301 ) FILIAL ON FILIAL.t$cwoc = cisli940.t$cofc$l LEFT JOIN baandb.ttcmcs940301 tcmcs940 ON tcmcs940.T$OFSO$L = cisli940.t$ccfo$l INNER JOIN baandb.tcisli941301 cisli941 ON cisli941.t$fire$l = cisli940.t$fire$l LEFT JOIN ( select whwmd217.t$item, whwmd217.t$cwar, case when ( max(whwmd215.t$qhnd) - max(whwmd215.t$qchd) - max(whwmd215.t$qnhd) ) = 0 then 0 else round(sum(whwmd217.t$mauc$1) / (max(whwmd215.t$qhnd) - max(whwmd215.t$qchd) - max(whwmd215.t$qnhd)), 4) end CMV_UNIT from baandb.twhwmd217301 whwmd217 inner join baandb.twhwmd215301 whwmd215 on whwmd215.t$cwar = whwmd217.t$cwar and whwmd215.t$item = whwmd217.t$item group by whwmd217.t$item, whwmd217.t$cwar ) Q1 ON Q1.t$item = cisli941.t$item$l AND Q1.t$cwar = cisli941.t$cwar$l INNER JOIN baandb.tcisli245301 cisli245 ON cisli245.t$fire$l = cisli941.t$fire$l AND cisli245.t$line$l = cisli941.t$line$l LEFT JOIN baandb.tznsls401301 znsls401 ON znsls401.t$orno$c = cisli245.t$slso AND znsls401.t$pono$c = cisli245.t$pono LEFT JOIN baandb.ttdsls401301 tdsls401 ON tdsls401.t$orno = cisli245.t$slso AND tdsls401.t$pono = cisli245.t$pono LEFT JOIN baandb.tznsls400301 znsls400 ON znsls400.t$ncia$c = znsls401.t$ncia$c AND znsls400.t$uneg$c = znsls401.t$uneg$c AND znsls400.t$pecl$c = znsls401.t$pecl$c AND znsls400.t$sqpd$c = znsls401.t$sqpd$c INNER JOIN baandb.ttccom130301 tccom130 ON tccom130.t$cadr = cisli940.t$itoa$l INNER JOIN baandb.ttcibd001301 tcibd001 ON tcibd001.t$item = cisli941.t$item$l LEFT JOIN baandb.ttcmcs060301 tcmcs060 ON tcmcs060.t$cmnf = tcibd001.t$cmnf LEFT JOIN baandb.ttccom130301 tccom130f ON tccom130f.t$cadr = tcmcs060.t$cadr LEFT JOIN baandb.ttcmcs966301 tcmcs966 ON tcmcs966.t$fdtc$l = cisli940.t$fdtc$l LEFT JOIN ( SELECT d.t$cnst CNST, l.t$desc DESC_TIPO_DOCTO FROM baandb.tttadv401000 d, baandb.tttadv140000 l WHERE d.t$cpac = 'ci' AND d.t$cdom = 'sli.tdff.l' AND l.t$clan = 'p' AND l.t$cpac = 'ci' AND l.t$clab = d.t$za_clab AND rpad(d.t$vers,4) || rpad(d.t$rele,2) || rpad(d.t$cust,4) = ( select max(rpad(l1.t$vers,4) || rpad(l1.t$rele,2) || rpad(l1.t$cust,4)) from baandb.tttadv401000 l1 where l1.t$cpac = d.t$cpac and l1.t$cdom = d.t$cdom ) AND rpad(l.t$vers,4) || rpad(l.t$rele,2) || rpad(l.t$cust,4) = ( select max(rpad(l1.t$vers,4) || rpad(l1.t$rele,2) || rpad(l1.t$cust,4)) from baandb.tttadv140000 l1 where l1.t$clab = l.t$clab and l1.t$clan = l.t$clan and l1.t$cpac = l.t$cpac ) ) FGET ON cisli940.t$fdty$l = FGET.CNST LEFT JOIN WMWHSE7.ORDERS@DL_LN_WMS WMS_OA_ORDERS_SH ON SUBSTR(WMS_OA_ORDERS_SH.EXTERNORDERKEY,5,9) = CISLI245.T$SHPM LEFT JOIN ( select MAX(a.ORDERKEY) ORDERKEY, MAX(a.TYPE) TYPE, a.REFERENCEDOCUMENT from WMWHSE7.ORDERS@DL_LN_WMS a group by a.REFERENCEDOCUMENT ) WMS_OA_ORDERS_OA ON SUBSTR(WMS_OA_ORDERS_OA.REFERENCEDOCUMENT,4,9) = CISLI245.T$SLSO LEFT JOIN ( select MAX(a.ORDERKEY) ORDERKEY, MAX(a.TYPE) TYPE, a.REFERENCEDOCUMENT from WMWHSE7.ORDERS@DL_LN_WMS a group by a.REFERENCEDOCUMENT ) WMS_OA_ORDERS_OV ON WMS_OA_ORDERS_OV.REFERENCEDOCUMENT = CISLI245.T$SLSO LEFT JOIN WMWHSE7.CODELKUP@DL_LN_WMS CODELKUP_SH ON CODELKUP_SH.LISTNAME = 'ORDERTYPE' AND CODELKUP_SH.CODE = WMS_OA_ORDERS_SH.TYPE LEFT JOIN WMWHSE7.CODELKUP@DL_LN_WMS CODELKUP_OA ON CODELKUP_OA.LISTNAME = 'ORDERTYPE' AND CODELKUP_OA.CODE = WMS_OA_ORDERS_OA.TYPE LEFT JOIN WMWHSE7.CODELKUP@DL_LN_WMS CODELKUP_OV ON CODELKUP_OV.LISTNAME = 'ORDERTYPE' AND CODELKUP_OV.CODE = WMS_OA_ORDERS_OV.TYPE LEFT JOIN baandb.tznsls000301 znsls000 ON znsls000.t$indt$c = TO_DATE('01-01-1970','DD-MM-YYYY') WHERE cisli940.t$fdty$l != 11 AND cisli940.t$docn$l != 0 AND cisli940.t$stat$l NOT IN (2, 101) AND cisli941.t$item$l != znsls000.t$itmd$c AND cisli941.t$item$l != znsls000.t$itmf$c AND cisli941.t$item$l != znsls000.t$itjl$c AND cisli940.t$fdty$l != 14 AND Trunc(CAST((FROM_TZ(TO_TIMESTAMP(TO_CHAR(cisli940.t$date$l, 'DD-MON-YYYY HH24:MI:SS'), 'DD-MON-YYYY HH24:MI:SS'), 'GMT') AT time zone 'America/Sao_Paulo') AS DATE)) Between '" + Parameters!EmissaoDe.Value + "' AND '" + Parameters!EmissaoAte.Value + "' GROUP BY FILIAL.DSC_FILIAL, cisli940.t$docn$l, cisli940.t$seri$l, NVL(WMS_OA_ORDERS_SH.ORDERKEY, NVL(WMS_OA_ORDERS_OV.ORDERKEY, WMS_OA_ORDERS_OA.ORDERKEY)), NVL(WMS_OA_ORDERS_SH.REFERENCEDOCUMENT, NVL(WMS_OA_ORDERS_OV.REFERENCEDOCUMENT, WMS_OA_ORDERS_OA.REFERENCEDOCUMENT)), NVL(CODELKUP_SH.DESCRIPTION, NVL(CODELKUP_OV.DESCRIPTION, CODELKUP_OA.DESCRIPTION)), CAST((FROM_TZ(TO_TIMESTAMP(TO_CHAR(cisli940.t$date$l, 'DD-MON-YYYY HH24:MI:SS'), 'DD-MON-YYYY HH24:MI:SS'), 'GMT') AT time zone 'America/Sao_Paulo') AS DATE), cisli940.t$ccfo$l, cisli940.t$opor$l, tcmcs940.t$dsca$l, znsls400.t$idca$c, TRIM(cisli941.t$item$l), tcibd001.t$dsca , CASE WHEN cisli941.t$iprt$l = 0 THEN round(tdsls401.t$pric,2) ELSE round(cisli941.t$pric$l,2) END, CASE WHEN cisli941.t$gamt$l = 0 THEN round(tdsls401.t$pric,2) ELSE round(cisli941.t$gamt$l,2) END, cisli940.t$itbp$l, cisli940.t$itbn$l, tccom130.t$namc, tccom130.t$dist$l, tccom130.t$pstc, tccom130.t$dsca, tccom130.t$cste, tccom130.t$telp, tccom130.t$telx, tccom130.t$enfs$l, cisli940.t$fdtc$l, tcmcs966.t$dsca$l, FGET.DESC_TIPO_DOCTO, tccom130f.t$fovn$l, tcmcs060.t$dsca, Q1.CMV_UNIT  " &
"     ORDER BY FILIAL, DT_EMISSAO, NF  "
	
)


--eHub**************************************************************************************************************************************************

= IIF(Parameters!Table.Value <> "AAA", 

" SELECT FILIAL.DSC_FILIAL FILIAL, cisli940.t$docn$l NF, cisli940.t$seri$l SERIE, NVL(WMS_OA_ORDERS_SH.ORDERKEY, NVL(WMS_OA_ORDERS_OV.ORDERKEY, WMS_OA_ORDERS_OA.ORDERKEY)) PEDIDO_WMS, NVL(WMS_OA_ORDERS_SH.REFERENCEDOCUMENT, NVL(WMS_OA_ORDERS_OV.REFERENCEDOCUMENT, WMS_OA_ORDERS_OA.REFERENCEDOCUMENT)) ORDEM_MOVIMENTACAO, NVL(CODELKUP_SH.DESCRIPTION, NVL(CODELKUP_OV.DESCRIPTION, CODELKUP_OA.DESCRIPTION)) DESCRICAO_PEDIDO, CAST((FROM_TZ(TO_TIMESTAMP(TO_CHAR(cisli940.t$date$l, 'DD-MON-YYYY HH24:MI:SS'), 'DD-MON-YYYY HH24:MI:SS'), 'GMT') AT time zone 'America/Sao_Paulo') AS DATE) DT_EMISSAO, cisli940.t$ccfo$l CFO, cisli940.t$opor$l SEQ_CFO, tcmcs940.t$dsca$l NOME_CFO, znsls400.t$idca$c CANAL, TRIM(cisli941.t$item$l) ID_ITEM, tcibd001.t$dsca NOME_ITEM, sum(cisli941.t$dqua$l) QTD_FATURADA, CASE WHEN cisli941.t$iprt$l = 0 THEN round(tdsls401.t$pric,2) ELSE round(cisli941.t$pric$l,2) END VL_PRODUTO, CASE WHEN sum(cisli941.t$amnt$l) = 0 THEN sum(tdsls401.t$oamt) ELSE sum(cisli941.t$amnt$l) END VL_TOTAL_ITEM, CASE WHEN cisli941.t$gamt$l = 0 THEN round(tdsls401.t$pric,2) ELSE round(cisli941.t$gamt$l,2) END VL_MERCADORIA, CASE WHEN sum(cisli941.t$fght$l) = 0 THEN sum(nvl(znsls401.t$vlfr$c,0)) ELSE sum(cisli941.t$fght$l) END VL_FRETE, CASE WHEN sum(cisli941.t$ldam$l) = 0 THEN sum(nvl(znsls401.t$vlde$c,0)) ELSE sum(cisli941.t$ldam$l) END VL_DESC_INC, sum( NVL(( select sum(cisli943.t$amnt$l) from baandb.tcisli943" + IIF(Parameters!Table.Value = "WMWHSE9","601","602") + " cisli943 where cisli943.t$fire$l = cisli941.t$fire$l and cisli943.t$LINE$l = cisli941.t$LINE$l and cisli943.t$brty$l = 1 ), 0) )VL_ICMS, sum( NVL(( select sum(cisli943.t$amnt$l) from baandb.tcisli943" + IIF(Parameters!Table.Value = "WMWHSE9","601","602") + " cisli943 where cisli943.t$fire$l = cisli941.t$fire$l and cisli943.t$line$l = cisli941.t$line$l and cisli943.t$brty$l = 5 ), 0) )VL_PIS, sum( NVL(( select sum(cisli943.t$amnt$l) from baandb.tcisli943" + IIF(Parameters!Table.Value = "WMWHSE9","601","602") + " cisli943 where cisli943.t$fire$l = cisli941.t$fire$l and cisli943.t$line$l = cisli941.t$line$l and cisli943.t$brty$l = 6 ), 0) )VL_COFINS, cisli940.t$itbp$l ID_CLIENTE, cisli940.t$itbn$l NOME_CLIENTE, tccom130.t$namc ENDERECO, tccom130.t$dist$l BAIRRO, tccom130.t$pstc CEP, tccom130.t$dsca MUNICIPIO, tccom130.t$cste UF, tccom130.t$telp TEL1, tccom130.t$telx TEL2, tccom130.t$enfs$l EMAIL, cisli940.t$fdtc$l ID_TIPO_DOC_FIS, tcmcs966.t$dsca$l DESCR_TIPO_DOC_FIS, FGET.DESC_TIPO_DOCTO DESC_TIPO_DOCTO, tccom130f.t$fovn$l CNPJ_FABRICANTE, tcmcs060.t$dsca NOME_FABRICANTE, Q1.CMV_UNIT FROM baandb.tcisli940" + IIF(Parameters!Table.Value = "WMWHSE9","601","602") + " cisli940 INNER JOIN ( select tcemm030.t$eunt CHAVE_FILIAL, tcemm030.t$dsca DSC_FILIAL, tcemm124.t$cwoc from baandb.ttcemm124" + IIF(Parameters!Table.Value = "WMWHSE9","601","602") + " tcemm124, baandb.ttcemm030" + IIF(Parameters!Table.Value = "WMWHSE9","601","602") + " tcemm030 where tcemm030.t$eunt = tcemm124.t$grid and tcemm124.t$loco = " + IIF(Parameters!Table.Value = "WMWHSE9","601","602") + " ) FILIAL ON FILIAL.t$cwoc = cisli940.t$cofc$l LEFT JOIN baandb.ttcmcs940" + IIF(Parameters!Table.Value = "WMWHSE9","601","602") + " tcmcs940 ON tcmcs940.T$OFSO$L = cisli940.t$ccfo$l INNER JOIN baandb.tcisli941" + IIF(Parameters!Table.Value = "WMWHSE9","601","602") + " cisli941 ON cisli941.t$fire$l = cisli940.t$fire$l LEFT JOIN ( select whwmd217.t$item, whwmd217.t$cwar, case when ( max(whwmd215.t$qhnd) - max(whwmd215.t$qchd) - max(whwmd215.t$qnhd) ) = 0 then 0 else round(sum(whwmd217.t$mauc$1) / (max(whwmd215.t$qhnd) - max(whwmd215.t$qchd) - max(whwmd215.t$qnhd)), 4) end CMV_UNIT from baandb.twhwmd217" + IIF(Parameters!Table.Value = "WMWHSE9","601","602") + " whwmd217 inner join baandb.twhwmd215" + IIF(Parameters!Table.Value = "WMWHSE9","601","602") + " whwmd215 on whwmd215.t$cwar = whwmd217.t$cwar and whwmd215.t$item = whwmd217.t$item group by whwmd217.t$item, whwmd217.t$cwar ) Q1 ON Q1.t$item = cisli941.t$item$l AND Q1.t$cwar = cisli941.t$cwar$l INNER JOIN baandb.tcisli245" + IIF(Parameters!Table.Value = "WMWHSE9","601","602") + " cisli245 ON cisli245.t$fire$l = cisli941.t$fire$l AND cisli245.t$line$l = cisli941.t$line$l LEFT JOIN baandb.tznsls401" + IIF(Parameters!Table.Value = "WMWHSE9","601","602") + " znsls401 ON znsls401.t$orno$c = cisli245.t$slso AND znsls401.t$pono$c = cisli245.t$pono LEFT JOIN baandb.ttdsls401" + IIF(Parameters!Table.Value = "WMWHSE9","601","602") + " tdsls401 ON tdsls401.t$orno = cisli245.t$slso AND tdsls401.t$pono = cisli245.t$pono LEFT JOIN baandb.tznsls400" + IIF(Parameters!Table.Value = "WMWHSE9","601","602") + " znsls400 ON znsls400.t$ncia$c = znsls401.t$ncia$c AND znsls400.t$uneg$c = znsls401.t$uneg$c AND znsls400.t$pecl$c = znsls401.t$pecl$c AND znsls400.t$sqpd$c = znsls401.t$sqpd$c INNER JOIN baandb.ttccom130" + IIF(Parameters!Table.Value = "WMWHSE9","601","602") + " tccom130 ON tccom130.t$cadr = cisli940.t$itoa$l INNER JOIN baandb.ttcibd001" + IIF(Parameters!Table.Value = "WMWHSE9","601","602") + " tcibd001 ON tcibd001.t$item = cisli941.t$item$l LEFT JOIN baandb.ttcmcs060" + IIF(Parameters!Table.Value = "WMWHSE9","601","602") + " tcmcs060 ON tcmcs060.t$cmnf = tcibd001.t$cmnf LEFT JOIN baandb.ttccom130" + IIF(Parameters!Table.Value = "WMWHSE9","601","602") + " tccom130f ON tccom130f.t$cadr = tcmcs060.t$cadr LEFT JOIN baandb.ttcmcs966" + IIF(Parameters!Table.Value = "WMWHSE9","601","602") + " tcmcs966 ON tcmcs966.t$fdtc$l = cisli940.t$fdtc$l LEFT JOIN ( SELECT d.t$cnst CNST, l.t$desc DESC_TIPO_DOCTO FROM baandb.tttadv401000 d, baandb.tttadv140000 l WHERE d.t$cpac = 'ci' AND d.t$cdom = 'sli.tdff.l' AND l.t$clan = 'p' AND l.t$cpac = 'ci' AND l.t$clab = d.t$za_clab AND rpad(d.t$vers,4) || rpad(d.t$rele,2) || rpad(d.t$cust,4) = ( select max(rpad(l1.t$vers,4) || rpad(l1.t$rele,2) || rpad(l1.t$cust,4)) from baandb.tttadv401000 l1 where l1.t$cpac = d.t$cpac and l1.t$cdom = d.t$cdom ) AND rpad(l.t$vers,4) || rpad(l.t$rele,2) || rpad(l.t$cust,4) = ( select max(rpad(l1.t$vers,4) || rpad(l1.t$rele,2) || rpad(l1.t$cust,4)) from baandb.tttadv140000 l1 where l1.t$clab = l.t$clab and l1.t$clan = l.t$clan and l1.t$cpac = l.t$cpac ) ) FGET ON cisli940.t$fdty$l = FGET.CNST LEFT JOIN " + Parameters!Table.Value + ".ORDERS@DL_LN_WMS WMS_OA_ORDERS_SH ON SUBSTR(WMS_OA_ORDERS_SH.EXTERNORDERKEY,5,9) = CISLI245.T$SHPM LEFT JOIN ( select MAX(a.ORDERKEY) ORDERKEY, MAX(a.TYPE) TYPE, a.REFERENCEDOCUMENT from " + Parameters!Table.Value + ".ORDERS@DL_LN_WMS a group by a.REFERENCEDOCUMENT ) WMS_OA_ORDERS_OA ON SUBSTR(WMS_OA_ORDERS_OA.REFERENCEDOCUMENT,4,9) = CISLI245.T$SLSO LEFT JOIN ( select MAX(a.ORDERKEY) ORDERKEY, MAX(a.TYPE) TYPE, a.REFERENCEDOCUMENT from " + Parameters!Table.Value + ".ORDERS@DL_LN_WMS a group by a.REFERENCEDOCUMENT ) WMS_OA_ORDERS_OV ON WMS_OA_ORDERS_OV.REFERENCEDOCUMENT = CISLI245.T$SLSO LEFT JOIN " + Parameters!Table.Value + ".CODELKUP@DL_LN_WMS CODELKUP_SH ON CODELKUP_SH.LISTNAME = 'ORDERTYPE' AND CODELKUP_SH.CODE = WMS_OA_ORDERS_SH.TYPE LEFT JOIN " + Parameters!Table.Value + ".CODELKUP@DL_LN_WMS CODELKUP_OA ON CODELKUP_OA.LISTNAME = 'ORDERTYPE' AND CODELKUP_OA.CODE = WMS_OA_ORDERS_OA.TYPE LEFT JOIN " + Parameters!Table.Value + ".CODELKUP@DL_LN_WMS CODELKUP_OV ON CODELKUP_OV.LISTNAME = 'ORDERTYPE' AND CODELKUP_OV.CODE = WMS_OA_ORDERS_OV.TYPE LEFT JOIN baandb.tznsls000" + IIF(Parameters!Table.Value = "WMWHSE9","601","602") + " znsls000 ON znsls000.t$indt$c = TO_DATE('01-01-1970','DD-MM-YYYY') WHERE cisli940.t$fdty$l != 11 AND cisli940.t$docn$l != 0 AND cisli940.t$stat$l NOT IN (2, 101) AND cisli941.t$item$l != znsls000.t$itmd$c AND cisli941.t$item$l != znsls000.t$itmf$c AND cisli941.t$item$l != znsls000.t$itjl$c AND cisli940.t$fdty$l != 14 AND Trunc(CAST((FROM_TZ(TO_TIMESTAMP(TO_CHAR(cisli940.t$date$l, 'DD-MON-YYYY HH24:MI:SS'), 'DD-MON-YYYY HH24:MI:SS'), 'GMT') AT time zone 'America/Sao_Paulo') AS DATE)) Between '" + Parameters!EmissaoDe.Value + "' AND '" + Parameters!EmissaoAte.Value + "' GROUP BY FILIAL.DSC_FILIAL, cisli940.t$docn$l, cisli940.t$seri$l, NVL(WMS_OA_ORDERS_SH.ORDERKEY, NVL(WMS_OA_ORDERS_OV.ORDERKEY, WMS_OA_ORDERS_OA.ORDERKEY)), NVL(WMS_OA_ORDERS_SH.REFERENCEDOCUMENT, NVL(WMS_OA_ORDERS_OV.REFERENCEDOCUMENT, WMS_OA_ORDERS_OA.REFERENCEDOCUMENT)), NVL(CODELKUP_SH.DESCRIPTION, NVL(CODELKUP_OV.DESCRIPTION, CODELKUP_OA.DESCRIPTION)), CAST((FROM_TZ(TO_TIMESTAMP(TO_CHAR(cisli940.t$date$l, 'DD-MON-YYYY HH24:MI:SS'), 'DD-MON-YYYY HH24:MI:SS'), 'GMT') AT time zone 'America/Sao_Paulo') AS DATE), cisli940.t$ccfo$l, cisli940.t$opor$l, tcmcs940.t$dsca$l, znsls400.t$idca$c, TRIM(cisli941.t$item$l), tcibd001.t$dsca , CASE WHEN cisli941.t$iprt$l = 0 THEN round(tdsls401.t$pric,2) ELSE round(cisli941.t$pric$l,2) END, CASE WHEN cisli941.t$gamt$l = 0 THEN round(tdsls401.t$pric,2) ELSE round(cisli941.t$gamt$l,2) END, cisli940.t$itbp$l, cisli940.t$itbn$l, tccom130.t$namc, tccom130.t$dist$l, tccom130.t$pstc, tccom130.t$dsca, tccom130.t$cste, tccom130.t$telp, tccom130.t$telx, tccom130.t$enfs$l, cisli940.t$fdtc$l, tcmcs966.t$dsca$l, FGET.DESC_TIPO_DOCTO, tccom130f.t$fovn$l, tcmcs060.t$dsca, Q1.CMV_UNIT ORDER BY FILIAL, DT_EMISSAO, NF "

,
 
"       SELECT FILIAL.DSC_FILIAL FILIAL, cisli940.t$docn$l NF, cisli940.t$seri$l SERIE, NVL(WMS_OA_ORDERS_SH.ORDERKEY, NVL(WMS_OA_ORDERS_OV.ORDERKEY, WMS_OA_ORDERS_OA.ORDERKEY)) PEDIDO_WMS, NVL(WMS_OA_ORDERS_SH.REFERENCEDOCUMENT, NVL(WMS_OA_ORDERS_OV.REFERENCEDOCUMENT, WMS_OA_ORDERS_OA.REFERENCEDOCUMENT)) ORDEM_MOVIMENTACAO, NVL(CODELKUP_SH.DESCRIPTION, NVL(CODELKUP_OV.DESCRIPTION, CODELKUP_OA.DESCRIPTION)) DESCRICAO_PEDIDO, CAST((FROM_TZ(TO_TIMESTAMP(TO_CHAR(cisli940.t$date$l, 'DD-MON-YYYY HH24:MI:SS'), 'DD-MON-YYYY HH24:MI:SS'), 'GMT') AT time zone 'America/Sao_Paulo') AS DATE) DT_EMISSAO, cisli940.t$ccfo$l CFO, cisli940.t$opor$l SEQ_CFO, tcmcs940.t$dsca$l NOME_CFO, znsls400.t$idca$c CANAL, TRIM(cisli941.t$item$l) ID_ITEM, tcibd001.t$dsca NOME_ITEM, sum(cisli941.t$dqua$l) QTD_FATURADA, CASE WHEN cisli941.t$iprt$l = 0 THEN round(tdsls401.t$pric,2) ELSE round(cisli941.t$pric$l,2) END VL_PRODUTO, CASE WHEN sum(cisli941.t$amnt$l) = 0 THEN sum(tdsls401.t$oamt) ELSE sum(cisli941.t$amnt$l) END VL_TOTAL_ITEM, CASE WHEN cisli941.t$gamt$l = 0 THEN round(tdsls401.t$pric,2) ELSE round(cisli941.t$gamt$l,2) END VL_MERCADORIA, CASE WHEN sum(cisli941.t$fght$l) = 0 THEN sum(nvl(znsls401.t$vlfr$c,0)) ELSE sum(cisli941.t$fght$l) END VL_FRETE, CASE WHEN sum(cisli941.t$ldam$l) = 0 THEN sum(nvl(znsls401.t$vlde$c,0)) ELSE sum(cisli941.t$ldam$l) END VL_DESC_INC, sum( NVL(( select sum(cisli943.t$amnt$l) from baandb.tcisli943601 cisli943 where cisli943.t$fire$l = cisli941.t$fire$l and cisli943.t$LINE$l = cisli941.t$LINE$l and cisli943.t$brty$l = 1 ), 0) )VL_ICMS, sum( NVL(( select sum(cisli943.t$amnt$l) from baandb.tcisli943601 cisli943 where cisli943.t$fire$l = cisli941.t$fire$l and cisli943.t$line$l = cisli941.t$line$l and cisli943.t$brty$l = 5 ), 0) )VL_PIS, sum( NVL(( select sum(cisli943.t$amnt$l) from baandb.tcisli943601 cisli943 where cisli943.t$fire$l = cisli941.t$fire$l and cisli943.t$line$l = cisli941.t$line$l and cisli943.t$brty$l = 6 ), 0) )VL_COFINS, cisli940.t$itbp$l ID_CLIENTE, cisli940.t$itbn$l NOME_CLIENTE, tccom130.t$namc ENDERECO, tccom130.t$dist$l BAIRRO, tccom130.t$pstc CEP, tccom130.t$dsca MUNICIPIO, tccom130.t$cste UF, tccom130.t$telp TEL1, tccom130.t$telx TEL2, tccom130.t$enfs$l EMAIL, cisli940.t$fdtc$l ID_TIPO_DOC_FIS, tcmcs966.t$dsca$l DESCR_TIPO_DOC_FIS, FGET.DESC_TIPO_DOCTO DESC_TIPO_DOCTO, tccom130f.t$fovn$l CNPJ_FABRICANTE, tcmcs060.t$dsca NOME_FABRICANTE, Q1.CMV_UNIT FROM baandb.tcisli940601 cisli940 INNER JOIN ( select tcemm030.t$eunt CHAVE_FILIAL, tcemm030.t$dsca DSC_FILIAL, tcemm124.t$cwoc from baandb.ttcemm124601 tcemm124, baandb.ttcemm030601 tcemm030 where tcemm030.t$eunt = tcemm124.t$grid and tcemm124.t$loco = 601 ) FILIAL ON FILIAL.t$cwoc = cisli940.t$cofc$l LEFT JOIN baandb.ttcmcs940601 tcmcs940 ON tcmcs940.T$OFSO$L = cisli940.t$ccfo$l INNER JOIN baandb.tcisli941601 cisli941 ON cisli941.t$fire$l = cisli940.t$fire$l LEFT JOIN ( select whwmd217.t$item, whwmd217.t$cwar, case when ( max(whwmd215.t$qhnd) - max(whwmd215.t$qchd) - max(whwmd215.t$qnhd) ) = 0 then 0 else round(sum(whwmd217.t$mauc$1) / (max(whwmd215.t$qhnd) - max(whwmd215.t$qchd) - max(whwmd215.t$qnhd)), 4) end CMV_UNIT from baandb.twhwmd217601 whwmd217 inner join baandb.twhwmd215601 whwmd215 on whwmd215.t$cwar = whwmd217.t$cwar and whwmd215.t$item = whwmd217.t$item group by whwmd217.t$item, whwmd217.t$cwar ) Q1 ON Q1.t$item = cisli941.t$item$l AND Q1.t$cwar = cisli941.t$cwar$l INNER JOIN baandb.tcisli245601 cisli245 ON cisli245.t$fire$l = cisli941.t$fire$l AND cisli245.t$line$l = cisli941.t$line$l LEFT JOIN baandb.tznsls401601 znsls401 ON znsls401.t$orno$c = cisli245.t$slso AND znsls401.t$pono$c = cisli245.t$pono LEFT JOIN baandb.ttdsls401601 tdsls401 ON tdsls401.t$orno = cisli245.t$slso AND tdsls401.t$pono = cisli245.t$pono LEFT JOIN baandb.tznsls400601 znsls400 ON znsls400.t$ncia$c = znsls401.t$ncia$c AND znsls400.t$uneg$c = znsls401.t$uneg$c AND znsls400.t$pecl$c = znsls401.t$pecl$c AND znsls400.t$sqpd$c = znsls401.t$sqpd$c INNER JOIN baandb.ttccom130601 tccom130 ON tccom130.t$cadr = cisli940.t$itoa$l INNER JOIN baandb.ttcibd001601 tcibd001 ON tcibd001.t$item = cisli941.t$item$l LEFT JOIN baandb.ttcmcs060601 tcmcs060 ON tcmcs060.t$cmnf = tcibd001.t$cmnf LEFT JOIN baandb.ttccom130601 tccom130f ON tccom130f.t$cadr = tcmcs060.t$cadr LEFT JOIN baandb.ttcmcs966601 tcmcs966 ON tcmcs966.t$fdtc$l = cisli940.t$fdtc$l LEFT JOIN ( SELECT d.t$cnst CNST, l.t$desc DESC_TIPO_DOCTO FROM baandb.tttadv401000 d, baandb.tttadv140000 l WHERE d.t$cpac = 'ci' AND d.t$cdom = 'sli.tdff.l' AND l.t$clan = 'p' AND l.t$cpac = 'ci' AND l.t$clab = d.t$za_clab AND rpad(d.t$vers,4) || rpad(d.t$rele,2) || rpad(d.t$cust,4) = ( select max(rpad(l1.t$vers,4) || rpad(l1.t$rele,2) || rpad(l1.t$cust,4)) from baandb.tttadv401000 l1 where l1.t$cpac = d.t$cpac and l1.t$cdom = d.t$cdom ) AND rpad(l.t$vers,4) || rpad(l.t$rele,2) || rpad(l.t$cust,4) = ( select max(rpad(l1.t$vers,4) || rpad(l1.t$rele,2) || rpad(l1.t$cust,4)) from baandb.tttadv140000 l1 where l1.t$clab = l.t$clab and l1.t$clan = l.t$clan and l1.t$cpac = l.t$cpac ) ) FGET ON cisli940.t$fdty$l = FGET.CNST LEFT JOIN WMWHSE9.ORDERS@DL_LN_WMS WMS_OA_ORDERS_SH ON SUBSTR(WMS_OA_ORDERS_SH.EXTERNORDERKEY,5,9) = CISLI245.T$SHPM LEFT JOIN ( select MAX(a.ORDERKEY) ORDERKEY, MAX(a.TYPE) TYPE, a.REFERENCEDOCUMENT from WMWHSE9.ORDERS@DL_LN_WMS a group by a.REFERENCEDOCUMENT ) WMS_OA_ORDERS_OA ON SUBSTR(WMS_OA_ORDERS_OA.REFERENCEDOCUMENT,4,9) = CISLI245.T$SLSO LEFT JOIN ( select MAX(a.ORDERKEY) ORDERKEY, MAX(a.TYPE) TYPE, a.REFERENCEDOCUMENT from WMWHSE9.ORDERS@DL_LN_WMS a group by a.REFERENCEDOCUMENT ) WMS_OA_ORDERS_OV ON WMS_OA_ORDERS_OV.REFERENCEDOCUMENT = CISLI245.T$SLSO LEFT JOIN WMWHSE9.CODELKUP@DL_LN_WMS CODELKUP_SH ON CODELKUP_SH.LISTNAME = 'ORDERTYPE' AND CODELKUP_SH.CODE = WMS_OA_ORDERS_SH.TYPE LEFT JOIN WMWHSE9.CODELKUP@DL_LN_WMS CODELKUP_OA ON CODELKUP_OA.LISTNAME = 'ORDERTYPE' AND CODELKUP_OA.CODE = WMS_OA_ORDERS_OA.TYPE LEFT JOIN WMWHSE9.CODELKUP@DL_LN_WMS CODELKUP_OV ON CODELKUP_OV.LISTNAME = 'ORDERTYPE' AND CODELKUP_OV.CODE = WMS_OA_ORDERS_OV.TYPE LEFT JOIN baandb.tznsls000601 znsls000 ON znsls000.t$indt$c = TO_DATE('01-01-1970','DD-MM-YYYY') WHERE cisli940.t$fdty$l != 11 AND cisli940.t$docn$l != 0 AND cisli940.t$stat$l NOT IN (2, 101) AND cisli941.t$item$l != znsls000.t$itmd$c AND cisli941.t$item$l != znsls000.t$itmf$c AND cisli941.t$item$l != znsls000.t$itjl$c AND cisli940.t$fdty$l != 14 AND Trunc(CAST((FROM_TZ(TO_TIMESTAMP(TO_CHAR(cisli940.t$date$l, 'DD-MON-YYYY HH24:MI:SS'), 'DD-MON-YYYY HH24:MI:SS'), 'GMT') AT time zone 'America/Sao_Paulo') AS DATE)) Between '" + Parameters!EmissaoDe.Value + "' AND '" + Parameters!EmissaoAte.Value + "' GROUP BY FILIAL.DSC_FILIAL, cisli940.t$docn$l, cisli940.t$seri$l, NVL(WMS_OA_ORDERS_SH.ORDERKEY, NVL(WMS_OA_ORDERS_OV.ORDERKEY, WMS_OA_ORDERS_OA.ORDERKEY)), NVL(WMS_OA_ORDERS_SH.REFERENCEDOCUMENT, NVL(WMS_OA_ORDERS_OV.REFERENCEDOCUMENT, WMS_OA_ORDERS_OA.REFERENCEDOCUMENT)), NVL(CODELKUP_SH.DESCRIPTION, NVL(CODELKUP_OV.DESCRIPTION, CODELKUP_OA.DESCRIPTION)), CAST((FROM_TZ(TO_TIMESTAMP(TO_CHAR(cisli940.t$date$l, 'DD-MON-YYYY HH24:MI:SS'), 'DD-MON-YYYY HH24:MI:SS'), 'GMT') AT time zone 'America/Sao_Paulo') AS DATE), cisli940.t$ccfo$l, cisli940.t$opor$l, tcmcs940.t$dsca$l, znsls400.t$idca$c, TRIM(cisli941.t$item$l), tcibd001.t$dsca , CASE WHEN cisli941.t$iprt$l = 0 THEN round(tdsls401.t$pric,2) ELSE round(cisli941.t$pric$l,2) END, CASE WHEN cisli941.t$gamt$l = 0 THEN round(tdsls401.t$pric,2) ELSE round(cisli941.t$gamt$l,2) END, cisli940.t$itbp$l, cisli940.t$itbn$l, tccom130.t$namc, tccom130.t$dist$l, tccom130.t$pstc, tccom130.t$dsca, tccom130.t$cste, tccom130.t$telp, tccom130.t$telx, tccom130.t$enfs$l, cisli940.t$fdtc$l, tcmcs966.t$dsca$l, FGET.DESC_TIPO_DOCTO, tccom130f.t$fovn$l, tcmcs060.t$dsca, Q1.CMV_UNIT " &
" Union SELECT FILIAL.DSC_FILIAL FILIAL, cisli940.t$docn$l NF, cisli940.t$seri$l SERIE, NVL(WMS_OA_ORDERS_SH.ORDERKEY, NVL(WMS_OA_ORDERS_OV.ORDERKEY, WMS_OA_ORDERS_OA.ORDERKEY)) PEDIDO_WMS, NVL(WMS_OA_ORDERS_SH.REFERENCEDOCUMENT, NVL(WMS_OA_ORDERS_OV.REFERENCEDOCUMENT, WMS_OA_ORDERS_OA.REFERENCEDOCUMENT)) ORDEM_MOVIMENTACAO, NVL(CODELKUP_SH.DESCRIPTION, NVL(CODELKUP_OV.DESCRIPTION, CODELKUP_OA.DESCRIPTION)) DESCRICAO_PEDIDO, CAST((FROM_TZ(TO_TIMESTAMP(TO_CHAR(cisli940.t$date$l, 'DD-MON-YYYY HH24:MI:SS'), 'DD-MON-YYYY HH24:MI:SS'), 'GMT') AT time zone 'America/Sao_Paulo') AS DATE) DT_EMISSAO, cisli940.t$ccfo$l CFO, cisli940.t$opor$l SEQ_CFO, tcmcs940.t$dsca$l NOME_CFO, znsls400.t$idca$c CANAL, TRIM(cisli941.t$item$l) ID_ITEM, tcibd001.t$dsca NOME_ITEM, sum(cisli941.t$dqua$l) QTD_FATURADA, CASE WHEN cisli941.t$iprt$l = 0 THEN round(tdsls401.t$pric,2) ELSE round(cisli941.t$pric$l,2) END VL_PRODUTO, CASE WHEN sum(cisli941.t$amnt$l) = 0 THEN sum(tdsls401.t$oamt) ELSE sum(cisli941.t$amnt$l) END VL_TOTAL_ITEM, CASE WHEN cisli941.t$gamt$l = 0 THEN round(tdsls401.t$pric,2) ELSE round(cisli941.t$gamt$l,2) END VL_MERCADORIA, CASE WHEN sum(cisli941.t$fght$l) = 0 THEN sum(nvl(znsls401.t$vlfr$c,0)) ELSE sum(cisli941.t$fght$l) END VL_FRETE, CASE WHEN sum(cisli941.t$ldam$l) = 0 THEN sum(nvl(znsls401.t$vlde$c,0)) ELSE sum(cisli941.t$ldam$l) END VL_DESC_INC, sum( NVL(( select sum(cisli943.t$amnt$l) from baandb.tcisli943602 cisli943 where cisli943.t$fire$l = cisli941.t$fire$l and cisli943.t$LINE$l = cisli941.t$LINE$l and cisli943.t$brty$l = 1 ), 0) )VL_ICMS, sum( NVL(( select sum(cisli943.t$amnt$l) from baandb.tcisli943602 cisli943 where cisli943.t$fire$l = cisli941.t$fire$l and cisli943.t$line$l = cisli941.t$line$l and cisli943.t$brty$l = 5 ), 0) )VL_PIS, sum( NVL(( select sum(cisli943.t$amnt$l) from baandb.tcisli943602 cisli943 where cisli943.t$fire$l = cisli941.t$fire$l and cisli943.t$line$l = cisli941.t$line$l and cisli943.t$brty$l = 6 ), 0) )VL_COFINS, cisli940.t$itbp$l ID_CLIENTE, cisli940.t$itbn$l NOME_CLIENTE, tccom130.t$namc ENDERECO, tccom130.t$dist$l BAIRRO, tccom130.t$pstc CEP, tccom130.t$dsca MUNICIPIO, tccom130.t$cste UF, tccom130.t$telp TEL1, tccom130.t$telx TEL2, tccom130.t$enfs$l EMAIL, cisli940.t$fdtc$l ID_TIPO_DOC_FIS, tcmcs966.t$dsca$l DESCR_TIPO_DOC_FIS, FGET.DESC_TIPO_DOCTO DESC_TIPO_DOCTO, tccom130f.t$fovn$l CNPJ_FABRICANTE, tcmcs060.t$dsca NOME_FABRICANTE, Q1.CMV_UNIT FROM baandb.tcisli940602 cisli940 INNER JOIN ( select tcemm030.t$eunt CHAVE_FILIAL, tcemm030.t$dsca DSC_FILIAL, tcemm124.t$cwoc from baandb.ttcemm124602 tcemm124, baandb.ttcemm030602 tcemm030 where tcemm030.t$eunt = tcemm124.t$grid and tcemm124.t$loco = 602 ) FILIAL ON FILIAL.t$cwoc = cisli940.t$cofc$l LEFT JOIN baandb.ttcmcs940602 tcmcs940 ON tcmcs940.T$OFSO$L = cisli940.t$ccfo$l INNER JOIN baandb.tcisli941602 cisli941 ON cisli941.t$fire$l = cisli940.t$fire$l LEFT JOIN ( select whwmd217.t$item, whwmd217.t$cwar, case when ( max(whwmd215.t$qhnd) - max(whwmd215.t$qchd) - max(whwmd215.t$qnhd) ) = 0 then 0 else round(sum(whwmd217.t$mauc$1) / (max(whwmd215.t$qhnd) - max(whwmd215.t$qchd) - max(whwmd215.t$qnhd)), 4) end CMV_UNIT from baandb.twhwmd217602 whwmd217 inner join baandb.twhwmd215602 whwmd215 on whwmd215.t$cwar = whwmd217.t$cwar and whwmd215.t$item = whwmd217.t$item group by whwmd217.t$item, whwmd217.t$cwar ) Q1 ON Q1.t$item = cisli941.t$item$l AND Q1.t$cwar = cisli941.t$cwar$l INNER JOIN baandb.tcisli245602 cisli245 ON cisli245.t$fire$l = cisli941.t$fire$l AND cisli245.t$line$l = cisli941.t$line$l LEFT JOIN baandb.tznsls401602 znsls401 ON znsls401.t$orno$c = cisli245.t$slso AND znsls401.t$pono$c = cisli245.t$pono LEFT JOIN baandb.ttdsls401602 tdsls401 ON tdsls401.t$orno = cisli245.t$slso AND tdsls401.t$pono = cisli245.t$pono LEFT JOIN baandb.tznsls400602 znsls400 ON znsls400.t$ncia$c = znsls401.t$ncia$c AND znsls400.t$uneg$c = znsls401.t$uneg$c AND znsls400.t$pecl$c = znsls401.t$pecl$c AND znsls400.t$sqpd$c = znsls401.t$sqpd$c INNER JOIN baandb.ttccom130602 tccom130 ON tccom130.t$cadr = cisli940.t$itoa$l INNER JOIN baandb.ttcibd001602 tcibd001 ON tcibd001.t$item = cisli941.t$item$l LEFT JOIN baandb.ttcmcs060602 tcmcs060 ON tcmcs060.t$cmnf = tcibd001.t$cmnf LEFT JOIN baandb.ttccom130602 tccom130f ON tccom130f.t$cadr = tcmcs060.t$cadr LEFT JOIN baandb.ttcmcs966602 tcmcs966 ON tcmcs966.t$fdtc$l = cisli940.t$fdtc$l LEFT JOIN ( SELECT d.t$cnst CNST, l.t$desc DESC_TIPO_DOCTO FROM baandb.tttadv401000 d, baandb.tttadv140000 l WHERE d.t$cpac = 'ci' AND d.t$cdom = 'sli.tdff.l' AND l.t$clan = 'p' AND l.t$cpac = 'ci' AND l.t$clab = d.t$za_clab AND rpad(d.t$vers,4) || rpad(d.t$rele,2) || rpad(d.t$cust,4) = ( select max(rpad(l1.t$vers,4) || rpad(l1.t$rele,2) || rpad(l1.t$cust,4)) from baandb.tttadv401000 l1 where l1.t$cpac = d.t$cpac and l1.t$cdom = d.t$cdom ) AND rpad(l.t$vers,4) || rpad(l.t$rele,2) || rpad(l.t$cust,4) = ( select max(rpad(l1.t$vers,4) || rpad(l1.t$rele,2) || rpad(l1.t$cust,4)) from baandb.tttadv140000 l1 where l1.t$clab = l.t$clab and l1.t$clan = l.t$clan and l1.t$cpac = l.t$cpac ) ) FGET ON cisli940.t$fdty$l = FGET.CNST LEFT JOIN WMWHSE10.ORDERS@DL_LN_WMS WMS_OA_ORDERS_SH ON SUBSTR(WMS_OA_ORDERS_SH.EXTERNORDERKEY,5,9) = CISLI245.T$SHPM LEFT JOIN ( select MAX(a.ORDERKEY) ORDERKEY, MAX(a.TYPE) TYPE, a.REFERENCEDOCUMENT from WMWHSE10.ORDERS@DL_LN_WMS a group by a.REFERENCEDOCUMENT ) WMS_OA_ORDERS_OA ON SUBSTR(WMS_OA_ORDERS_OA.REFERENCEDOCUMENT,4,9) = CISLI245.T$SLSO LEFT JOIN ( select MAX(a.ORDERKEY) ORDERKEY, MAX(a.TYPE) TYPE, a.REFERENCEDOCUMENT from WMWHSE10.ORDERS@DL_LN_WMS a group by a.REFERENCEDOCUMENT ) WMS_OA_ORDERS_OV ON WMS_OA_ORDERS_OV.REFERENCEDOCUMENT = CISLI245.T$SLSO LEFT JOIN WMWHSE10.CODELKUP@DL_LN_WMS CODELKUP_SH ON CODELKUP_SH.LISTNAME = 'ORDERTYPE' AND CODELKUP_SH.CODE = WMS_OA_ORDERS_SH.TYPE LEFT JOIN WMWHSE10.CODELKUP@DL_LN_WMS CODELKUP_OA ON CODELKUP_OA.LISTNAME = 'ORDERTYPE' AND CODELKUP_OA.CODE = WMS_OA_ORDERS_OA.TYPE LEFT JOIN WMWHSE10.CODELKUP@DL_LN_WMS CODELKUP_OV ON CODELKUP_OV.LISTNAME = 'ORDERTYPE' AND CODELKUP_OV.CODE = WMS_OA_ORDERS_OV.TYPE LEFT JOIN baandb.tznsls000602 znsls000 ON znsls000.t$indt$c = TO_DATE('01-01-1970','DD-MM-YYYY') WHERE cisli940.t$fdty$l != 11 AND cisli940.t$docn$l != 0 AND cisli940.t$stat$l NOT IN (2, 101) AND cisli941.t$item$l != znsls000.t$itmd$c AND cisli941.t$item$l != znsls000.t$itmf$c AND cisli941.t$item$l != znsls000.t$itjl$c AND cisli940.t$fdty$l != 14 AND Trunc(CAST((FROM_TZ(TO_TIMESTAMP(TO_CHAR(cisli940.t$date$l, 'DD-MON-YYYY HH24:MI:SS'), 'DD-MON-YYYY HH24:MI:SS'), 'GMT') AT time zone 'America/Sao_Paulo') AS DATE)) Between '" + Parameters!EmissaoDe.Value + "' AND '" + Parameters!EmissaoAte.Value + "' GROUP BY FILIAL.DSC_FILIAL, cisli940.t$docn$l, cisli940.t$seri$l, NVL(WMS_OA_ORDERS_SH.ORDERKEY, NVL(WMS_OA_ORDERS_OV.ORDERKEY, WMS_OA_ORDERS_OA.ORDERKEY)), NVL(WMS_OA_ORDERS_SH.REFERENCEDOCUMENT, NVL(WMS_OA_ORDERS_OV.REFERENCEDOCUMENT, WMS_OA_ORDERS_OA.REFERENCEDOCUMENT)), NVL(CODELKUP_SH.DESCRIPTION, NVL(CODELKUP_OV.DESCRIPTION, CODELKUP_OA.DESCRIPTION)), CAST((FROM_TZ(TO_TIMESTAMP(TO_CHAR(cisli940.t$date$l, 'DD-MON-YYYY HH24:MI:SS'), 'DD-MON-YYYY HH24:MI:SS'), 'GMT') AT time zone 'America/Sao_Paulo') AS DATE), cisli940.t$ccfo$l, cisli940.t$opor$l, tcmcs940.t$dsca$l, znsls400.t$idca$c, TRIM(cisli941.t$item$l), tcibd001.t$dsca , CASE WHEN cisli941.t$iprt$l = 0 THEN round(tdsls401.t$pric,2) ELSE round(cisli941.t$pric$l,2) END, CASE WHEN cisli941.t$gamt$l = 0 THEN round(tdsls401.t$pric,2) ELSE round(cisli941.t$gamt$l,2) END, cisli940.t$itbp$l, cisli940.t$itbn$l, tccom130.t$namc, tccom130.t$dist$l, tccom130.t$pstc, tccom130.t$dsca, tccom130.t$cste, tccom130.t$telp, tccom130.t$telx, tccom130.t$enfs$l, cisli940.t$fdtc$l, tcmcs966.t$dsca$l, FGET.DESC_TIPO_DOCTO, tccom130f.t$fovn$l, tcmcs060.t$dsca, Q1.CMV_UNIT  " &
"     ORDER BY FILIAL, DT_EMISSAO, NF  "
	
)