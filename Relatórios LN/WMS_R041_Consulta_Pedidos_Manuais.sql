SELECT    
    FILIAL.DSC_FILIAL                              FILIAL,
    cisli940.t$docn$l                              NF,
    cisli940.t$seri$l                              SERIE,

    NVL(WMS_OA_ORDERS_SH.ORDERKEY, 
        NVL(WMS_OA_ORDERS_OV.ORDERKEY, 
            WMS_OA_ORDERS_OA.ORDERKEY))            PEDIDO_WMS,

    NVL(WMS_OA_ORDERS_SH.REFERENCEDOCUMENT, 
        NVL(WMS_OA_ORDERS_OV.REFERENCEDOCUMENT, 
            WMS_OA_ORDERS_OA.REFERENCEDOCUMENT))   ORDEM_MOVIMENTACAO,
   
    NVL(CODELKUP_SH.DESCRIPTION, 
        NVL(CODELKUP_OV.DESCRIPTION, 
            CODELKUP_OA.DESCRIPTION))              DESCRICAO_PEDIDO,
   
    CAST((FROM_TZ(TO_TIMESTAMP(TO_CHAR(cisli940.t$date$l, 
      'DD-MON-YYYY HH24:MI:SS'), 'DD-MON-YYYY HH24:MI:SS'), 'GMT')
        AT time zone 'America/Sao_Paulo') AS DATE) DT_EMISSAO,
            
    cisli940.t$ccfo$l                              CFO,
    cisli940.t$opor$l                              SEQ_CFO,    
    tcmcs940.t$dsca$l                              NOME_CFO,
    znsls400.t$idca$c                              CANAL,
    TRIM(cisli941.t$item$l)                        ID_ITEM,
    tcibd001.t$dsca                                NOME_ITEM,
    sum(cisli941.t$dqua$l)                         QTD_FATURADA,
 
    CASE WHEN cisli941.t$iprt$l = 0 
           THEN round(tdsls401.t$pric,2) 
         ELSE   round(cisli941.t$pric$l,2)
     END                                           VL_PRODUTO,
  
    CASE WHEN sum(cisli941.t$amnt$l) = 0 
           THEN sum(tdsls401.t$oamt) 
         ELSE   sum(cisli941.t$amnt$l)
     END                                           VL_TOTAL_ITEM,
  
    CASE WHEN cisli941.t$gamt$l = 0 
           THEN round(tdsls401.t$pric,2) 
         ELSE   round(cisli941.t$gamt$l,2)
     END                                           VL_MERCADORIA,
  
    CASE WHEN sum(cisli941.t$fght$l) = 0 
           THEN sum(nvl(znsls401.t$vlfr$c,0)) 
         ELSE   sum(cisli941.t$fght$l)
     END                                           VL_FRETE,
 
    CASE WHEN sum(cisli941.t$ldam$l) = 0 
           THEN sum(nvl(znsls401.t$vlde$c,0)) 
         ELSE   sum(cisli941.t$ldam$l) 
     END                                           VL_DESC_INC,
    
    sum( NVL(( select sum(cisli943.t$amnt$l) 
                 from baandb.tcisli943301 cisli943
                where cisli943.t$fire$l = cisli941.t$fire$l
                  and cisli943.t$LINE$l = cisli941.t$LINE$l
                  and cisli943.t$brty$l = 1 ), 0) )VL_ICMS,
    
    sum( NVL(( select sum(cisli943.t$amnt$l) 
                 from baandb.tcisli943301 cisli943
                where cisli943.t$fire$l = cisli941.t$fire$l
                  and cisli943.t$line$l = cisli941.t$line$l
                  and cisli943.t$brty$l = 5 ), 0) )VL_PIS,
    
    sum( NVL(( select sum(cisli943.t$amnt$l) 
                 from baandb.tcisli943301 cisli943
                where cisli943.t$fire$l = cisli941.t$fire$l
                  and cisli943.t$line$l = cisli941.t$line$l
                  and cisli943.t$brty$l = 6 ), 0) )VL_COFINS,
    case when cisli940.t$itbp$l = ' ' then
        cisli940.t$ifbp$l
    else  cisli940.t$itbp$l end                    ID_CLIENTE,
    case when cisli940.t$itbn$l = ' ' then
          cisli940.t$ifbn$l
    else  cisli940.t$itbn$l end                    NOME_CLIENTE,
    nvl(tccom130.t$namc,tccom130d.t$namc)          ENDERECO,
    nvl(tccom130.t$dist$l,tccom130d.t$dist$l)      BAIRRO,
    nvl(tccom130.t$pstc,tccom130d.t$pstc)          CEP,
    nvl(tccom130.t$dsca,tccom130d.t$dsca)          MUNICIPIO,
    nvl(tccom130.t$cste,tccom130d.t$cste)          UF,
    nvl(tccom130.t$telp,tccom130d.t$telp)          TEL1,
    nvl(tccom130.t$telx,tccom130d.t$telx)          TEL2,
    nvl(tccom130.t$enfs$l,tccom130d.t$enfs$l)       EMAIL,
    cisli940.t$fdtc$l                              ID_TIPO_DOC_FIS,
    tcmcs966.t$dsca$l                              DESCR_TIPO_DOC_FIS,
    FGET.DESC_TIPO_DOCTO                           DESC_TIPO_DOCTO,
    tccom130f.t$fovn$l                             CNPJ_FABRICANTE,
    tcmcs060.t$dsca                                NOME_FABRICANTE,
    Q1.CMV_UNIT
                             
FROM       baandb.tcisli940301 cisli940

INNER JOIN ( select tcemm030.t$eunt CHAVE_FILIAL,
                    tcemm030.t$dsca DSC_FILIAL,
                    tcemm124.t$cwoc
               from baandb.ttcemm124301 tcemm124, 
                    baandb.ttcemm030301 tcemm030
              where tcemm030.t$eunt = tcemm124.t$grid
                and tcemm124.t$loco = 301 ) FILIAL
        ON FILIAL.t$cwoc = cisli940.t$cofc$l 

 LEFT JOIN baandb.ttcmcs940301 tcmcs940 
        ON tcmcs940.T$OFSO$L = cisli940.t$ccfo$l

INNER JOIN baandb.tcisli941301 cisli941
        ON cisli941.t$fire$l = cisli940.t$fire$l
  
 LEFT JOIN ( select whwmd217.t$item,
                    whwmd217.t$cwar,
                    case when ( max(whwmd215.t$qhnd) - 
                                max(whwmd215.t$qchd) - 
                                max(whwmd215.t$qnhd) ) = 0 
                           then 0
                         else round(sum(whwmd217.t$mauc$1) /
                                   (max(whwmd215.t$qhnd) - max(whwmd215.t$qchd) - max(whwmd215.t$qnhd)), 4) 
                    end cmv_unit
               from baandb.twhwmd217301 whwmd217
         inner join baandb.twhwmd215301 whwmd215
                 on whwmd215.t$cwar = whwmd217.t$cwar
                and whwmd215.t$item = whwmd217.t$item
           group by whwmd217.t$item, whwmd217.t$cwar ) Q1
        ON Q1.t$item = cisli941.t$item$l 
       AND Q1.t$cwar = cisli941.t$cwar$l
  
 LEFT JOIN baandb.tcisli245301 cisli245                --era INNER
        ON cisli245.t$fire$l = cisli941.t$fire$l
       AND cisli245.t$line$l = cisli941.t$line$l

 LEFT JOIN baandb.tcisli951301 cisli951             --Devolucao de fornecedor
        ON cisli951.t$fire$l = cisli941.t$fire$l
       AND cisli951.t$line$l = cisli941.t$line$l

 LEFT JOIN baandb.tznsls401301 znsls401
        ON znsls401.t$orno$c = cisli245.t$slso
       AND znsls401.t$pono$c = cisli245.t$pono
    
 LEFT JOIN baandb.ttdsls401301 tdsls401 
        ON tdsls401.t$orno = cisli245.t$slso 
       AND tdsls401.t$pono = cisli245.t$pono 
        
 LEFT JOIN baandb.tznsls400301 znsls400
        ON znsls400.t$ncia$c = znsls401.t$ncia$c
       AND znsls400.t$uneg$c = znsls401.t$uneg$c
       AND znsls400.t$pecl$c = znsls401.t$pecl$c
       AND znsls400.t$sqpd$c = znsls401.t$sqpd$c
  
 LEFT JOIN baandb.ttccom130301 tccom130       
        ON tccom130.t$cadr  = cisli940.t$itoa$l

 LEFT JOIN baandb.ttccom130301 tccom130d              --NOTAS DE DEVOLUCAO VENDA/COMPRA
        ON tccom130d.t$cadr  = cisli940.t$IFBA$l
        
INNER JOIN baandb.ttcibd001301 tcibd001
        ON tcibd001.t$item  = cisli941.t$item$l
  
 LEFT JOIN baandb.ttcmcs060301 tcmcs060
        ON tcmcs060.t$cmnf  = tcibd001.t$cmnf

 LEFT JOIN baandb.ttccom130301 tccom130f
        ON tccom130f.t$cadr  = tcmcs060.t$cadr  
  
 LEFT JOIN baandb.ttcmcs966301 tcmcs966
        ON tcmcs966.t$fdtc$l = cisli940.t$fdtc$l
  
 LEFT JOIN ( SELECT d.t$cnst CNST, l.t$desc DESC_TIPO_DOCTO
               FROM baandb.tttadv401000 d, 
                    baandb.tttadv140000 l 
              WHERE d.t$cpac = 'ci' 
                AND d.t$cdom = 'sli.tdff.l'
                AND l.t$clan = 'p'
                AND l.t$cpac = 'ci'
                AND l.t$clab = d.t$za_clab
                AND rpad(d.t$vers,4) ||
                    rpad(d.t$rele,2) ||
                    rpad(d.t$cust,4) = ( select max(rpad(l1.t$vers,4) ||
                                                    rpad(l1.t$rele,2) ||
                                                    rpad(l1.t$cust,4)) 
                                           from baandb.tttadv401000 l1 
                                          where l1.t$cpac = d.t$cpac 
                                            and l1.t$cdom = d.t$cdom )
                AND rpad(l.t$vers,4) ||
                    rpad(l.t$rele,2) ||
                    rpad(l.t$cust,4) = ( select max(rpad(l1.t$vers,4) ||
                                                    rpad(l1.t$rele,2) || 
                                                    rpad(l1.t$cust,4)) 
                                           from baandb.tttadv140000 l1 
                                          where l1.t$clab = l.t$clab 
                                            and l1.t$clan = l.t$clan 
                                            and l1.t$cpac = l.t$cpac ) ) FGET
        ON cisli940.t$fdty$l = FGET.CNST
  
INNER JOIN WMWHSE8.ORDERS@DL_LN_WMS WMS_OA_ORDERS_SH  
        ON SUBSTR(WMS_OA_ORDERS_SH.EXTERNORDERKEY,5,9) = nvl(CISLI245.T$SHPM,cisli951.t$shpm$l)
               
 LEFT JOIN ( select MAX(a.ORDERKEY) ORDERKEY,
                    MAX(a.TYPE) TYPE,
                    a.REFERENCEDOCUMENT
               from WMWHSE8.ORDERS@DL_LN_WMS a 
             group by a.REFERENCEDOCUMENT ) WMS_OA_ORDERS_OA
        ON SUBSTR(WMS_OA_ORDERS_OA.REFERENCEDOCUMENT,4,9) = nvl(CISLI245.T$SLSO,cisli951.t$slso$l)       
        
  LEFT JOIN ( select MAX(a.ORDERKEY) ORDERKEY,
                     MAX(a.TYPE) TYPE,
                     a.REFERENCEDOCUMENT
                from WMWHSE8.ORDERS@DL_LN_WMS a
            group by a.REFERENCEDOCUMENT ) WMS_OA_ORDERS_OV
         ON WMS_OA_ORDERS_OV.REFERENCEDOCUMENT = nvl(CISLI245.T$SLSO,cisli951.t$slso$l)
        
 LEFT JOIN WMWHSE8.CODELKUP@DL_LN_WMS CODELKUP_SH
        ON CODELKUP_SH.LISTNAME = 'ORDERTYPE'
       AND CODELKUP_SH.CODE = WMS_OA_ORDERS_SH.TYPE
       
 LEFT JOIN WMWHSE8.CODELKUP@DL_LN_WMS CODELKUP_OA
        ON CODELKUP_OA.LISTNAME = 'ORDERTYPE'
       AND CODELKUP_OA.CODE = WMS_OA_ORDERS_OA.TYPE

 LEFT JOIN WMWHSE8.CODELKUP@DL_LN_WMS CODELKUP_OV
        ON CODELKUP_OV.LISTNAME = 'ORDERTYPE'
       AND CODELKUP_OV.CODE = WMS_OA_ORDERS_OV.TYPE
       
 LEFT JOIN baandb.tznsls000301 znsls000
        ON znsls000.t$indt$c = TO_DATE('01-01-1970','DD-MM-YYYY')
                 
WHERE cisli940.t$fdty$l NOT IN  (11, 14)
  AND cisli940.t$stat$l NOT IN (2, 101)
  AND cisli940.t$docn$l != 0
  AND cisli941.t$item$l != znsls000.t$itmd$c
  AND cisli941.t$item$l != znsls000.t$itmf$c
  AND cisli941.t$item$l != znsls000.t$itjl$c

--and cisli940.t$fire$l = '004247034'

  AND FILIAL.CHAVE_FILIAL = :Filial

  AND Trunc(CAST((FROM_TZ(TO_TIMESTAMP(TO_CHAR(cisli940.t$date$l, 
                'DD-MON-YYYY HH24:MI:SS'), 'DD-MON-YYYY HH24:MI:SS'), 'GMT')
                  AT time zone 'America/Sao_Paulo') AS DATE)) 
        Between :EmissaoDe
            And :EmissaoAte

GROUP BY FILIAL.DSC_FILIAL,
         cisli940.t$docn$l,                  
         cisli940.t$seri$l,                  
      NVL(WMS_OA_ORDERS_SH.ORDERKEY, 
             NVL(WMS_OA_ORDERS_OV.ORDERKEY, 
                 WMS_OA_ORDERS_OA.ORDERKEY)),
         
      NVL(WMS_OA_ORDERS_SH.REFERENCEDOCUMENT, 
             NVL(WMS_OA_ORDERS_OV.REFERENCEDOCUMENT, 
                 WMS_OA_ORDERS_OA.REFERENCEDOCUMENT)),
        
      NVL(CODELKUP_SH.DESCRIPTION, 
             NVL(CODELKUP_OV.DESCRIPTION, 
                 CODELKUP_OA.DESCRIPTION)),
         CAST((FROM_TZ(TO_TIMESTAMP(TO_CHAR(cisli940.t$date$l, 
           'DD-MON-YYYY HH24:MI:SS'), 'DD-MON-YYYY HH24:MI:SS'), 'GMT')
             AT time zone 'America/Sao_Paulo') AS DATE), 
         cisli940.t$ccfo$l,                  
         cisli940.t$opor$l,                  
         tcmcs940.t$dsca$l,                  
         znsls400.t$idca$c,                  
         TRIM(cisli941.t$item$l),            
         tcibd001.t$dsca ,                   
         CASE WHEN cisli941.t$iprt$l = 0 
                THEN round(tdsls401.t$pric,2) 
              ELSE   round(cisli941.t$pric$l,2)
          END,                               
         CASE WHEN cisli941.t$gamt$l = 0 
                THEN round(tdsls401.t$pric,2) 
              ELSE   round(cisli941.t$gamt$l,2)
          END,                               
         cisli940.t$itbp$l,
         cisli940.t$ifbp$l,
         cisli940.t$itbn$l,
         cisli940.t$ifbn$l,
         nvl(tccom130.t$namc,tccom130d.t$namc),
         nvl(tccom130.t$dist$l,tccom130d.t$dist$l),
         nvl(tccom130.t$pstc,tccom130d.t$pstc),                      
         nvl(tccom130.t$dsca,tccom130d.t$dsca),                      
         nvl(tccom130.t$cste,tccom130d.t$cste),                      
         nvl(tccom130.t$telp,tccom130d.t$telp),                      
         nvl(tccom130.t$telx,tccom130d.t$telx),                      
         nvl(tccom130.t$enfs$l,tccom130d.t$enfs$l),                    
         cisli940.t$fdtc$l,                    
         tcmcs966.t$dsca$l,                    
         FGET.DESC_TIPO_DOCTO,                 
         tccom130f.t$fovn$l,               
         tcmcs060.t$dsca,
         Q1.CMV_UNIT,
         
         WMS_OA_ORDERS_SH.ORDERKEY,
         WMS_OA_ORDERS_OV.orderkey,
         WMS_OA_ORDERS_OA.orderkey,
         CISLI245.T$SHPM,
         cisli951.t$shpm$l,
         CISLI245.T$SLSO,
         cisli951.t$slso$l
   
 ORDER BY FILIAL, 
          DT_EMISSAO, 
          NF

--B2C***************************************************************************************************************************************************
=

=
"      SELECT FILIAL.DSC_FILIAL FILIAL,sli940.t$docn$l NF,sli940.t$seri$l SERIE,NVL(ORDERS_SH.ORDERKEY,NVL(ORDERS_OV.ORDERKEY,ORDERS_OA.ORDERKEY)) PEDIDO_WMS,NVL(ORDERS_SH.REFERENCEDOCUMENT,NVL(ORDERS_OV.REFERENCEDOCUMENT,ORDERS_OA.REFERENCEDOCUMENT)) ORDEM_MOVIMENTACAO,NVL(CODELKUP_SH.DESCRIPTION,NVL(CODELKUP_OV.DESCRIPTION,CODELKUP_OA.DESCRIPTION)) DESCRICAO_PEDIDO,CAST((FROM_TZ(TO_TIMESTAMP(TO_CHAR(sli940.t$date$l,'DD-MON-YYYY HH24:MI:SS'),'DD-MON-YYYY HH24:MI:SS'),'GMT') AT time zone 'America/Sao_Paulo') AS DATE) DT_EMISSAO,sli940.t$ccfo$l CFO,sli940.t$opor$l SEQ_CFO,mcs940.t$dsca$l NOME_CFO,sls400.t$idca$c CANAL,TRIM(sli941.t$item$l) ID_ITEM,tcibd001.t$dsca NOME_ITEM,sum(sli941.t$dqua$l) QTD_FATURADA,CASE WHEN sli941.t$iprt$l=0 THEN round(tdsls401.t$pric,2) ELSE round(sli941.t$pric$l,2) END VL_PRODUTO,CASE WHEN sum(sli941.t$amnt$l)=0 THEN sum(tdsls401.t$oamt) ELSE sum(sli941.t$amnt$l) END VL_TOTAL_ITEM,CASE WHEN sli941.t$gamt$l=0 THEN round(tdsls401.t$pric,2) ELSE round(sli941.t$gamt$l,2) END VL_MERCADORIA,CASE WHEN sum(sli941.t$fght$l)=0 THEN sum(nvl(znsls401.t$vlfr$c,0)) ELSE sum(sli941.t$fght$l) END VL_FRETE,CASE WHEN sum(sli941.t$ldam$l)=0 THEN sum(nvl(znsls401.t$vlde$c,0)) ELSE sum(sli941.t$ldam$l) END VL_DESC_INC,sum(NVL((select sum(cisli943.t$amnt$l) from baandb.tcisli943301 cisli943 where cisli943.t$fire$l=sli941.t$fire$l and cisli943.t$LINE$l=sli941.t$LINE$l and cisli943.t$brty$l=1),0))VL_ICMS,sum(NVL((select sum(cisli943.t$amnt$l) from baandb.tcisli943301 cisli943 where cisli943.t$fire$l=sli941.t$fire$l and cisli943.t$line$l=sli941.t$line$l and cisli943.t$brty$l=5),0))VL_PIS,sum(NVL((select sum(cisli943.t$amnt$l) from baandb.tcisli943301 cisli943 where cisli943.t$fire$l=sli941.t$fire$l and cisli943.t$line$l=sli941.t$line$l and cisli943.t$brty$l=6),0))VL_COFINS,case when sli940.t$itbp$l=' ' then sli940.t$ifbp$l else sli940.t$itbp$l end ID_CLIENTE,case when sli940.t$itbn$l=' ' then sli940.t$ifbn$l else sli940.t$itbn$l end NOME_CLIENTE,nvl(tccom130.t$namc,tccom130d.t$namc) ENDERECO,nvl(tccom130.t$dist$l,tccom130d.t$dist$l) BAIRRO,nvl(tccom130.t$pstc,tccom130d.t$pstc) CEP,nvl(tccom130.t$dsca,tccom130d.t$dsca) MUNICIPIO,nvl(tccom130.t$cste,tccom130d.t$cste) UF,nvl(tccom130.t$telp,tccom130d.t$telp) TEL1,nvl(tccom130.t$telx,tccom130d.t$telx) TEL2,nvl(tccom130.t$enfs$l,tccom130d.t$enfs$l) EMAIL,sli940.t$fdtc$l ID_TIPO_DOC_FIS,tcmcs966.t$dsca$l DESCR_TIPO_DOC_FIS,FGET.DESC_TIPO_DOCTO DESC_TIPO_DOCTO,tccom130f.t$fovn$l CNPJ_FABRICANTE,tcmcs060.t$dsca NOME_FABRICANTE,Q1.CMV_UNIT FROM baandb.tcisli940301 sli940 INNER JOIN (select emm030.t$eunt CHAVE_FILIAL,emm030.t$dsca DSC_FILIAL,emm124.t$cwoc from baandb.ttcemm124301 emm124,baandb.ttcemm030301 emm030 where emm030.t$eunt=emm124.t$grid and emm124.t$loco=301) FILIAL ON FILIAL.t$cwoc=sli940.t$cofc$l LEFT JOIN baandb.ttcmcs940301 mcs940 ON mcs940.T$OFSO$L=sli940.t$ccfo$l INNER JOIN baandb.tcisli941301 sli941 ON sli941.t$fire$l=sli940.t$fire$l LEFT JOIN (select whwmd217.t$item,whwmd217.t$cwar,case when (max(whwmd215.t$qhnd) - max(whwmd215.t$qchd) - max(whwmd215.t$qnhd))=0 then 0 else round(sum(whwmd217.t$mauc$1) / (max(whwmd215.t$qhnd) - max(whwmd215.t$qchd) - max(whwmd215.t$qnhd)),4) end cmv_unit from baandb.twhwmd217301 whwmd217 inner join baandb.twhwmd215301 whwmd215 on whwmd215.t$cwar=whwmd217.t$cwar and whwmd215.t$item=whwmd217.t$item group by whwmd217.t$item,whwmd217.t$cwar) Q1 ON Q1.t$item=sli941.t$item$l AND Q1.t$cwar=sli941.t$cwar$l LEFT JOIN baandb.tcisli245301 cisli245 ON cisli245.t$fire$l=sli941.t$fire$l AND cisli245.t$line$l=sli941.t$line$l LEFT JOIN baandb.tcisli951301 cisli951 ON cisli951.t$fire$l=sli941.t$fire$l AND cisli951.t$line$l=sli941.t$line$l LEFT JOIN baandb.tznsls401301 znsls401 ON znsls401.t$orno$c=cisli245.t$slso AND znsls401.t$pono$c=cisli245.t$pono LEFT JOIN baandb.ttdsls401301 tdsls401 ON tdsls401.t$orno=cisli245.t$slso AND tdsls401.t$pono=cisli245.t$pono LEFT JOIN baandb.tznsls400301 sls400 ON sls400.t$ncia$c=znsls401.t$ncia$c AND sls400.t$uneg$c=znsls401.t$uneg$c AND sls400.t$pecl$c=znsls401.t$pecl$c AND sls400.t$sqpd$c=znsls401.t$sqpd$c LEFT JOIN baandb.ttccom130301 tccom130 ON tccom130.t$cadr=sli940.t$itoa$l LEFT JOIN baandb.ttccom130301 tccom130d ON tccom130d.t$cadr=sli940.t$IFBA$l INNER JOIN baandb.ttcibd001301 tcibd001 ON tcibd001.t$item=sli941.t$item$l LEFT JOIN baandb.ttcmcs060301 tcmcs060 ON tcmcs060.t$cmnf=tcibd001.t$cmnf LEFT JOIN baandb.ttccom130301 tccom130f ON tccom130f.t$cadr=tcmcs060.t$cadr LEFT JOIN baandb.ttcmcs966301 tcmcs966 ON tcmcs966.t$fdtc$l=sli940.t$fdtc$l LEFT JOIN (SELECT d.t$cnst CNST,l.t$desc DESC_TIPO_DOCTO FROM baandb.tttadv401000 d,baandb.tttadv140000 l WHERE d.t$cpac='ci' AND d.t$cdom='sli.tdff.l' AND l.t$clan='p' AND l.t$cpac='ci' AND l.t$clab=d.t$za_clab AND rpad(d.t$vers,4) || rpad(d.t$rele,2) || rpad(d.t$cust,4)=(select max(rpad(l1.t$vers,4) || rpad(l1.t$rele,2) || rpad(l1.t$cust,4)) from baandb.tttadv401000 l1 where l1.t$cpac=d.t$cpac and l1.t$cdom=d.t$cdom) AND rpad(l.t$vers,4) || rpad(l.t$rele,2) || rpad(l.t$cust,4)=(select max(rpad(l1.t$vers,4) || rpad(l1.t$rele,2) || rpad(l1.t$cust,4)) from baandb.tttadv140000 l1 where l1.t$clab=l.t$clab and l1.t$clan=l.t$clan and l1.t$cpac=l.t$cpac)) FGET ON sli940.t$fdty$l=FGET.CNST INNER JOIN WMWHSE1.ORDERS@DL_LN_WMS ORDERS_SH ON SUBSTR(ORDERS_SH.EXTERNORDERKEY,5,9)=nvl(CISLI245.T$SHPM,cisli951.t$shpm$l) LEFT JOIN (select MAX(a.ORDERKEY) ORDERKEY,MAX(a.TYPE) TYPE,a.REFERENCEDOCUMENT from WMWHSE1.ORDERS@DL_LN_WMS a group by a.REFERENCEDOCUMENT) ORDERS_OA ON SUBSTR(ORDERS_OA.REFERENCEDOCUMENT,4,9)=nvl(CISLI245.T$SLSO,cisli951.t$slso$l) LEFT JOIN (select MAX(a.ORDERKEY) ORDERKEY,MAX(a.TYPE) TYPE,a.REFERENCEDOCUMENT from WMWHSE1.ORDERS@DL_LN_WMS a group by a.REFERENCEDOCUMENT) ORDERS_OV ON ORDERS_OV.REFERENCEDOCUMENT=nvl(CISLI245.T$SLSO,cisli951.t$slso$l) LEFT JOIN WMWHSE1.CODELKUP@DL_LN_WMS CODELKUP_SH ON CODELKUP_SH.LISTNAME='ORDERTYPE' AND CODELKUP_SH.CODE=ORDERS_SH.TYPE LEFT JOIN WMWHSE1.CODELKUP@DL_LN_WMS CODELKUP_OA ON CODELKUP_OA.LISTNAME='ORDERTYPE' AND CODELKUP_OA.CODE=ORDERS_OA.TYPE LEFT JOIN WMWHSE1.CODELKUP@DL_LN_WMS CODELKUP_OV ON CODELKUP_OV.LISTNAME='ORDERTYPE' AND CODELKUP_OV.CODE=ORDERS_OV.TYPE LEFT JOIN baandb.tznsls000301 znsls000 ON znsls000.t$indt$c=TO_DATE('01-01-1970','DD-MM-YYYY') WHERE sli940.t$fdty$l NOT IN (11,14) AND sli940.t$stat$l NOT IN (2,101) AND sli940.t$docn$l !=0 AND sli941.t$item$l !=znsls000.t$itmd$c AND sli941.t$item$l !=znsls000.t$itmf$c AND sli941.t$item$l !=znsls000.t$itjl$c AND FILIAL.CHAVE_FILIAL='" + Parameters!Filial.Value + "' AND Trunc(CAST((FROM_TZ(TO_TIMESTAMP(TO_CHAR(sli940.t$date$l,'DD-MON-YYYY HH24:MI:SS'),'DD-MON-YYYY HH24:MI:SS'),'GMT') AT time zone 'America/Sao_Paulo') AS DATE)) Between '" + Parameters!EmissaoDe.Value + "' And '" + Parameters!EmissaoAte.Value + "' GROUP BY FILIAL.DSC_FILIAL,sli940.t$docn$l,sli940.t$seri$l,NVL(ORDERS_SH.ORDERKEY,NVL(ORDERS_OV.ORDERKEY,ORDERS_OA.ORDERKEY)),NVL(ORDERS_SH.REFERENCEDOCUMENT,NVL(ORDERS_OV.REFERENCEDOCUMENT,ORDERS_OA.REFERENCEDOCUMENT)),NVL(CODELKUP_SH.DESCRIPTION,NVL(CODELKUP_OV.DESCRIPTION,CODELKUP_OA.DESCRIPTION)),CAST((FROM_TZ(TO_TIMESTAMP(TO_CHAR(sli940.t$date$l,'DD-MON-YYYY HH24:MI:SS'),'DD-MON-YYYY HH24:MI:SS'),'GMT') AT time zone 'America/Sao_Paulo') AS DATE),sli940.t$ccfo$l,sli940.t$opor$l,mcs940.t$dsca$l,sls400.t$idca$c,TRIM(sli941.t$item$l),tcibd001.t$dsca ,CASE WHEN sli941.t$iprt$l=0 THEN round(tdsls401.t$pric,2) ELSE round(sli941.t$pric$l,2) END,CASE WHEN sli941.t$gamt$l=0 THEN round(tdsls401.t$pric,2) ELSE round(sli941.t$gamt$l,2) END,sli940.t$itbp$l,sli940.t$ifbp$l,sli940.t$itbn$l,sli940.t$ifbn$l,nvl(tccom130.t$namc,tccom130d.t$namc),nvl(tccom130.t$dist$l,tccom130d.t$dist$l),nvl(tccom130.t$pstc,tccom130d.t$pstc),nvl(tccom130.t$dsca,tccom130d.t$dsca),nvl(tccom130.t$cste,tccom130d.t$cste),nvl(tccom130.t$telp,tccom130d.t$telp),nvl(tccom130.t$telx,tccom130d.t$telx),nvl(tccom130.t$enfs$l,tccom130d.t$enfs$l),sli940.t$fdtc$l,tcmcs966.t$dsca$l,FGET.DESC_TIPO_DOCTO,tccom130f.t$fovn$l,tcmcs060.t$dsca,Q1.CMV_UNIT,ORDERS_SH.ORDERKEY,ORDERS_OV.orderkey,ORDERS_OA.orderkey,CISLI245.T$SHPM,cisli951.t$shpm$l,CISLI245.T$SLSO,cisli951.t$slso$l " &
"Union SELECT FILIAL.DSC_FILIAL FILIAL,sli940.t$docn$l NF,sli940.t$seri$l SERIE,NVL(ORDERS_SH.ORDERKEY,NVL(ORDERS_OV.ORDERKEY,ORDERS_OA.ORDERKEY)) PEDIDO_WMS,NVL(ORDERS_SH.REFERENCEDOCUMENT,NVL(ORDERS_OV.REFERENCEDOCUMENT,ORDERS_OA.REFERENCEDOCUMENT)) ORDEM_MOVIMENTACAO,NVL(CODELKUP_SH.DESCRIPTION,NVL(CODELKUP_OV.DESCRIPTION,CODELKUP_OA.DESCRIPTION)) DESCRICAO_PEDIDO,CAST((FROM_TZ(TO_TIMESTAMP(TO_CHAR(sli940.t$date$l,'DD-MON-YYYY HH24:MI:SS'),'DD-MON-YYYY HH24:MI:SS'),'GMT') AT time zone 'America/Sao_Paulo') AS DATE) DT_EMISSAO,sli940.t$ccfo$l CFO,sli940.t$opor$l SEQ_CFO,mcs940.t$dsca$l NOME_CFO,sls400.t$idca$c CANAL,TRIM(sli941.t$item$l) ID_ITEM,tcibd001.t$dsca NOME_ITEM,sum(sli941.t$dqua$l) QTD_FATURADA,CASE WHEN sli941.t$iprt$l=0 THEN round(tdsls401.t$pric,2) ELSE round(sli941.t$pric$l,2) END VL_PRODUTO,CASE WHEN sum(sli941.t$amnt$l)=0 THEN sum(tdsls401.t$oamt) ELSE sum(sli941.t$amnt$l) END VL_TOTAL_ITEM,CASE WHEN sli941.t$gamt$l=0 THEN round(tdsls401.t$pric,2) ELSE round(sli941.t$gamt$l,2) END VL_MERCADORIA,CASE WHEN sum(sli941.t$fght$l)=0 THEN sum(nvl(znsls401.t$vlfr$c,0)) ELSE sum(sli941.t$fght$l) END VL_FRETE,CASE WHEN sum(sli941.t$ldam$l)=0 THEN sum(nvl(znsls401.t$vlde$c,0)) ELSE sum(sli941.t$ldam$l) END VL_DESC_INC,sum(NVL((select sum(cisli943.t$amnt$l) from baandb.tcisli943301 cisli943 where cisli943.t$fire$l=sli941.t$fire$l and cisli943.t$LINE$l=sli941.t$LINE$l and cisli943.t$brty$l=1),0))VL_ICMS,sum(NVL((select sum(cisli943.t$amnt$l) from baandb.tcisli943301 cisli943 where cisli943.t$fire$l=sli941.t$fire$l and cisli943.t$line$l=sli941.t$line$l and cisli943.t$brty$l=5),0))VL_PIS,sum(NVL((select sum(cisli943.t$amnt$l) from baandb.tcisli943301 cisli943 where cisli943.t$fire$l=sli941.t$fire$l and cisli943.t$line$l=sli941.t$line$l and cisli943.t$brty$l=6),0))VL_COFINS,case when sli940.t$itbp$l=' ' then sli940.t$ifbp$l else sli940.t$itbp$l end ID_CLIENTE,case when sli940.t$itbn$l=' ' then sli940.t$ifbn$l else sli940.t$itbn$l end NOME_CLIENTE,nvl(tccom130.t$namc,tccom130d.t$namc) ENDERECO,nvl(tccom130.t$dist$l,tccom130d.t$dist$l) BAIRRO,nvl(tccom130.t$pstc,tccom130d.t$pstc) CEP,nvl(tccom130.t$dsca,tccom130d.t$dsca) MUNICIPIO,nvl(tccom130.t$cste,tccom130d.t$cste) UF,nvl(tccom130.t$telp,tccom130d.t$telp) TEL1,nvl(tccom130.t$telx,tccom130d.t$telx) TEL2,nvl(tccom130.t$enfs$l,tccom130d.t$enfs$l) EMAIL,sli940.t$fdtc$l ID_TIPO_DOC_FIS,tcmcs966.t$dsca$l DESCR_TIPO_DOC_FIS,FGET.DESC_TIPO_DOCTO DESC_TIPO_DOCTO,tccom130f.t$fovn$l CNPJ_FABRICANTE,tcmcs060.t$dsca NOME_FABRICANTE,Q1.CMV_UNIT FROM baandb.tcisli940301 sli940 INNER JOIN (select emm030.t$eunt CHAVE_FILIAL,emm030.t$dsca DSC_FILIAL,emm124.t$cwoc from baandb.ttcemm124301 emm124,baandb.ttcemm030301 emm030 where emm030.t$eunt=emm124.t$grid and emm124.t$loco=301) FILIAL ON FILIAL.t$cwoc=sli940.t$cofc$l LEFT JOIN baandb.ttcmcs940301 mcs940 ON mcs940.T$OFSO$L=sli940.t$ccfo$l INNER JOIN baandb.tcisli941301 sli941 ON sli941.t$fire$l=sli940.t$fire$l LEFT JOIN (select whwmd217.t$item,whwmd217.t$cwar,case when (max(whwmd215.t$qhnd) - max(whwmd215.t$qchd) - max(whwmd215.t$qnhd))=0 then 0 else round(sum(whwmd217.t$mauc$1) / (max(whwmd215.t$qhnd) - max(whwmd215.t$qchd) - max(whwmd215.t$qnhd)),4) end cmv_unit from baandb.twhwmd217301 whwmd217 inner join baandb.twhwmd215301 whwmd215 on whwmd215.t$cwar=whwmd217.t$cwar and whwmd215.t$item=whwmd217.t$item group by whwmd217.t$item,whwmd217.t$cwar) Q1 ON Q1.t$item=sli941.t$item$l AND Q1.t$cwar=sli941.t$cwar$l LEFT JOIN baandb.tcisli245301 cisli245 ON cisli245.t$fire$l=sli941.t$fire$l AND cisli245.t$line$l=sli941.t$line$l LEFT JOIN baandb.tcisli951301 cisli951 ON cisli951.t$fire$l=sli941.t$fire$l AND cisli951.t$line$l=sli941.t$line$l LEFT JOIN baandb.tznsls401301 znsls401 ON znsls401.t$orno$c=cisli245.t$slso AND znsls401.t$pono$c=cisli245.t$pono LEFT JOIN baandb.ttdsls401301 tdsls401 ON tdsls401.t$orno=cisli245.t$slso AND tdsls401.t$pono=cisli245.t$pono LEFT JOIN baandb.tznsls400301 sls400 ON sls400.t$ncia$c=znsls401.t$ncia$c AND sls400.t$uneg$c=znsls401.t$uneg$c AND sls400.t$pecl$c=znsls401.t$pecl$c AND sls400.t$sqpd$c=znsls401.t$sqpd$c LEFT JOIN baandb.ttccom130301 tccom130 ON tccom130.t$cadr=sli940.t$itoa$l LEFT JOIN baandb.ttccom130301 tccom130d ON tccom130d.t$cadr=sli940.t$IFBA$l INNER JOIN baandb.ttcibd001301 tcibd001 ON tcibd001.t$item=sli941.t$item$l LEFT JOIN baandb.ttcmcs060301 tcmcs060 ON tcmcs060.t$cmnf=tcibd001.t$cmnf LEFT JOIN baandb.ttccom130301 tccom130f ON tccom130f.t$cadr=tcmcs060.t$cadr LEFT JOIN baandb.ttcmcs966301 tcmcs966 ON tcmcs966.t$fdtc$l=sli940.t$fdtc$l LEFT JOIN (SELECT d.t$cnst CNST,l.t$desc DESC_TIPO_DOCTO FROM baandb.tttadv401000 d,baandb.tttadv140000 l WHERE d.t$cpac='ci' AND d.t$cdom='sli.tdff.l' AND l.t$clan='p' AND l.t$cpac='ci' AND l.t$clab=d.t$za_clab AND rpad(d.t$vers,4) || rpad(d.t$rele,2) || rpad(d.t$cust,4)=(select max(rpad(l1.t$vers,4) || rpad(l1.t$rele,2) || rpad(l1.t$cust,4)) from baandb.tttadv401000 l1 where l1.t$cpac=d.t$cpac and l1.t$cdom=d.t$cdom) AND rpad(l.t$vers,4) || rpad(l.t$rele,2) || rpad(l.t$cust,4)=(select max(rpad(l1.t$vers,4) || rpad(l1.t$rele,2) || rpad(l1.t$cust,4)) from baandb.tttadv140000 l1 where l1.t$clab=l.t$clab and l1.t$clan=l.t$clan and l1.t$cpac=l.t$cpac)) FGET ON sli940.t$fdty$l=FGET.CNST INNER JOIN WMWHSE2.ORDERS@DL_LN_WMS ORDERS_SH ON SUBSTR(ORDERS_SH.EXTERNORDERKEY,5,9)=nvl(CISLI245.T$SHPM,cisli951.t$shpm$l) LEFT JOIN (select MAX(a.ORDERKEY) ORDERKEY,MAX(a.TYPE) TYPE,a.REFERENCEDOCUMENT from WMWHSE2.ORDERS@DL_LN_WMS a group by a.REFERENCEDOCUMENT) ORDERS_OA ON SUBSTR(ORDERS_OA.REFERENCEDOCUMENT,4,9)=nvl(CISLI245.T$SLSO,cisli951.t$slso$l) LEFT JOIN (select MAX(a.ORDERKEY) ORDERKEY,MAX(a.TYPE) TYPE,a.REFERENCEDOCUMENT from WMWHSE2.ORDERS@DL_LN_WMS a group by a.REFERENCEDOCUMENT) ORDERS_OV ON ORDERS_OV.REFERENCEDOCUMENT=nvl(CISLI245.T$SLSO,cisli951.t$slso$l) LEFT JOIN WMWHSE2.CODELKUP@DL_LN_WMS CODELKUP_SH ON CODELKUP_SH.LISTNAME='ORDERTYPE' AND CODELKUP_SH.CODE=ORDERS_SH.TYPE LEFT JOIN WMWHSE2.CODELKUP@DL_LN_WMS CODELKUP_OA ON CODELKUP_OA.LISTNAME='ORDERTYPE' AND CODELKUP_OA.CODE=ORDERS_OA.TYPE LEFT JOIN WMWHSE2.CODELKUP@DL_LN_WMS CODELKUP_OV ON CODELKUP_OV.LISTNAME='ORDERTYPE' AND CODELKUP_OV.CODE=ORDERS_OV.TYPE LEFT JOIN baandb.tznsls000301 znsls000 ON znsls000.t$indt$c=TO_DATE('01-01-1970','DD-MM-YYYY') WHERE sli940.t$fdty$l NOT IN (11,14) AND sli940.t$stat$l NOT IN (2,101) AND sli940.t$docn$l !=0 AND sli941.t$item$l !=znsls000.t$itmd$c AND sli941.t$item$l !=znsls000.t$itmf$c AND sli941.t$item$l !=znsls000.t$itjl$c AND FILIAL.CHAVE_FILIAL='" + Parameters!Filial.Value + "' AND Trunc(CAST((FROM_TZ(TO_TIMESTAMP(TO_CHAR(sli940.t$date$l,'DD-MON-YYYY HH24:MI:SS'),'DD-MON-YYYY HH24:MI:SS'),'GMT') AT time zone 'America/Sao_Paulo') AS DATE)) Between '" + Parameters!EmissaoDe.Value + "' And '" + Parameters!EmissaoAte.Value + "' GROUP BY FILIAL.DSC_FILIAL,sli940.t$docn$l,sli940.t$seri$l,NVL(ORDERS_SH.ORDERKEY,NVL(ORDERS_OV.ORDERKEY,ORDERS_OA.ORDERKEY)),NVL(ORDERS_SH.REFERENCEDOCUMENT,NVL(ORDERS_OV.REFERENCEDOCUMENT,ORDERS_OA.REFERENCEDOCUMENT)),NVL(CODELKUP_SH.DESCRIPTION,NVL(CODELKUP_OV.DESCRIPTION,CODELKUP_OA.DESCRIPTION)),CAST((FROM_TZ(TO_TIMESTAMP(TO_CHAR(sli940.t$date$l,'DD-MON-YYYY HH24:MI:SS'),'DD-MON-YYYY HH24:MI:SS'),'GMT') AT time zone 'America/Sao_Paulo') AS DATE),sli940.t$ccfo$l,sli940.t$opor$l,mcs940.t$dsca$l,sls400.t$idca$c,TRIM(sli941.t$item$l),tcibd001.t$dsca ,CASE WHEN sli941.t$iprt$l=0 THEN round(tdsls401.t$pric,2) ELSE round(sli941.t$pric$l,2) END,CASE WHEN sli941.t$gamt$l=0 THEN round(tdsls401.t$pric,2) ELSE round(sli941.t$gamt$l,2) END,sli940.t$itbp$l,sli940.t$ifbp$l,sli940.t$itbn$l,sli940.t$ifbn$l,nvl(tccom130.t$namc,tccom130d.t$namc),nvl(tccom130.t$dist$l,tccom130d.t$dist$l),nvl(tccom130.t$pstc,tccom130d.t$pstc),nvl(tccom130.t$dsca,tccom130d.t$dsca),nvl(tccom130.t$cste,tccom130d.t$cste),nvl(tccom130.t$telp,tccom130d.t$telp),nvl(tccom130.t$telx,tccom130d.t$telx),nvl(tccom130.t$enfs$l,tccom130d.t$enfs$l),sli940.t$fdtc$l,tcmcs966.t$dsca$l,FGET.DESC_TIPO_DOCTO,tccom130f.t$fovn$l,tcmcs060.t$dsca,Q1.CMV_UNIT,ORDERS_SH.ORDERKEY,ORDERS_OV.orderkey,ORDERS_OA.orderkey,CISLI245.T$SHPM,cisli951.t$shpm$l,CISLI245.T$SLSO,cisli951.t$slso$l " &
"Union SELECT FILIAL.DSC_FILIAL FILIAL,sli940.t$docn$l NF,sli940.t$seri$l SERIE,NVL(ORDERS_SH.ORDERKEY,NVL(ORDERS_OV.ORDERKEY,ORDERS_OA.ORDERKEY)) PEDIDO_WMS,NVL(ORDERS_SH.REFERENCEDOCUMENT,NVL(ORDERS_OV.REFERENCEDOCUMENT,ORDERS_OA.REFERENCEDOCUMENT)) ORDEM_MOVIMENTACAO,NVL(CODELKUP_SH.DESCRIPTION,NVL(CODELKUP_OV.DESCRIPTION,CODELKUP_OA.DESCRIPTION)) DESCRICAO_PEDIDO,CAST((FROM_TZ(TO_TIMESTAMP(TO_CHAR(sli940.t$date$l,'DD-MON-YYYY HH24:MI:SS'),'DD-MON-YYYY HH24:MI:SS'),'GMT') AT time zone 'America/Sao_Paulo') AS DATE) DT_EMISSAO,sli940.t$ccfo$l CFO,sli940.t$opor$l SEQ_CFO,mcs940.t$dsca$l NOME_CFO,sls400.t$idca$c CANAL,TRIM(sli941.t$item$l) ID_ITEM,tcibd001.t$dsca NOME_ITEM,sum(sli941.t$dqua$l) QTD_FATURADA,CASE WHEN sli941.t$iprt$l=0 THEN round(tdsls401.t$pric,2) ELSE round(sli941.t$pric$l,2) END VL_PRODUTO,CASE WHEN sum(sli941.t$amnt$l)=0 THEN sum(tdsls401.t$oamt) ELSE sum(sli941.t$amnt$l) END VL_TOTAL_ITEM,CASE WHEN sli941.t$gamt$l=0 THEN round(tdsls401.t$pric,2) ELSE round(sli941.t$gamt$l,2) END VL_MERCADORIA,CASE WHEN sum(sli941.t$fght$l)=0 THEN sum(nvl(znsls401.t$vlfr$c,0)) ELSE sum(sli941.t$fght$l) END VL_FRETE,CASE WHEN sum(sli941.t$ldam$l)=0 THEN sum(nvl(znsls401.t$vlde$c,0)) ELSE sum(sli941.t$ldam$l) END VL_DESC_INC,sum(NVL((select sum(cisli943.t$amnt$l) from baandb.tcisli943301 cisli943 where cisli943.t$fire$l=sli941.t$fire$l and cisli943.t$LINE$l=sli941.t$LINE$l and cisli943.t$brty$l=1),0))VL_ICMS,sum(NVL((select sum(cisli943.t$amnt$l) from baandb.tcisli943301 cisli943 where cisli943.t$fire$l=sli941.t$fire$l and cisli943.t$line$l=sli941.t$line$l and cisli943.t$brty$l=5),0))VL_PIS,sum(NVL((select sum(cisli943.t$amnt$l) from baandb.tcisli943301 cisli943 where cisli943.t$fire$l=sli941.t$fire$l and cisli943.t$line$l=sli941.t$line$l and cisli943.t$brty$l=6),0))VL_COFINS,case when sli940.t$itbp$l=' ' then sli940.t$ifbp$l else sli940.t$itbp$l end ID_CLIENTE,case when sli940.t$itbn$l=' ' then sli940.t$ifbn$l else sli940.t$itbn$l end NOME_CLIENTE,nvl(tccom130.t$namc,tccom130d.t$namc) ENDERECO,nvl(tccom130.t$dist$l,tccom130d.t$dist$l) BAIRRO,nvl(tccom130.t$pstc,tccom130d.t$pstc) CEP,nvl(tccom130.t$dsca,tccom130d.t$dsca) MUNICIPIO,nvl(tccom130.t$cste,tccom130d.t$cste) UF,nvl(tccom130.t$telp,tccom130d.t$telp) TEL1,nvl(tccom130.t$telx,tccom130d.t$telx) TEL2,nvl(tccom130.t$enfs$l,tccom130d.t$enfs$l) EMAIL,sli940.t$fdtc$l ID_TIPO_DOC_FIS,tcmcs966.t$dsca$l DESCR_TIPO_DOC_FIS,FGET.DESC_TIPO_DOCTO DESC_TIPO_DOCTO,tccom130f.t$fovn$l CNPJ_FABRICANTE,tcmcs060.t$dsca NOME_FABRICANTE,Q1.CMV_UNIT FROM baandb.tcisli940301 sli940 INNER JOIN (select emm030.t$eunt CHAVE_FILIAL,emm030.t$dsca DSC_FILIAL,emm124.t$cwoc from baandb.ttcemm124301 emm124,baandb.ttcemm030301 emm030 where emm030.t$eunt=emm124.t$grid and emm124.t$loco=301) FILIAL ON FILIAL.t$cwoc=sli940.t$cofc$l LEFT JOIN baandb.ttcmcs940301 mcs940 ON mcs940.T$OFSO$L=sli940.t$ccfo$l INNER JOIN baandb.tcisli941301 sli941 ON sli941.t$fire$l=sli940.t$fire$l LEFT JOIN (select whwmd217.t$item,whwmd217.t$cwar,case when (max(whwmd215.t$qhnd) - max(whwmd215.t$qchd) - max(whwmd215.t$qnhd))=0 then 0 else round(sum(whwmd217.t$mauc$1) / (max(whwmd215.t$qhnd) - max(whwmd215.t$qchd) - max(whwmd215.t$qnhd)),4) end cmv_unit from baandb.twhwmd217301 whwmd217 inner join baandb.twhwmd215301 whwmd215 on whwmd215.t$cwar=whwmd217.t$cwar and whwmd215.t$item=whwmd217.t$item group by whwmd217.t$item,whwmd217.t$cwar) Q1 ON Q1.t$item=sli941.t$item$l AND Q1.t$cwar=sli941.t$cwar$l LEFT JOIN baandb.tcisli245301 cisli245 ON cisli245.t$fire$l=sli941.t$fire$l AND cisli245.t$line$l=sli941.t$line$l LEFT JOIN baandb.tcisli951301 cisli951 ON cisli951.t$fire$l=sli941.t$fire$l AND cisli951.t$line$l=sli941.t$line$l LEFT JOIN baandb.tznsls401301 znsls401 ON znsls401.t$orno$c=cisli245.t$slso AND znsls401.t$pono$c=cisli245.t$pono LEFT JOIN baandb.ttdsls401301 tdsls401 ON tdsls401.t$orno=cisli245.t$slso AND tdsls401.t$pono=cisli245.t$pono LEFT JOIN baandb.tznsls400301 sls400 ON sls400.t$ncia$c=znsls401.t$ncia$c AND sls400.t$uneg$c=znsls401.t$uneg$c AND sls400.t$pecl$c=znsls401.t$pecl$c AND sls400.t$sqpd$c=znsls401.t$sqpd$c LEFT JOIN baandb.ttccom130301 tccom130 ON tccom130.t$cadr=sli940.t$itoa$l LEFT JOIN baandb.ttccom130301 tccom130d ON tccom130d.t$cadr=sli940.t$IFBA$l INNER JOIN baandb.ttcibd001301 tcibd001 ON tcibd001.t$item=sli941.t$item$l LEFT JOIN baandb.ttcmcs060301 tcmcs060 ON tcmcs060.t$cmnf=tcibd001.t$cmnf LEFT JOIN baandb.ttccom130301 tccom130f ON tccom130f.t$cadr=tcmcs060.t$cadr LEFT JOIN baandb.ttcmcs966301 tcmcs966 ON tcmcs966.t$fdtc$l=sli940.t$fdtc$l LEFT JOIN (SELECT d.t$cnst CNST,l.t$desc DESC_TIPO_DOCTO FROM baandb.tttadv401000 d,baandb.tttadv140000 l WHERE d.t$cpac='ci' AND d.t$cdom='sli.tdff.l' AND l.t$clan='p' AND l.t$cpac='ci' AND l.t$clab=d.t$za_clab AND rpad(d.t$vers,4) || rpad(d.t$rele,2) || rpad(d.t$cust,4)=(select max(rpad(l1.t$vers,4) || rpad(l1.t$rele,2) || rpad(l1.t$cust,4)) from baandb.tttadv401000 l1 where l1.t$cpac=d.t$cpac and l1.t$cdom=d.t$cdom) AND rpad(l.t$vers,4) || rpad(l.t$rele,2) || rpad(l.t$cust,4)=(select max(rpad(l1.t$vers,4) || rpad(l1.t$rele,2) || rpad(l1.t$cust,4)) from baandb.tttadv140000 l1 where l1.t$clab=l.t$clab and l1.t$clan=l.t$clan and l1.t$cpac=l.t$cpac)) FGET ON sli940.t$fdty$l=FGET.CNST INNER JOIN WMWHSE3.ORDERS@DL_LN_WMS ORDERS_SH ON SUBSTR(ORDERS_SH.EXTERNORDERKEY,5,9)=nvl(CISLI245.T$SHPM,cisli951.t$shpm$l) LEFT JOIN (select MAX(a.ORDERKEY) ORDERKEY,MAX(a.TYPE) TYPE,a.REFERENCEDOCUMENT from WMWHSE3.ORDERS@DL_LN_WMS a group by a.REFERENCEDOCUMENT) ORDERS_OA ON SUBSTR(ORDERS_OA.REFERENCEDOCUMENT,4,9)=nvl(CISLI245.T$SLSO,cisli951.t$slso$l) LEFT JOIN (select MAX(a.ORDERKEY) ORDERKEY,MAX(a.TYPE) TYPE,a.REFERENCEDOCUMENT from WMWHSE3.ORDERS@DL_LN_WMS a group by a.REFERENCEDOCUMENT) ORDERS_OV ON ORDERS_OV.REFERENCEDOCUMENT=nvl(CISLI245.T$SLSO,cisli951.t$slso$l) LEFT JOIN WMWHSE3.CODELKUP@DL_LN_WMS CODELKUP_SH ON CODELKUP_SH.LISTNAME='ORDERTYPE' AND CODELKUP_SH.CODE=ORDERS_SH.TYPE LEFT JOIN WMWHSE3.CODELKUP@DL_LN_WMS CODELKUP_OA ON CODELKUP_OA.LISTNAME='ORDERTYPE' AND CODELKUP_OA.CODE=ORDERS_OA.TYPE LEFT JOIN WMWHSE3.CODELKUP@DL_LN_WMS CODELKUP_OV ON CODELKUP_OV.LISTNAME='ORDERTYPE' AND CODELKUP_OV.CODE=ORDERS_OV.TYPE LEFT JOIN baandb.tznsls000301 znsls000 ON znsls000.t$indt$c=TO_DATE('01-01-1970','DD-MM-YYYY') WHERE sli940.t$fdty$l NOT IN (11,14) AND sli940.t$stat$l NOT IN (2,101) AND sli940.t$docn$l !=0 AND sli941.t$item$l !=znsls000.t$itmd$c AND sli941.t$item$l !=znsls000.t$itmf$c AND sli941.t$item$l !=znsls000.t$itjl$c AND FILIAL.CHAVE_FILIAL='" + Parameters!Filial.Value + "' AND Trunc(CAST((FROM_TZ(TO_TIMESTAMP(TO_CHAR(sli940.t$date$l,'DD-MON-YYYY HH24:MI:SS'),'DD-MON-YYYY HH24:MI:SS'),'GMT') AT time zone 'America/Sao_Paulo') AS DATE)) Between '" + Parameters!EmissaoDe.Value + "' And '" + Parameters!EmissaoAte.Value + "' GROUP BY FILIAL.DSC_FILIAL,sli940.t$docn$l,sli940.t$seri$l,NVL(ORDERS_SH.ORDERKEY,NVL(ORDERS_OV.ORDERKEY,ORDERS_OA.ORDERKEY)),NVL(ORDERS_SH.REFERENCEDOCUMENT,NVL(ORDERS_OV.REFERENCEDOCUMENT,ORDERS_OA.REFERENCEDOCUMENT)),NVL(CODELKUP_SH.DESCRIPTION,NVL(CODELKUP_OV.DESCRIPTION,CODELKUP_OA.DESCRIPTION)),CAST((FROM_TZ(TO_TIMESTAMP(TO_CHAR(sli940.t$date$l,'DD-MON-YYYY HH24:MI:SS'),'DD-MON-YYYY HH24:MI:SS'),'GMT') AT time zone 'America/Sao_Paulo') AS DATE),sli940.t$ccfo$l,sli940.t$opor$l,mcs940.t$dsca$l,sls400.t$idca$c,TRIM(sli941.t$item$l),tcibd001.t$dsca ,CASE WHEN sli941.t$iprt$l=0 THEN round(tdsls401.t$pric,2) ELSE round(sli941.t$pric$l,2) END,CASE WHEN sli941.t$gamt$l=0 THEN round(tdsls401.t$pric,2) ELSE round(sli941.t$gamt$l,2) END,sli940.t$itbp$l,sli940.t$ifbp$l,sli940.t$itbn$l,sli940.t$ifbn$l,nvl(tccom130.t$namc,tccom130d.t$namc),nvl(tccom130.t$dist$l,tccom130d.t$dist$l),nvl(tccom130.t$pstc,tccom130d.t$pstc),nvl(tccom130.t$dsca,tccom130d.t$dsca),nvl(tccom130.t$cste,tccom130d.t$cste),nvl(tccom130.t$telp,tccom130d.t$telp),nvl(tccom130.t$telx,tccom130d.t$telx),nvl(tccom130.t$enfs$l,tccom130d.t$enfs$l),sli940.t$fdtc$l,tcmcs966.t$dsca$l,FGET.DESC_TIPO_DOCTO,tccom130f.t$fovn$l,tcmcs060.t$dsca,Q1.CMV_UNIT,ORDERS_SH.ORDERKEY,ORDERS_OV.orderkey,ORDERS_OA.orderkey,CISLI245.T$SHPM,cisli951.t$shpm$l,CISLI245.T$SLSO,cisli951.t$slso$l " &
"Union SELECT FILIAL.DSC_FILIAL FILIAL,sli940.t$docn$l NF,sli940.t$seri$l SERIE,NVL(ORDERS_SH.ORDERKEY,NVL(ORDERS_OV.ORDERKEY,ORDERS_OA.ORDERKEY)) PEDIDO_WMS,NVL(ORDERS_SH.REFERENCEDOCUMENT,NVL(ORDERS_OV.REFERENCEDOCUMENT,ORDERS_OA.REFERENCEDOCUMENT)) ORDEM_MOVIMENTACAO,NVL(CODELKUP_SH.DESCRIPTION,NVL(CODELKUP_OV.DESCRIPTION,CODELKUP_OA.DESCRIPTION)) DESCRICAO_PEDIDO,CAST((FROM_TZ(TO_TIMESTAMP(TO_CHAR(sli940.t$date$l,'DD-MON-YYYY HH24:MI:SS'),'DD-MON-YYYY HH24:MI:SS'),'GMT') AT time zone 'America/Sao_Paulo') AS DATE) DT_EMISSAO,sli940.t$ccfo$l CFO,sli940.t$opor$l SEQ_CFO,mcs940.t$dsca$l NOME_CFO,sls400.t$idca$c CANAL,TRIM(sli941.t$item$l) ID_ITEM,tcibd001.t$dsca NOME_ITEM,sum(sli941.t$dqua$l) QTD_FATURADA,CASE WHEN sli941.t$iprt$l=0 THEN round(tdsls401.t$pric,2) ELSE round(sli941.t$pric$l,2) END VL_PRODUTO,CASE WHEN sum(sli941.t$amnt$l)=0 THEN sum(tdsls401.t$oamt) ELSE sum(sli941.t$amnt$l) END VL_TOTAL_ITEM,CASE WHEN sli941.t$gamt$l=0 THEN round(tdsls401.t$pric,2) ELSE round(sli941.t$gamt$l,2) END VL_MERCADORIA,CASE WHEN sum(sli941.t$fght$l)=0 THEN sum(nvl(znsls401.t$vlfr$c,0)) ELSE sum(sli941.t$fght$l) END VL_FRETE,CASE WHEN sum(sli941.t$ldam$l)=0 THEN sum(nvl(znsls401.t$vlde$c,0)) ELSE sum(sli941.t$ldam$l) END VL_DESC_INC,sum(NVL((select sum(cisli943.t$amnt$l) from baandb.tcisli943301 cisli943 where cisli943.t$fire$l=sli941.t$fire$l and cisli943.t$LINE$l=sli941.t$LINE$l and cisli943.t$brty$l=1),0))VL_ICMS,sum(NVL((select sum(cisli943.t$amnt$l) from baandb.tcisli943301 cisli943 where cisli943.t$fire$l=sli941.t$fire$l and cisli943.t$line$l=sli941.t$line$l and cisli943.t$brty$l=5),0))VL_PIS,sum(NVL((select sum(cisli943.t$amnt$l) from baandb.tcisli943301 cisli943 where cisli943.t$fire$l=sli941.t$fire$l and cisli943.t$line$l=sli941.t$line$l and cisli943.t$brty$l=6),0))VL_COFINS,case when sli940.t$itbp$l=' ' then sli940.t$ifbp$l else sli940.t$itbp$l end ID_CLIENTE,case when sli940.t$itbn$l=' ' then sli940.t$ifbn$l else sli940.t$itbn$l end NOME_CLIENTE,nvl(tccom130.t$namc,tccom130d.t$namc) ENDERECO,nvl(tccom130.t$dist$l,tccom130d.t$dist$l) BAIRRO,nvl(tccom130.t$pstc,tccom130d.t$pstc) CEP,nvl(tccom130.t$dsca,tccom130d.t$dsca) MUNICIPIO,nvl(tccom130.t$cste,tccom130d.t$cste) UF,nvl(tccom130.t$telp,tccom130d.t$telp) TEL1,nvl(tccom130.t$telx,tccom130d.t$telx) TEL2,nvl(tccom130.t$enfs$l,tccom130d.t$enfs$l) EMAIL,sli940.t$fdtc$l ID_TIPO_DOC_FIS,tcmcs966.t$dsca$l DESCR_TIPO_DOC_FIS,FGET.DESC_TIPO_DOCTO DESC_TIPO_DOCTO,tccom130f.t$fovn$l CNPJ_FABRICANTE,tcmcs060.t$dsca NOME_FABRICANTE,Q1.CMV_UNIT FROM baandb.tcisli940301 sli940 INNER JOIN (select emm030.t$eunt CHAVE_FILIAL,emm030.t$dsca DSC_FILIAL,emm124.t$cwoc from baandb.ttcemm124301 emm124,baandb.ttcemm030301 emm030 where emm030.t$eunt=emm124.t$grid and emm124.t$loco=301) FILIAL ON FILIAL.t$cwoc=sli940.t$cofc$l LEFT JOIN baandb.ttcmcs940301 mcs940 ON mcs940.T$OFSO$L=sli940.t$ccfo$l INNER JOIN baandb.tcisli941301 sli941 ON sli941.t$fire$l=sli940.t$fire$l LEFT JOIN (select whwmd217.t$item,whwmd217.t$cwar,case when (max(whwmd215.t$qhnd) - max(whwmd215.t$qchd) - max(whwmd215.t$qnhd))=0 then 0 else round(sum(whwmd217.t$mauc$1) / (max(whwmd215.t$qhnd) - max(whwmd215.t$qchd) - max(whwmd215.t$qnhd)),4) end cmv_unit from baandb.twhwmd217301 whwmd217 inner join baandb.twhwmd215301 whwmd215 on whwmd215.t$cwar=whwmd217.t$cwar and whwmd215.t$item=whwmd217.t$item group by whwmd217.t$item,whwmd217.t$cwar) Q1 ON Q1.t$item=sli941.t$item$l AND Q1.t$cwar=sli941.t$cwar$l LEFT JOIN baandb.tcisli245301 cisli245 ON cisli245.t$fire$l=sli941.t$fire$l AND cisli245.t$line$l=sli941.t$line$l LEFT JOIN baandb.tcisli951301 cisli951 ON cisli951.t$fire$l=sli941.t$fire$l AND cisli951.t$line$l=sli941.t$line$l LEFT JOIN baandb.tznsls401301 znsls401 ON znsls401.t$orno$c=cisli245.t$slso AND znsls401.t$pono$c=cisli245.t$pono LEFT JOIN baandb.ttdsls401301 tdsls401 ON tdsls401.t$orno=cisli245.t$slso AND tdsls401.t$pono=cisli245.t$pono LEFT JOIN baandb.tznsls400301 sls400 ON sls400.t$ncia$c=znsls401.t$ncia$c AND sls400.t$uneg$c=znsls401.t$uneg$c AND sls400.t$pecl$c=znsls401.t$pecl$c AND sls400.t$sqpd$c=znsls401.t$sqpd$c LEFT JOIN baandb.ttccom130301 tccom130 ON tccom130.t$cadr=sli940.t$itoa$l LEFT JOIN baandb.ttccom130301 tccom130d ON tccom130d.t$cadr=sli940.t$IFBA$l INNER JOIN baandb.ttcibd001301 tcibd001 ON tcibd001.t$item=sli941.t$item$l LEFT JOIN baandb.ttcmcs060301 tcmcs060 ON tcmcs060.t$cmnf=tcibd001.t$cmnf LEFT JOIN baandb.ttccom130301 tccom130f ON tccom130f.t$cadr=tcmcs060.t$cadr LEFT JOIN baandb.ttcmcs966301 tcmcs966 ON tcmcs966.t$fdtc$l=sli940.t$fdtc$l LEFT JOIN (SELECT d.t$cnst CNST,l.t$desc DESC_TIPO_DOCTO FROM baandb.tttadv401000 d,baandb.tttadv140000 l WHERE d.t$cpac='ci' AND d.t$cdom='sli.tdff.l' AND l.t$clan='p' AND l.t$cpac='ci' AND l.t$clab=d.t$za_clab AND rpad(d.t$vers,4) || rpad(d.t$rele,2) || rpad(d.t$cust,4)=(select max(rpad(l1.t$vers,4) || rpad(l1.t$rele,2) || rpad(l1.t$cust,4)) from baandb.tttadv401000 l1 where l1.t$cpac=d.t$cpac and l1.t$cdom=d.t$cdom) AND rpad(l.t$vers,4) || rpad(l.t$rele,2) || rpad(l.t$cust,4)=(select max(rpad(l1.t$vers,4) || rpad(l1.t$rele,2) || rpad(l1.t$cust,4)) from baandb.tttadv140000 l1 where l1.t$clab=l.t$clab and l1.t$clan=l.t$clan and l1.t$cpac=l.t$cpac)) FGET ON sli940.t$fdty$l=FGET.CNST INNER JOIN WMWHSE4.ORDERS@DL_LN_WMS ORDERS_SH ON SUBSTR(ORDERS_SH.EXTERNORDERKEY,5,9)=nvl(CISLI245.T$SHPM,cisli951.t$shpm$l) LEFT JOIN (select MAX(a.ORDERKEY) ORDERKEY,MAX(a.TYPE) TYPE,a.REFERENCEDOCUMENT from WMWHSE4.ORDERS@DL_LN_WMS a group by a.REFERENCEDOCUMENT) ORDERS_OA ON SUBSTR(ORDERS_OA.REFERENCEDOCUMENT,4,9)=nvl(CISLI245.T$SLSO,cisli951.t$slso$l) LEFT JOIN (select MAX(a.ORDERKEY) ORDERKEY,MAX(a.TYPE) TYPE,a.REFERENCEDOCUMENT from WMWHSE4.ORDERS@DL_LN_WMS a group by a.REFERENCEDOCUMENT) ORDERS_OV ON ORDERS_OV.REFERENCEDOCUMENT=nvl(CISLI245.T$SLSO,cisli951.t$slso$l) LEFT JOIN WMWHSE4.CODELKUP@DL_LN_WMS CODELKUP_SH ON CODELKUP_SH.LISTNAME='ORDERTYPE' AND CODELKUP_SH.CODE=ORDERS_SH.TYPE LEFT JOIN WMWHSE4.CODELKUP@DL_LN_WMS CODELKUP_OA ON CODELKUP_OA.LISTNAME='ORDERTYPE' AND CODELKUP_OA.CODE=ORDERS_OA.TYPE LEFT JOIN WMWHSE4.CODELKUP@DL_LN_WMS CODELKUP_OV ON CODELKUP_OV.LISTNAME='ORDERTYPE' AND CODELKUP_OV.CODE=ORDERS_OV.TYPE LEFT JOIN baandb.tznsls000301 znsls000 ON znsls000.t$indt$c=TO_DATE('01-01-1970','DD-MM-YYYY') WHERE sli940.t$fdty$l NOT IN (11,14) AND sli940.t$stat$l NOT IN (2,101) AND sli940.t$docn$l !=0 AND sli941.t$item$l !=znsls000.t$itmd$c AND sli941.t$item$l !=znsls000.t$itmf$c AND sli941.t$item$l !=znsls000.t$itjl$c AND FILIAL.CHAVE_FILIAL='" + Parameters!Filial.Value + "' AND Trunc(CAST((FROM_TZ(TO_TIMESTAMP(TO_CHAR(sli940.t$date$l,'DD-MON-YYYY HH24:MI:SS'),'DD-MON-YYYY HH24:MI:SS'),'GMT') AT time zone 'America/Sao_Paulo') AS DATE)) Between '" + Parameters!EmissaoDe.Value + "' And '" + Parameters!EmissaoAte.Value + "' GROUP BY FILIAL.DSC_FILIAL,sli940.t$docn$l,sli940.t$seri$l,NVL(ORDERS_SH.ORDERKEY,NVL(ORDERS_OV.ORDERKEY,ORDERS_OA.ORDERKEY)),NVL(ORDERS_SH.REFERENCEDOCUMENT,NVL(ORDERS_OV.REFERENCEDOCUMENT,ORDERS_OA.REFERENCEDOCUMENT)),NVL(CODELKUP_SH.DESCRIPTION,NVL(CODELKUP_OV.DESCRIPTION,CODELKUP_OA.DESCRIPTION)),CAST((FROM_TZ(TO_TIMESTAMP(TO_CHAR(sli940.t$date$l,'DD-MON-YYYY HH24:MI:SS'),'DD-MON-YYYY HH24:MI:SS'),'GMT') AT time zone 'America/Sao_Paulo') AS DATE),sli940.t$ccfo$l,sli940.t$opor$l,mcs940.t$dsca$l,sls400.t$idca$c,TRIM(sli941.t$item$l),tcibd001.t$dsca ,CASE WHEN sli941.t$iprt$l=0 THEN round(tdsls401.t$pric,2) ELSE round(sli941.t$pric$l,2) END,CASE WHEN sli941.t$gamt$l=0 THEN round(tdsls401.t$pric,2) ELSE round(sli941.t$gamt$l,2) END,sli940.t$itbp$l,sli940.t$ifbp$l,sli940.t$itbn$l,sli940.t$ifbn$l,nvl(tccom130.t$namc,tccom130d.t$namc),nvl(tccom130.t$dist$l,tccom130d.t$dist$l),nvl(tccom130.t$pstc,tccom130d.t$pstc),nvl(tccom130.t$dsca,tccom130d.t$dsca),nvl(tccom130.t$cste,tccom130d.t$cste),nvl(tccom130.t$telp,tccom130d.t$telp),nvl(tccom130.t$telx,tccom130d.t$telx),nvl(tccom130.t$enfs$l,tccom130d.t$enfs$l),sli940.t$fdtc$l,tcmcs966.t$dsca$l,FGET.DESC_TIPO_DOCTO,tccom130f.t$fovn$l,tcmcs060.t$dsca,Q1.CMV_UNIT,ORDERS_SH.ORDERKEY,ORDERS_OV.orderkey,ORDERS_OA.orderkey,CISLI245.T$SHPM,cisli951.t$shpm$l,CISLI245.T$SLSO,cisli951.t$slso$l " &
"Union SELECT FILIAL.DSC_FILIAL FILIAL,sli940.t$docn$l NF,sli940.t$seri$l SERIE,NVL(ORDERS_SH.ORDERKEY,NVL(ORDERS_OV.ORDERKEY,ORDERS_OA.ORDERKEY)) PEDIDO_WMS,NVL(ORDERS_SH.REFERENCEDOCUMENT,NVL(ORDERS_OV.REFERENCEDOCUMENT,ORDERS_OA.REFERENCEDOCUMENT)) ORDEM_MOVIMENTACAO,NVL(CODELKUP_SH.DESCRIPTION,NVL(CODELKUP_OV.DESCRIPTION,CODELKUP_OA.DESCRIPTION)) DESCRICAO_PEDIDO,CAST((FROM_TZ(TO_TIMESTAMP(TO_CHAR(sli940.t$date$l,'DD-MON-YYYY HH24:MI:SS'),'DD-MON-YYYY HH24:MI:SS'),'GMT') AT time zone 'America/Sao_Paulo') AS DATE) DT_EMISSAO,sli940.t$ccfo$l CFO,sli940.t$opor$l SEQ_CFO,mcs940.t$dsca$l NOME_CFO,sls400.t$idca$c CANAL,TRIM(sli941.t$item$l) ID_ITEM,tcibd001.t$dsca NOME_ITEM,sum(sli941.t$dqua$l) QTD_FATURADA,CASE WHEN sli941.t$iprt$l=0 THEN round(tdsls401.t$pric,2) ELSE round(sli941.t$pric$l,2) END VL_PRODUTO,CASE WHEN sum(sli941.t$amnt$l)=0 THEN sum(tdsls401.t$oamt) ELSE sum(sli941.t$amnt$l) END VL_TOTAL_ITEM,CASE WHEN sli941.t$gamt$l=0 THEN round(tdsls401.t$pric,2) ELSE round(sli941.t$gamt$l,2) END VL_MERCADORIA,CASE WHEN sum(sli941.t$fght$l)=0 THEN sum(nvl(znsls401.t$vlfr$c,0)) ELSE sum(sli941.t$fght$l) END VL_FRETE,CASE WHEN sum(sli941.t$ldam$l)=0 THEN sum(nvl(znsls401.t$vlde$c,0)) ELSE sum(sli941.t$ldam$l) END VL_DESC_INC,sum(NVL((select sum(cisli943.t$amnt$l) from baandb.tcisli943301 cisli943 where cisli943.t$fire$l=sli941.t$fire$l and cisli943.t$LINE$l=sli941.t$LINE$l and cisli943.t$brty$l=1),0))VL_ICMS,sum(NVL((select sum(cisli943.t$amnt$l) from baandb.tcisli943301 cisli943 where cisli943.t$fire$l=sli941.t$fire$l and cisli943.t$line$l=sli941.t$line$l and cisli943.t$brty$l=5),0))VL_PIS,sum(NVL((select sum(cisli943.t$amnt$l) from baandb.tcisli943301 cisli943 where cisli943.t$fire$l=sli941.t$fire$l and cisli943.t$line$l=sli941.t$line$l and cisli943.t$brty$l=6),0))VL_COFINS,case when sli940.t$itbp$l=' ' then sli940.t$ifbp$l else sli940.t$itbp$l end ID_CLIENTE,case when sli940.t$itbn$l=' ' then sli940.t$ifbn$l else sli940.t$itbn$l end NOME_CLIENTE,nvl(tccom130.t$namc,tccom130d.t$namc) ENDERECO,nvl(tccom130.t$dist$l,tccom130d.t$dist$l) BAIRRO,nvl(tccom130.t$pstc,tccom130d.t$pstc) CEP,nvl(tccom130.t$dsca,tccom130d.t$dsca) MUNICIPIO,nvl(tccom130.t$cste,tccom130d.t$cste) UF,nvl(tccom130.t$telp,tccom130d.t$telp) TEL1,nvl(tccom130.t$telx,tccom130d.t$telx) TEL2,nvl(tccom130.t$enfs$l,tccom130d.t$enfs$l) EMAIL,sli940.t$fdtc$l ID_TIPO_DOC_FIS,tcmcs966.t$dsca$l DESCR_TIPO_DOC_FIS,FGET.DESC_TIPO_DOCTO DESC_TIPO_DOCTO,tccom130f.t$fovn$l CNPJ_FABRICANTE,tcmcs060.t$dsca NOME_FABRICANTE,Q1.CMV_UNIT FROM baandb.tcisli940301 sli940 INNER JOIN (select emm030.t$eunt CHAVE_FILIAL,emm030.t$dsca DSC_FILIAL,emm124.t$cwoc from baandb.ttcemm124301 emm124,baandb.ttcemm030301 emm030 where emm030.t$eunt=emm124.t$grid and emm124.t$loco=301) FILIAL ON FILIAL.t$cwoc=sli940.t$cofc$l LEFT JOIN baandb.ttcmcs940301 mcs940 ON mcs940.T$OFSO$L=sli940.t$ccfo$l INNER JOIN baandb.tcisli941301 sli941 ON sli941.t$fire$l=sli940.t$fire$l LEFT JOIN (select whwmd217.t$item,whwmd217.t$cwar,case when (max(whwmd215.t$qhnd) - max(whwmd215.t$qchd) - max(whwmd215.t$qnhd))=0 then 0 else round(sum(whwmd217.t$mauc$1) / (max(whwmd215.t$qhnd) - max(whwmd215.t$qchd) - max(whwmd215.t$qnhd)),4) end cmv_unit from baandb.twhwmd217301 whwmd217 inner join baandb.twhwmd215301 whwmd215 on whwmd215.t$cwar=whwmd217.t$cwar and whwmd215.t$item=whwmd217.t$item group by whwmd217.t$item,whwmd217.t$cwar) Q1 ON Q1.t$item=sli941.t$item$l AND Q1.t$cwar=sli941.t$cwar$l LEFT JOIN baandb.tcisli245301 cisli245 ON cisli245.t$fire$l=sli941.t$fire$l AND cisli245.t$line$l=sli941.t$line$l LEFT JOIN baandb.tcisli951301 cisli951 ON cisli951.t$fire$l=sli941.t$fire$l AND cisli951.t$line$l=sli941.t$line$l LEFT JOIN baandb.tznsls401301 znsls401 ON znsls401.t$orno$c=cisli245.t$slso AND znsls401.t$pono$c=cisli245.t$pono LEFT JOIN baandb.ttdsls401301 tdsls401 ON tdsls401.t$orno=cisli245.t$slso AND tdsls401.t$pono=cisli245.t$pono LEFT JOIN baandb.tznsls400301 sls400 ON sls400.t$ncia$c=znsls401.t$ncia$c AND sls400.t$uneg$c=znsls401.t$uneg$c AND sls400.t$pecl$c=znsls401.t$pecl$c AND sls400.t$sqpd$c=znsls401.t$sqpd$c LEFT JOIN baandb.ttccom130301 tccom130 ON tccom130.t$cadr=sli940.t$itoa$l LEFT JOIN baandb.ttccom130301 tccom130d ON tccom130d.t$cadr=sli940.t$IFBA$l INNER JOIN baandb.ttcibd001301 tcibd001 ON tcibd001.t$item=sli941.t$item$l LEFT JOIN baandb.ttcmcs060301 tcmcs060 ON tcmcs060.t$cmnf=tcibd001.t$cmnf LEFT JOIN baandb.ttccom130301 tccom130f ON tccom130f.t$cadr=tcmcs060.t$cadr LEFT JOIN baandb.ttcmcs966301 tcmcs966 ON tcmcs966.t$fdtc$l=sli940.t$fdtc$l LEFT JOIN (SELECT d.t$cnst CNST,l.t$desc DESC_TIPO_DOCTO FROM baandb.tttadv401000 d,baandb.tttadv140000 l WHERE d.t$cpac='ci' AND d.t$cdom='sli.tdff.l' AND l.t$clan='p' AND l.t$cpac='ci' AND l.t$clab=d.t$za_clab AND rpad(d.t$vers,4) || rpad(d.t$rele,2) || rpad(d.t$cust,4)=(select max(rpad(l1.t$vers,4) || rpad(l1.t$rele,2) || rpad(l1.t$cust,4)) from baandb.tttadv401000 l1 where l1.t$cpac=d.t$cpac and l1.t$cdom=d.t$cdom) AND rpad(l.t$vers,4) || rpad(l.t$rele,2) || rpad(l.t$cust,4)=(select max(rpad(l1.t$vers,4) || rpad(l1.t$rele,2) || rpad(l1.t$cust,4)) from baandb.tttadv140000 l1 where l1.t$clab=l.t$clab and l1.t$clan=l.t$clan and l1.t$cpac=l.t$cpac)) FGET ON sli940.t$fdty$l=FGET.CNST INNER JOIN WMWHSE5.ORDERS@DL_LN_WMS ORDERS_SH ON SUBSTR(ORDERS_SH.EXTERNORDERKEY,5,9)=nvl(CISLI245.T$SHPM,cisli951.t$shpm$l) LEFT JOIN (select MAX(a.ORDERKEY) ORDERKEY,MAX(a.TYPE) TYPE,a.REFERENCEDOCUMENT from WMWHSE5.ORDERS@DL_LN_WMS a group by a.REFERENCEDOCUMENT) ORDERS_OA ON SUBSTR(ORDERS_OA.REFERENCEDOCUMENT,4,9)=nvl(CISLI245.T$SLSO,cisli951.t$slso$l) LEFT JOIN (select MAX(a.ORDERKEY) ORDERKEY,MAX(a.TYPE) TYPE,a.REFERENCEDOCUMENT from WMWHSE5.ORDERS@DL_LN_WMS a group by a.REFERENCEDOCUMENT) ORDERS_OV ON ORDERS_OV.REFERENCEDOCUMENT=nvl(CISLI245.T$SLSO,cisli951.t$slso$l) LEFT JOIN WMWHSE5.CODELKUP@DL_LN_WMS CODELKUP_SH ON CODELKUP_SH.LISTNAME='ORDERTYPE' AND CODELKUP_SH.CODE=ORDERS_SH.TYPE LEFT JOIN WMWHSE5.CODELKUP@DL_LN_WMS CODELKUP_OA ON CODELKUP_OA.LISTNAME='ORDERTYPE' AND CODELKUP_OA.CODE=ORDERS_OA.TYPE LEFT JOIN WMWHSE5.CODELKUP@DL_LN_WMS CODELKUP_OV ON CODELKUP_OV.LISTNAME='ORDERTYPE' AND CODELKUP_OV.CODE=ORDERS_OV.TYPE LEFT JOIN baandb.tznsls000301 znsls000 ON znsls000.t$indt$c=TO_DATE('01-01-1970','DD-MM-YYYY') WHERE sli940.t$fdty$l NOT IN (11,14) AND sli940.t$stat$l NOT IN (2,101) AND sli940.t$docn$l !=0 AND sli941.t$item$l !=znsls000.t$itmd$c AND sli941.t$item$l !=znsls000.t$itmf$c AND sli941.t$item$l !=znsls000.t$itjl$c AND FILIAL.CHAVE_FILIAL='" + Parameters!Filial.Value + "' AND Trunc(CAST((FROM_TZ(TO_TIMESTAMP(TO_CHAR(sli940.t$date$l,'DD-MON-YYYY HH24:MI:SS'),'DD-MON-YYYY HH24:MI:SS'),'GMT') AT time zone 'America/Sao_Paulo') AS DATE)) Between '" + Parameters!EmissaoDe.Value + "' And '" + Parameters!EmissaoAte.Value + "' GROUP BY FILIAL.DSC_FILIAL,sli940.t$docn$l,sli940.t$seri$l,NVL(ORDERS_SH.ORDERKEY,NVL(ORDERS_OV.ORDERKEY,ORDERS_OA.ORDERKEY)),NVL(ORDERS_SH.REFERENCEDOCUMENT,NVL(ORDERS_OV.REFERENCEDOCUMENT,ORDERS_OA.REFERENCEDOCUMENT)),NVL(CODELKUP_SH.DESCRIPTION,NVL(CODELKUP_OV.DESCRIPTION,CODELKUP_OA.DESCRIPTION)),CAST((FROM_TZ(TO_TIMESTAMP(TO_CHAR(sli940.t$date$l,'DD-MON-YYYY HH24:MI:SS'),'DD-MON-YYYY HH24:MI:SS'),'GMT') AT time zone 'America/Sao_Paulo') AS DATE),sli940.t$ccfo$l,sli940.t$opor$l,mcs940.t$dsca$l,sls400.t$idca$c,TRIM(sli941.t$item$l),tcibd001.t$dsca ,CASE WHEN sli941.t$iprt$l=0 THEN round(tdsls401.t$pric,2) ELSE round(sli941.t$pric$l,2) END,CASE WHEN sli941.t$gamt$l=0 THEN round(tdsls401.t$pric,2) ELSE round(sli941.t$gamt$l,2) END,sli940.t$itbp$l,sli940.t$ifbp$l,sli940.t$itbn$l,sli940.t$ifbn$l,nvl(tccom130.t$namc,tccom130d.t$namc),nvl(tccom130.t$dist$l,tccom130d.t$dist$l),nvl(tccom130.t$pstc,tccom130d.t$pstc),nvl(tccom130.t$dsca,tccom130d.t$dsca),nvl(tccom130.t$cste,tccom130d.t$cste),nvl(tccom130.t$telp,tccom130d.t$telp),nvl(tccom130.t$telx,tccom130d.t$telx),nvl(tccom130.t$enfs$l,tccom130d.t$enfs$l),sli940.t$fdtc$l,tcmcs966.t$dsca$l,FGET.DESC_TIPO_DOCTO,tccom130f.t$fovn$l,tcmcs060.t$dsca,Q1.CMV_UNIT,ORDERS_SH.ORDERKEY,ORDERS_OV.orderkey,ORDERS_OA.orderkey,CISLI245.T$SHPM,cisli951.t$shpm$l,CISLI245.T$SLSO,cisli951.t$slso$l " &
"Union SELECT FILIAL.DSC_FILIAL FILIAL,sli940.t$docn$l NF,sli940.t$seri$l SERIE,NVL(ORDERS_SH.ORDERKEY,NVL(ORDERS_OV.ORDERKEY,ORDERS_OA.ORDERKEY)) PEDIDO_WMS,NVL(ORDERS_SH.REFERENCEDOCUMENT,NVL(ORDERS_OV.REFERENCEDOCUMENT,ORDERS_OA.REFERENCEDOCUMENT)) ORDEM_MOVIMENTACAO,NVL(CODELKUP_SH.DESCRIPTION,NVL(CODELKUP_OV.DESCRIPTION,CODELKUP_OA.DESCRIPTION)) DESCRICAO_PEDIDO,CAST((FROM_TZ(TO_TIMESTAMP(TO_CHAR(sli940.t$date$l,'DD-MON-YYYY HH24:MI:SS'),'DD-MON-YYYY HH24:MI:SS'),'GMT') AT time zone 'America/Sao_Paulo') AS DATE) DT_EMISSAO,sli940.t$ccfo$l CFO,sli940.t$opor$l SEQ_CFO,mcs940.t$dsca$l NOME_CFO,sls400.t$idca$c CANAL,TRIM(sli941.t$item$l) ID_ITEM,tcibd001.t$dsca NOME_ITEM,sum(sli941.t$dqua$l) QTD_FATURADA,CASE WHEN sli941.t$iprt$l=0 THEN round(tdsls401.t$pric,2) ELSE round(sli941.t$pric$l,2) END VL_PRODUTO,CASE WHEN sum(sli941.t$amnt$l)=0 THEN sum(tdsls401.t$oamt) ELSE sum(sli941.t$amnt$l) END VL_TOTAL_ITEM,CASE WHEN sli941.t$gamt$l=0 THEN round(tdsls401.t$pric,2) ELSE round(sli941.t$gamt$l,2) END VL_MERCADORIA,CASE WHEN sum(sli941.t$fght$l)=0 THEN sum(nvl(znsls401.t$vlfr$c,0)) ELSE sum(sli941.t$fght$l) END VL_FRETE,CASE WHEN sum(sli941.t$ldam$l)=0 THEN sum(nvl(znsls401.t$vlde$c,0)) ELSE sum(sli941.t$ldam$l) END VL_DESC_INC,sum(NVL((select sum(cisli943.t$amnt$l) from baandb.tcisli943301 cisli943 where cisli943.t$fire$l=sli941.t$fire$l and cisli943.t$LINE$l=sli941.t$LINE$l and cisli943.t$brty$l=1),0))VL_ICMS,sum(NVL((select sum(cisli943.t$amnt$l) from baandb.tcisli943301 cisli943 where cisli943.t$fire$l=sli941.t$fire$l and cisli943.t$line$l=sli941.t$line$l and cisli943.t$brty$l=5),0))VL_PIS,sum(NVL((select sum(cisli943.t$amnt$l) from baandb.tcisli943301 cisli943 where cisli943.t$fire$l=sli941.t$fire$l and cisli943.t$line$l=sli941.t$line$l and cisli943.t$brty$l=6),0))VL_COFINS,case when sli940.t$itbp$l=' ' then sli940.t$ifbp$l else sli940.t$itbp$l end ID_CLIENTE,case when sli940.t$itbn$l=' ' then sli940.t$ifbn$l else sli940.t$itbn$l end NOME_CLIENTE,nvl(tccom130.t$namc,tccom130d.t$namc) ENDERECO,nvl(tccom130.t$dist$l,tccom130d.t$dist$l) BAIRRO,nvl(tccom130.t$pstc,tccom130d.t$pstc) CEP,nvl(tccom130.t$dsca,tccom130d.t$dsca) MUNICIPIO,nvl(tccom130.t$cste,tccom130d.t$cste) UF,nvl(tccom130.t$telp,tccom130d.t$telp) TEL1,nvl(tccom130.t$telx,tccom130d.t$telx) TEL2,nvl(tccom130.t$enfs$l,tccom130d.t$enfs$l) EMAIL,sli940.t$fdtc$l ID_TIPO_DOC_FIS,tcmcs966.t$dsca$l DESCR_TIPO_DOC_FIS,FGET.DESC_TIPO_DOCTO DESC_TIPO_DOCTO,tccom130f.t$fovn$l CNPJ_FABRICANTE,tcmcs060.t$dsca NOME_FABRICANTE,Q1.CMV_UNIT FROM baandb.tcisli940301 sli940 INNER JOIN (select emm030.t$eunt CHAVE_FILIAL,emm030.t$dsca DSC_FILIAL,emm124.t$cwoc from baandb.ttcemm124301 emm124,baandb.ttcemm030301 emm030 where emm030.t$eunt=emm124.t$grid and emm124.t$loco=301) FILIAL ON FILIAL.t$cwoc=sli940.t$cofc$l LEFT JOIN baandb.ttcmcs940301 mcs940 ON mcs940.T$OFSO$L=sli940.t$ccfo$l INNER JOIN baandb.tcisli941301 sli941 ON sli941.t$fire$l=sli940.t$fire$l LEFT JOIN (select whwmd217.t$item,whwmd217.t$cwar,case when (max(whwmd215.t$qhnd) - max(whwmd215.t$qchd) - max(whwmd215.t$qnhd))=0 then 0 else round(sum(whwmd217.t$mauc$1) / (max(whwmd215.t$qhnd) - max(whwmd215.t$qchd) - max(whwmd215.t$qnhd)),4) end cmv_unit from baandb.twhwmd217301 whwmd217 inner join baandb.twhwmd215301 whwmd215 on whwmd215.t$cwar=whwmd217.t$cwar and whwmd215.t$item=whwmd217.t$item group by whwmd217.t$item,whwmd217.t$cwar) Q1 ON Q1.t$item=sli941.t$item$l AND Q1.t$cwar=sli941.t$cwar$l LEFT JOIN baandb.tcisli245301 cisli245 ON cisli245.t$fire$l=sli941.t$fire$l AND cisli245.t$line$l=sli941.t$line$l LEFT JOIN baandb.tcisli951301 cisli951 ON cisli951.t$fire$l=sli941.t$fire$l AND cisli951.t$line$l=sli941.t$line$l LEFT JOIN baandb.tznsls401301 znsls401 ON znsls401.t$orno$c=cisli245.t$slso AND znsls401.t$pono$c=cisli245.t$pono LEFT JOIN baandb.ttdsls401301 tdsls401 ON tdsls401.t$orno=cisli245.t$slso AND tdsls401.t$pono=cisli245.t$pono LEFT JOIN baandb.tznsls400301 sls400 ON sls400.t$ncia$c=znsls401.t$ncia$c AND sls400.t$uneg$c=znsls401.t$uneg$c AND sls400.t$pecl$c=znsls401.t$pecl$c AND sls400.t$sqpd$c=znsls401.t$sqpd$c LEFT JOIN baandb.ttccom130301 tccom130 ON tccom130.t$cadr=sli940.t$itoa$l LEFT JOIN baandb.ttccom130301 tccom130d ON tccom130d.t$cadr=sli940.t$IFBA$l INNER JOIN baandb.ttcibd001301 tcibd001 ON tcibd001.t$item=sli941.t$item$l LEFT JOIN baandb.ttcmcs060301 tcmcs060 ON tcmcs060.t$cmnf=tcibd001.t$cmnf LEFT JOIN baandb.ttccom130301 tccom130f ON tccom130f.t$cadr=tcmcs060.t$cadr LEFT JOIN baandb.ttcmcs966301 tcmcs966 ON tcmcs966.t$fdtc$l=sli940.t$fdtc$l LEFT JOIN (SELECT d.t$cnst CNST,l.t$desc DESC_TIPO_DOCTO FROM baandb.tttadv401000 d,baandb.tttadv140000 l WHERE d.t$cpac='ci' AND d.t$cdom='sli.tdff.l' AND l.t$clan='p' AND l.t$cpac='ci' AND l.t$clab=d.t$za_clab AND rpad(d.t$vers,4) || rpad(d.t$rele,2) || rpad(d.t$cust,4)=(select max(rpad(l1.t$vers,4) || rpad(l1.t$rele,2) || rpad(l1.t$cust,4)) from baandb.tttadv401000 l1 where l1.t$cpac=d.t$cpac and l1.t$cdom=d.t$cdom) AND rpad(l.t$vers,4) || rpad(l.t$rele,2) || rpad(l.t$cust,4)=(select max(rpad(l1.t$vers,4) || rpad(l1.t$rele,2) || rpad(l1.t$cust,4)) from baandb.tttadv140000 l1 where l1.t$clab=l.t$clab and l1.t$clan=l.t$clan and l1.t$cpac=l.t$cpac)) FGET ON sli940.t$fdty$l=FGET.CNST INNER JOIN WMWHSE6.ORDERS@DL_LN_WMS ORDERS_SH ON SUBSTR(ORDERS_SH.EXTERNORDERKEY,5,9)=nvl(CISLI245.T$SHPM,cisli951.t$shpm$l) LEFT JOIN (select MAX(a.ORDERKEY) ORDERKEY,MAX(a.TYPE) TYPE,a.REFERENCEDOCUMENT from WMWHSE6.ORDERS@DL_LN_WMS a group by a.REFERENCEDOCUMENT) ORDERS_OA ON SUBSTR(ORDERS_OA.REFERENCEDOCUMENT,4,9)=nvl(CISLI245.T$SLSO,cisli951.t$slso$l) LEFT JOIN (select MAX(a.ORDERKEY) ORDERKEY,MAX(a.TYPE) TYPE,a.REFERENCEDOCUMENT from WMWHSE6.ORDERS@DL_LN_WMS a group by a.REFERENCEDOCUMENT) ORDERS_OV ON ORDERS_OV.REFERENCEDOCUMENT=nvl(CISLI245.T$SLSO,cisli951.t$slso$l) LEFT JOIN WMWHSE6.CODELKUP@DL_LN_WMS CODELKUP_SH ON CODELKUP_SH.LISTNAME='ORDERTYPE' AND CODELKUP_SH.CODE=ORDERS_SH.TYPE LEFT JOIN WMWHSE6.CODELKUP@DL_LN_WMS CODELKUP_OA ON CODELKUP_OA.LISTNAME='ORDERTYPE' AND CODELKUP_OA.CODE=ORDERS_OA.TYPE LEFT JOIN WMWHSE6.CODELKUP@DL_LN_WMS CODELKUP_OV ON CODELKUP_OV.LISTNAME='ORDERTYPE' AND CODELKUP_OV.CODE=ORDERS_OV.TYPE LEFT JOIN baandb.tznsls000301 znsls000 ON znsls000.t$indt$c=TO_DATE('01-01-1970','DD-MM-YYYY') WHERE sli940.t$fdty$l NOT IN (11,14) AND sli940.t$stat$l NOT IN (2,101) AND sli940.t$docn$l !=0 AND sli941.t$item$l !=znsls000.t$itmd$c AND sli941.t$item$l !=znsls000.t$itmf$c AND sli941.t$item$l !=znsls000.t$itjl$c AND FILIAL.CHAVE_FILIAL='" + Parameters!Filial.Value + "' AND Trunc(CAST((FROM_TZ(TO_TIMESTAMP(TO_CHAR(sli940.t$date$l,'DD-MON-YYYY HH24:MI:SS'),'DD-MON-YYYY HH24:MI:SS'),'GMT') AT time zone 'America/Sao_Paulo') AS DATE)) Between '" + Parameters!EmissaoDe.Value + "' And '" + Parameters!EmissaoAte.Value + "' GROUP BY FILIAL.DSC_FILIAL,sli940.t$docn$l,sli940.t$seri$l,NVL(ORDERS_SH.ORDERKEY,NVL(ORDERS_OV.ORDERKEY,ORDERS_OA.ORDERKEY)),NVL(ORDERS_SH.REFERENCEDOCUMENT,NVL(ORDERS_OV.REFERENCEDOCUMENT,ORDERS_OA.REFERENCEDOCUMENT)),NVL(CODELKUP_SH.DESCRIPTION,NVL(CODELKUP_OV.DESCRIPTION,CODELKUP_OA.DESCRIPTION)),CAST((FROM_TZ(TO_TIMESTAMP(TO_CHAR(sli940.t$date$l,'DD-MON-YYYY HH24:MI:SS'),'DD-MON-YYYY HH24:MI:SS'),'GMT') AT time zone 'America/Sao_Paulo') AS DATE),sli940.t$ccfo$l,sli940.t$opor$l,mcs940.t$dsca$l,sls400.t$idca$c,TRIM(sli941.t$item$l),tcibd001.t$dsca ,CASE WHEN sli941.t$iprt$l=0 THEN round(tdsls401.t$pric,2) ELSE round(sli941.t$pric$l,2) END,CASE WHEN sli941.t$gamt$l=0 THEN round(tdsls401.t$pric,2) ELSE round(sli941.t$gamt$l,2) END,sli940.t$itbp$l,sli940.t$ifbp$l,sli940.t$itbn$l,sli940.t$ifbn$l,nvl(tccom130.t$namc,tccom130d.t$namc),nvl(tccom130.t$dist$l,tccom130d.t$dist$l),nvl(tccom130.t$pstc,tccom130d.t$pstc),nvl(tccom130.t$dsca,tccom130d.t$dsca),nvl(tccom130.t$cste,tccom130d.t$cste),nvl(tccom130.t$telp,tccom130d.t$telp),nvl(tccom130.t$telx,tccom130d.t$telx),nvl(tccom130.t$enfs$l,tccom130d.t$enfs$l),sli940.t$fdtc$l,tcmcs966.t$dsca$l,FGET.DESC_TIPO_DOCTO,tccom130f.t$fovn$l,tcmcs060.t$dsca,Q1.CMV_UNIT,ORDERS_SH.ORDERKEY,ORDERS_OV.orderkey,ORDERS_OA.orderkey,CISLI245.T$SHPM,cisli951.t$shpm$l,CISLI245.T$SLSO,cisli951.t$slso$l " &
"Union SELECT FILIAL.DSC_FILIAL FILIAL,sli940.t$docn$l NF,sli940.t$seri$l SERIE,NVL(ORDERS_SH.ORDERKEY,NVL(ORDERS_OV.ORDERKEY,ORDERS_OA.ORDERKEY)) PEDIDO_WMS,NVL(ORDERS_SH.REFERENCEDOCUMENT,NVL(ORDERS_OV.REFERENCEDOCUMENT,ORDERS_OA.REFERENCEDOCUMENT)) ORDEM_MOVIMENTACAO,NVL(CODELKUP_SH.DESCRIPTION,NVL(CODELKUP_OV.DESCRIPTION,CODELKUP_OA.DESCRIPTION)) DESCRICAO_PEDIDO,CAST((FROM_TZ(TO_TIMESTAMP(TO_CHAR(sli940.t$date$l,'DD-MON-YYYY HH24:MI:SS'),'DD-MON-YYYY HH24:MI:SS'),'GMT') AT time zone 'America/Sao_Paulo') AS DATE) DT_EMISSAO,sli940.t$ccfo$l CFO,sli940.t$opor$l SEQ_CFO,mcs940.t$dsca$l NOME_CFO,sls400.t$idca$c CANAL,TRIM(sli941.t$item$l) ID_ITEM,tcibd001.t$dsca NOME_ITEM,sum(sli941.t$dqua$l) QTD_FATURADA,CASE WHEN sli941.t$iprt$l=0 THEN round(tdsls401.t$pric,2) ELSE round(sli941.t$pric$l,2) END VL_PRODUTO,CASE WHEN sum(sli941.t$amnt$l)=0 THEN sum(tdsls401.t$oamt) ELSE sum(sli941.t$amnt$l) END VL_TOTAL_ITEM,CASE WHEN sli941.t$gamt$l=0 THEN round(tdsls401.t$pric,2) ELSE round(sli941.t$gamt$l,2) END VL_MERCADORIA,CASE WHEN sum(sli941.t$fght$l)=0 THEN sum(nvl(znsls401.t$vlfr$c,0)) ELSE sum(sli941.t$fght$l) END VL_FRETE,CASE WHEN sum(sli941.t$ldam$l)=0 THEN sum(nvl(znsls401.t$vlde$c,0)) ELSE sum(sli941.t$ldam$l) END VL_DESC_INC,sum(NVL((select sum(cisli943.t$amnt$l) from baandb.tcisli943301 cisli943 where cisli943.t$fire$l=sli941.t$fire$l and cisli943.t$LINE$l=sli941.t$LINE$l and cisli943.t$brty$l=1),0))VL_ICMS,sum(NVL((select sum(cisli943.t$amnt$l) from baandb.tcisli943301 cisli943 where cisli943.t$fire$l=sli941.t$fire$l and cisli943.t$line$l=sli941.t$line$l and cisli943.t$brty$l=5),0))VL_PIS,sum(NVL((select sum(cisli943.t$amnt$l) from baandb.tcisli943301 cisli943 where cisli943.t$fire$l=sli941.t$fire$l and cisli943.t$line$l=sli941.t$line$l and cisli943.t$brty$l=6),0))VL_COFINS,case when sli940.t$itbp$l=' ' then sli940.t$ifbp$l else sli940.t$itbp$l end ID_CLIENTE,case when sli940.t$itbn$l=' ' then sli940.t$ifbn$l else sli940.t$itbn$l end NOME_CLIENTE,nvl(tccom130.t$namc,tccom130d.t$namc) ENDERECO,nvl(tccom130.t$dist$l,tccom130d.t$dist$l) BAIRRO,nvl(tccom130.t$pstc,tccom130d.t$pstc) CEP,nvl(tccom130.t$dsca,tccom130d.t$dsca) MUNICIPIO,nvl(tccom130.t$cste,tccom130d.t$cste) UF,nvl(tccom130.t$telp,tccom130d.t$telp) TEL1,nvl(tccom130.t$telx,tccom130d.t$telx) TEL2,nvl(tccom130.t$enfs$l,tccom130d.t$enfs$l) EMAIL,sli940.t$fdtc$l ID_TIPO_DOC_FIS,tcmcs966.t$dsca$l DESCR_TIPO_DOC_FIS,FGET.DESC_TIPO_DOCTO DESC_TIPO_DOCTO,tccom130f.t$fovn$l CNPJ_FABRICANTE,tcmcs060.t$dsca NOME_FABRICANTE,Q1.CMV_UNIT FROM baandb.tcisli940301 sli940 INNER JOIN (select emm030.t$eunt CHAVE_FILIAL,emm030.t$dsca DSC_FILIAL,emm124.t$cwoc from baandb.ttcemm124301 emm124,baandb.ttcemm030301 emm030 where emm030.t$eunt=emm124.t$grid and emm124.t$loco=301) FILIAL ON FILIAL.t$cwoc=sli940.t$cofc$l LEFT JOIN baandb.ttcmcs940301 mcs940 ON mcs940.T$OFSO$L=sli940.t$ccfo$l INNER JOIN baandb.tcisli941301 sli941 ON sli941.t$fire$l=sli940.t$fire$l LEFT JOIN (select whwmd217.t$item,whwmd217.t$cwar,case when (max(whwmd215.t$qhnd) - max(whwmd215.t$qchd) - max(whwmd215.t$qnhd))=0 then 0 else round(sum(whwmd217.t$mauc$1) / (max(whwmd215.t$qhnd) - max(whwmd215.t$qchd) - max(whwmd215.t$qnhd)),4) end cmv_unit from baandb.twhwmd217301 whwmd217 inner join baandb.twhwmd215301 whwmd215 on whwmd215.t$cwar=whwmd217.t$cwar and whwmd215.t$item=whwmd217.t$item group by whwmd217.t$item,whwmd217.t$cwar) Q1 ON Q1.t$item=sli941.t$item$l AND Q1.t$cwar=sli941.t$cwar$l LEFT JOIN baandb.tcisli245301 cisli245 ON cisli245.t$fire$l=sli941.t$fire$l AND cisli245.t$line$l=sli941.t$line$l LEFT JOIN baandb.tcisli951301 cisli951 ON cisli951.t$fire$l=sli941.t$fire$l AND cisli951.t$line$l=sli941.t$line$l LEFT JOIN baandb.tznsls401301 znsls401 ON znsls401.t$orno$c=cisli245.t$slso AND znsls401.t$pono$c=cisli245.t$pono LEFT JOIN baandb.ttdsls401301 tdsls401 ON tdsls401.t$orno=cisli245.t$slso AND tdsls401.t$pono=cisli245.t$pono LEFT JOIN baandb.tznsls400301 sls400 ON sls400.t$ncia$c=znsls401.t$ncia$c AND sls400.t$uneg$c=znsls401.t$uneg$c AND sls400.t$pecl$c=znsls401.t$pecl$c AND sls400.t$sqpd$c=znsls401.t$sqpd$c LEFT JOIN baandb.ttccom130301 tccom130 ON tccom130.t$cadr=sli940.t$itoa$l LEFT JOIN baandb.ttccom130301 tccom130d ON tccom130d.t$cadr=sli940.t$IFBA$l INNER JOIN baandb.ttcibd001301 tcibd001 ON tcibd001.t$item=sli941.t$item$l LEFT JOIN baandb.ttcmcs060301 tcmcs060 ON tcmcs060.t$cmnf=tcibd001.t$cmnf LEFT JOIN baandb.ttccom130301 tccom130f ON tccom130f.t$cadr=tcmcs060.t$cadr LEFT JOIN baandb.ttcmcs966301 tcmcs966 ON tcmcs966.t$fdtc$l=sli940.t$fdtc$l LEFT JOIN (SELECT d.t$cnst CNST,l.t$desc DESC_TIPO_DOCTO FROM baandb.tttadv401000 d,baandb.tttadv140000 l WHERE d.t$cpac='ci' AND d.t$cdom='sli.tdff.l' AND l.t$clan='p' AND l.t$cpac='ci' AND l.t$clab=d.t$za_clab AND rpad(d.t$vers,4) || rpad(d.t$rele,2) || rpad(d.t$cust,4)=(select max(rpad(l1.t$vers,4) || rpad(l1.t$rele,2) || rpad(l1.t$cust,4)) from baandb.tttadv401000 l1 where l1.t$cpac=d.t$cpac and l1.t$cdom=d.t$cdom) AND rpad(l.t$vers,4) || rpad(l.t$rele,2) || rpad(l.t$cust,4)=(select max(rpad(l1.t$vers,4) || rpad(l1.t$rele,2) || rpad(l1.t$cust,4)) from baandb.tttadv140000 l1 where l1.t$clab=l.t$clab and l1.t$clan=l.t$clan and l1.t$cpac=l.t$cpac)) FGET ON sli940.t$fdty$l=FGET.CNST INNER JOIN WMWHSE7.ORDERS@DL_LN_WMS ORDERS_SH ON SUBSTR(ORDERS_SH.EXTERNORDERKEY,5,9)=nvl(CISLI245.T$SHPM,cisli951.t$shpm$l) LEFT JOIN (select MAX(a.ORDERKEY) ORDERKEY,MAX(a.TYPE) TYPE,a.REFERENCEDOCUMENT from WMWHSE7.ORDERS@DL_LN_WMS a group by a.REFERENCEDOCUMENT) ORDERS_OA ON SUBSTR(ORDERS_OA.REFERENCEDOCUMENT,4,9)=nvl(CISLI245.T$SLSO,cisli951.t$slso$l) LEFT JOIN (select MAX(a.ORDERKEY) ORDERKEY,MAX(a.TYPE) TYPE,a.REFERENCEDOCUMENT from WMWHSE7.ORDERS@DL_LN_WMS a group by a.REFERENCEDOCUMENT) ORDERS_OV ON ORDERS_OV.REFERENCEDOCUMENT=nvl(CISLI245.T$SLSO,cisli951.t$slso$l) LEFT JOIN WMWHSE7.CODELKUP@DL_LN_WMS CODELKUP_SH ON CODELKUP_SH.LISTNAME='ORDERTYPE' AND CODELKUP_SH.CODE=ORDERS_SH.TYPE LEFT JOIN WMWHSE7.CODELKUP@DL_LN_WMS CODELKUP_OA ON CODELKUP_OA.LISTNAME='ORDERTYPE' AND CODELKUP_OA.CODE=ORDERS_OA.TYPE LEFT JOIN WMWHSE7.CODELKUP@DL_LN_WMS CODELKUP_OV ON CODELKUP_OV.LISTNAME='ORDERTYPE' AND CODELKUP_OV.CODE=ORDERS_OV.TYPE LEFT JOIN baandb.tznsls000301 znsls000 ON znsls000.t$indt$c=TO_DATE('01-01-1970','DD-MM-YYYY') WHERE sli940.t$fdty$l NOT IN (11,14) AND sli940.t$stat$l NOT IN (2,101) AND sli940.t$docn$l !=0 AND sli941.t$item$l !=znsls000.t$itmd$c AND sli941.t$item$l !=znsls000.t$itmf$c AND sli941.t$item$l !=znsls000.t$itjl$c AND FILIAL.CHAVE_FILIAL='" + Parameters!Filial.Value + "' AND Trunc(CAST((FROM_TZ(TO_TIMESTAMP(TO_CHAR(sli940.t$date$l,'DD-MON-YYYY HH24:MI:SS'),'DD-MON-YYYY HH24:MI:SS'),'GMT') AT time zone 'America/Sao_Paulo') AS DATE)) Between '" + Parameters!EmissaoDe.Value + "' And '" + Parameters!EmissaoAte.Value + "' GROUP BY FILIAL.DSC_FILIAL,sli940.t$docn$l,sli940.t$seri$l,NVL(ORDERS_SH.ORDERKEY,NVL(ORDERS_OV.ORDERKEY,ORDERS_OA.ORDERKEY)),NVL(ORDERS_SH.REFERENCEDOCUMENT,NVL(ORDERS_OV.REFERENCEDOCUMENT,ORDERS_OA.REFERENCEDOCUMENT)),NVL(CODELKUP_SH.DESCRIPTION,NVL(CODELKUP_OV.DESCRIPTION,CODELKUP_OA.DESCRIPTION)),CAST((FROM_TZ(TO_TIMESTAMP(TO_CHAR(sli940.t$date$l,'DD-MON-YYYY HH24:MI:SS'),'DD-MON-YYYY HH24:MI:SS'),'GMT') AT time zone 'America/Sao_Paulo') AS DATE),sli940.t$ccfo$l,sli940.t$opor$l,mcs940.t$dsca$l,sls400.t$idca$c,TRIM(sli941.t$item$l),tcibd001.t$dsca ,CASE WHEN sli941.t$iprt$l=0 THEN round(tdsls401.t$pric,2) ELSE round(sli941.t$pric$l,2) END,CASE WHEN sli941.t$gamt$l=0 THEN round(tdsls401.t$pric,2) ELSE round(sli941.t$gamt$l,2) END,sli940.t$itbp$l,sli940.t$ifbp$l,sli940.t$itbn$l,sli940.t$ifbn$l,nvl(tccom130.t$namc,tccom130d.t$namc),nvl(tccom130.t$dist$l,tccom130d.t$dist$l),nvl(tccom130.t$pstc,tccom130d.t$pstc),nvl(tccom130.t$dsca,tccom130d.t$dsca),nvl(tccom130.t$cste,tccom130d.t$cste),nvl(tccom130.t$telp,tccom130d.t$telp),nvl(tccom130.t$telx,tccom130d.t$telx),nvl(tccom130.t$enfs$l,tccom130d.t$enfs$l),sli940.t$fdtc$l,tcmcs966.t$dsca$l,FGET.DESC_TIPO_DOCTO,tccom130f.t$fovn$l,tcmcs060.t$dsca,Q1.CMV_UNIT,ORDERS_SH.ORDERKEY,ORDERS_OV.orderkey,ORDERS_OA.orderkey,CISLI245.T$SHPM,cisli951.t$shpm$l,CISLI245.T$SLSO,cisli951.t$slso$l " &
"Union SELECT FILIAL.DSC_FILIAL FILIAL,sli940.t$docn$l NF,sli940.t$seri$l SERIE,NVL(ORDERS_SH.ORDERKEY,NVL(ORDERS_OV.ORDERKEY,ORDERS_OA.ORDERKEY)) PEDIDO_WMS,NVL(ORDERS_SH.REFERENCEDOCUMENT,NVL(ORDERS_OV.REFERENCEDOCUMENT,ORDERS_OA.REFERENCEDOCUMENT)) ORDEM_MOVIMENTACAO,NVL(CODELKUP_SH.DESCRIPTION,NVL(CODELKUP_OV.DESCRIPTION,CODELKUP_OA.DESCRIPTION)) DESCRICAO_PEDIDO,CAST((FROM_TZ(TO_TIMESTAMP(TO_CHAR(sli940.t$date$l,'DD-MON-YYYY HH24:MI:SS'),'DD-MON-YYYY HH24:MI:SS'),'GMT') AT time zone 'America/Sao_Paulo') AS DATE) DT_EMISSAO,sli940.t$ccfo$l CFO,sli940.t$opor$l SEQ_CFO,mcs940.t$dsca$l NOME_CFO,sls400.t$idca$c CANAL,TRIM(sli941.t$item$l) ID_ITEM,tcibd001.t$dsca NOME_ITEM,sum(sli941.t$dqua$l) QTD_FATURADA,CASE WHEN sli941.t$iprt$l=0 THEN round(tdsls401.t$pric,2) ELSE round(sli941.t$pric$l,2) END VL_PRODUTO,CASE WHEN sum(sli941.t$amnt$l)=0 THEN sum(tdsls401.t$oamt) ELSE sum(sli941.t$amnt$l) END VL_TOTAL_ITEM,CASE WHEN sli941.t$gamt$l=0 THEN round(tdsls401.t$pric,2) ELSE round(sli941.t$gamt$l,2) END VL_MERCADORIA,CASE WHEN sum(sli941.t$fght$l)=0 THEN sum(nvl(znsls401.t$vlfr$c,0)) ELSE sum(sli941.t$fght$l) END VL_FRETE,CASE WHEN sum(sli941.t$ldam$l)=0 THEN sum(nvl(znsls401.t$vlde$c,0)) ELSE sum(sli941.t$ldam$l) END VL_DESC_INC,sum(NVL((select sum(cisli943.t$amnt$l) from baandb.tcisli943301 cisli943 where cisli943.t$fire$l=sli941.t$fire$l and cisli943.t$LINE$l=sli941.t$LINE$l and cisli943.t$brty$l=1),0))VL_ICMS,sum(NVL((select sum(cisli943.t$amnt$l) from baandb.tcisli943301 cisli943 where cisli943.t$fire$l=sli941.t$fire$l and cisli943.t$line$l=sli941.t$line$l and cisli943.t$brty$l=5),0))VL_PIS,sum(NVL((select sum(cisli943.t$amnt$l) from baandb.tcisli943301 cisli943 where cisli943.t$fire$l=sli941.t$fire$l and cisli943.t$line$l=sli941.t$line$l and cisli943.t$brty$l=6),0))VL_COFINS,case when sli940.t$itbp$l=' ' then sli940.t$ifbp$l else sli940.t$itbp$l end ID_CLIENTE,case when sli940.t$itbn$l=' ' then sli940.t$ifbn$l else sli940.t$itbn$l end NOME_CLIENTE,nvl(tccom130.t$namc,tccom130d.t$namc) ENDERECO,nvl(tccom130.t$dist$l,tccom130d.t$dist$l) BAIRRO,nvl(tccom130.t$pstc,tccom130d.t$pstc) CEP,nvl(tccom130.t$dsca,tccom130d.t$dsca) MUNICIPIO,nvl(tccom130.t$cste,tccom130d.t$cste) UF,nvl(tccom130.t$telp,tccom130d.t$telp) TEL1,nvl(tccom130.t$telx,tccom130d.t$telx) TEL2,nvl(tccom130.t$enfs$l,tccom130d.t$enfs$l) EMAIL,sli940.t$fdtc$l ID_TIPO_DOC_FIS,tcmcs966.t$dsca$l DESCR_TIPO_DOC_FIS,FGET.DESC_TIPO_DOCTO DESC_TIPO_DOCTO,tccom130f.t$fovn$l CNPJ_FABRICANTE,tcmcs060.t$dsca NOME_FABRICANTE,Q1.CMV_UNIT FROM baandb.tcisli940301 sli940 INNER JOIN (select emm030.t$eunt CHAVE_FILIAL,emm030.t$dsca DSC_FILIAL,emm124.t$cwoc from baandb.ttcemm124301 emm124,baandb.ttcemm030301 emm030 where emm030.t$eunt=emm124.t$grid and emm124.t$loco=301) FILIAL ON FILIAL.t$cwoc=sli940.t$cofc$l LEFT JOIN baandb.ttcmcs940301 mcs940 ON mcs940.T$OFSO$L=sli940.t$ccfo$l INNER JOIN baandb.tcisli941301 sli941 ON sli941.t$fire$l=sli940.t$fire$l LEFT JOIN (select whwmd217.t$item,whwmd217.t$cwar,case when (max(whwmd215.t$qhnd) - max(whwmd215.t$qchd) - max(whwmd215.t$qnhd))=0 then 0 else round(sum(whwmd217.t$mauc$1) / (max(whwmd215.t$qhnd) - max(whwmd215.t$qchd) - max(whwmd215.t$qnhd)),4) end cmv_unit from baandb.twhwmd217301 whwmd217 inner join baandb.twhwmd215301 whwmd215 on whwmd215.t$cwar=whwmd217.t$cwar and whwmd215.t$item=whwmd217.t$item group by whwmd217.t$item,whwmd217.t$cwar) Q1 ON Q1.t$item=sli941.t$item$l AND Q1.t$cwar=sli941.t$cwar$l LEFT JOIN baandb.tcisli245301 cisli245 ON cisli245.t$fire$l=sli941.t$fire$l AND cisli245.t$line$l=sli941.t$line$l LEFT JOIN baandb.tcisli951301 cisli951 ON cisli951.t$fire$l=sli941.t$fire$l AND cisli951.t$line$l=sli941.t$line$l LEFT JOIN baandb.tznsls401301 znsls401 ON znsls401.t$orno$c=cisli245.t$slso AND znsls401.t$pono$c=cisli245.t$pono LEFT JOIN baandb.ttdsls401301 tdsls401 ON tdsls401.t$orno=cisli245.t$slso AND tdsls401.t$pono=cisli245.t$pono LEFT JOIN baandb.tznsls400301 sls400 ON sls400.t$ncia$c=znsls401.t$ncia$c AND sls400.t$uneg$c=znsls401.t$uneg$c AND sls400.t$pecl$c=znsls401.t$pecl$c AND sls400.t$sqpd$c=znsls401.t$sqpd$c LEFT JOIN baandb.ttccom130301 tccom130 ON tccom130.t$cadr=sli940.t$itoa$l LEFT JOIN baandb.ttccom130301 tccom130d ON tccom130d.t$cadr=sli940.t$IFBA$l INNER JOIN baandb.ttcibd001301 tcibd001 ON tcibd001.t$item=sli941.t$item$l LEFT JOIN baandb.ttcmcs060301 tcmcs060 ON tcmcs060.t$cmnf=tcibd001.t$cmnf LEFT JOIN baandb.ttccom130301 tccom130f ON tccom130f.t$cadr=tcmcs060.t$cadr LEFT JOIN baandb.ttcmcs966301 tcmcs966 ON tcmcs966.t$fdtc$l=sli940.t$fdtc$l LEFT JOIN (SELECT d.t$cnst CNST,l.t$desc DESC_TIPO_DOCTO FROM baandb.tttadv401000 d,baandb.tttadv140000 l WHERE d.t$cpac='ci' AND d.t$cdom='sli.tdff.l' AND l.t$clan='p' AND l.t$cpac='ci' AND l.t$clab=d.t$za_clab AND rpad(d.t$vers,4) || rpad(d.t$rele,2) || rpad(d.t$cust,4)=(select max(rpad(l1.t$vers,4) || rpad(l1.t$rele,2) || rpad(l1.t$cust,4)) from baandb.tttadv401000 l1 where l1.t$cpac=d.t$cpac and l1.t$cdom=d.t$cdom) AND rpad(l.t$vers,4) || rpad(l.t$rele,2) || rpad(l.t$cust,4)=(select max(rpad(l1.t$vers,4) || rpad(l1.t$rele,2) || rpad(l1.t$cust,4)) from baandb.tttadv140000 l1 where l1.t$clab=l.t$clab and l1.t$clan=l.t$clan and l1.t$cpac=l.t$cpac)) FGET ON sli940.t$fdty$l=FGET.CNST INNER JOIN WMWHSE8.ORDERS@DL_LN_WMS ORDERS_SH ON SUBSTR(ORDERS_SH.EXTERNORDERKEY,5,9)=nvl(CISLI245.T$SHPM,cisli951.t$shpm$l) LEFT JOIN (select MAX(a.ORDERKEY) ORDERKEY,MAX(a.TYPE) TYPE,a.REFERENCEDOCUMENT from WMWHSE8.ORDERS@DL_LN_WMS a group by a.REFERENCEDOCUMENT) ORDERS_OA ON SUBSTR(ORDERS_OA.REFERENCEDOCUMENT,4,9)=nvl(CISLI245.T$SLSO,cisli951.t$slso$l) LEFT JOIN (select MAX(a.ORDERKEY) ORDERKEY,MAX(a.TYPE) TYPE,a.REFERENCEDOCUMENT from WMWHSE8.ORDERS@DL_LN_WMS a group by a.REFERENCEDOCUMENT) ORDERS_OV ON ORDERS_OV.REFERENCEDOCUMENT=nvl(CISLI245.T$SLSO,cisli951.t$slso$l) LEFT JOIN WMWHSE8.CODELKUP@DL_LN_WMS CODELKUP_SH ON CODELKUP_SH.LISTNAME='ORDERTYPE' AND CODELKUP_SH.CODE=ORDERS_SH.TYPE LEFT JOIN WMWHSE8.CODELKUP@DL_LN_WMS CODELKUP_OA ON CODELKUP_OA.LISTNAME='ORDERTYPE' AND CODELKUP_OA.CODE=ORDERS_OA.TYPE LEFT JOIN WMWHSE8.CODELKUP@DL_LN_WMS CODELKUP_OV ON CODELKUP_OV.LISTNAME='ORDERTYPE' AND CODELKUP_OV.CODE=ORDERS_OV.TYPE LEFT JOIN baandb.tznsls000301 znsls000 ON znsls000.t$indt$c=TO_DATE('01-01-1970','DD-MM-YYYY') WHERE sli940.t$fdty$l NOT IN (11,14) AND sli940.t$stat$l NOT IN (2,101) AND sli940.t$docn$l !=0 AND sli941.t$item$l !=znsls000.t$itmd$c AND sli941.t$item$l !=znsls000.t$itmf$c AND sli941.t$item$l !=znsls000.t$itjl$c AND FILIAL.CHAVE_FILIAL='" + Parameters!Filial.Value + "' AND Trunc(CAST((FROM_TZ(TO_TIMESTAMP(TO_CHAR(sli940.t$date$l,'DD-MON-YYYY HH24:MI:SS'),'DD-MON-YYYY HH24:MI:SS'),'GMT') AT time zone 'America/Sao_Paulo') AS DATE)) Between '" + Parameters!EmissaoDe.Value + "' And '" + Parameters!EmissaoAte.Value + "' GROUP BY FILIAL.DSC_FILIAL,sli940.t$docn$l,sli940.t$seri$l,NVL(ORDERS_SH.ORDERKEY,NVL(ORDERS_OV.ORDERKEY,ORDERS_OA.ORDERKEY)),NVL(ORDERS_SH.REFERENCEDOCUMENT,NVL(ORDERS_OV.REFERENCEDOCUMENT,ORDERS_OA.REFERENCEDOCUMENT)),NVL(CODELKUP_SH.DESCRIPTION,NVL(CODELKUP_OV.DESCRIPTION,CODELKUP_OA.DESCRIPTION)),CAST((FROM_TZ(TO_TIMESTAMP(TO_CHAR(sli940.t$date$l,'DD-MON-YYYY HH24:MI:SS'),'DD-MON-YYYY HH24:MI:SS'),'GMT') AT time zone 'America/Sao_Paulo') AS DATE),sli940.t$ccfo$l,sli940.t$opor$l,mcs940.t$dsca$l,sls400.t$idca$c,TRIM(sli941.t$item$l),tcibd001.t$dsca ,CASE WHEN sli941.t$iprt$l=0 THEN round(tdsls401.t$pric,2) ELSE round(sli941.t$pric$l,2) END,CASE WHEN sli941.t$gamt$l=0 THEN round(tdsls401.t$pric,2) ELSE round(sli941.t$gamt$l,2) END,sli940.t$itbp$l,sli940.t$ifbp$l,sli940.t$itbn$l,sli940.t$ifbn$l,nvl(tccom130.t$namc,tccom130d.t$namc),nvl(tccom130.t$dist$l,tccom130d.t$dist$l),nvl(tccom130.t$pstc,tccom130d.t$pstc),nvl(tccom130.t$dsca,tccom130d.t$dsca),nvl(tccom130.t$cste,tccom130d.t$cste),nvl(tccom130.t$telp,tccom130d.t$telp),nvl(tccom130.t$telx,tccom130d.t$telx),nvl(tccom130.t$enfs$l,tccom130d.t$enfs$l),sli940.t$fdtc$l,tcmcs966.t$dsca$l,FGET.DESC_TIPO_DOCTO,tccom130f.t$fovn$l,tcmcs060.t$dsca,Q1.CMV_UNIT,ORDERS_SH.ORDERKEY,ORDERS_OV.orderkey,ORDERS_OA.orderkey,CISLI245.T$SHPM,cisli951.t$shpm$l,CISLI245.T$SLSO,cisli951.t$slso$l " &
"    ORDER BY FILIAL,DT_EMISSAO,NF"


--eHub**************************************************************************************************************************************************

=IIF(Parameters!Filial.Value = "N00001",

"      SELECT FILIAL.DSC_FILIAL FILIAL,sli940.t$docn$l NF,sli940.t$seri$l SERIE,NVL(ORDERS_SH.ORDERKEY,NVL(ORDERS_OV.ORDERKEY,ORDERS_OA.ORDERKEY)) PEDIDO_WMS,NVL(ORDERS_SH.REFERENCEDOCUMENT,NVL(ORDERS_OV.REFERENCEDOCUMENT,ORDERS_OA.REFERENCEDOCUMENT)) ORDEM_MOVIMENTACAO,NVL(CODELKUP_SH.DESCRIPTION,NVL(CODELKUP_OV.DESCRIPTION,CODELKUP_OA.DESCRIPTION)) DESCRICAO_PEDIDO,CAST((FROM_TZ(TO_TIMESTAMP(TO_CHAR(sli940.t$date$l,'DD-MON-YYYY HH24:MI:SS'),'DD-MON-YYYY HH24:MI:SS'),'GMT') AT time zone 'America/Sao_Paulo') AS DATE) DT_EMISSAO,sli940.t$ccfo$l CFO,sli940.t$opor$l SEQ_CFO,mcs940.t$dsca$l NOME_CFO,sls400.t$idca$c CANAL,TRIM(sli941.t$item$l) ID_ITEM,tcibd001.t$dsca NOME_ITEM,sum(sli941.t$dqua$l) QTD_FATURADA,CASE WHEN sli941.t$iprt$l=0 THEN round(tdsls401.t$pric,2) ELSE round(sli941.t$pric$l,2) END VL_PRODUTO,CASE WHEN sum(sli941.t$amnt$l)=0 THEN sum(tdsls401.t$oamt) ELSE sum(sli941.t$amnt$l) END VL_TOTAL_ITEM,CASE WHEN sli941.t$gamt$l=0 THEN round(tdsls401.t$pric,2) ELSE round(sli941.t$gamt$l,2) END VL_MERCADORIA,CASE WHEN sum(sli941.t$fght$l)=0 THEN sum(nvl(znsls401.t$vlfr$c,0)) ELSE sum(sli941.t$fght$l) END VL_FRETE,CASE WHEN sum(sli941.t$ldam$l)=0 THEN sum(nvl(znsls401.t$vlde$c,0)) ELSE sum(sli941.t$ldam$l) END VL_DESC_INC,sum(NVL((select sum(cisli943.t$amnt$l) from baandb.tcisli943601 cisli943 where cisli943.t$fire$l=sli941.t$fire$l and cisli943.t$LINE$l=sli941.t$LINE$l and cisli943.t$brty$l=1),0))VL_ICMS,sum(NVL((select sum(cisli943.t$amnt$l) from baandb.tcisli943601 cisli943 where cisli943.t$fire$l=sli941.t$fire$l and cisli943.t$line$l=sli941.t$line$l and cisli943.t$brty$l=5),0))VL_PIS,sum(NVL((select sum(cisli943.t$amnt$l) from baandb.tcisli943601 cisli943 where cisli943.t$fire$l=sli941.t$fire$l and cisli943.t$line$l=sli941.t$line$l and cisli943.t$brty$l=6),0))VL_COFINS,case when sli940.t$itbp$l=' ' then sli940.t$ifbp$l else sli940.t$itbp$l end ID_CLIENTE,case when sli940.t$itbn$l=' ' then sli940.t$ifbn$l else sli940.t$itbn$l end NOME_CLIENTE,nvl(tccom130.t$namc,tccom130d.t$namc) ENDERECO,nvl(tccom130.t$dist$l,tccom130d.t$dist$l) BAIRRO,nvl(tccom130.t$pstc,tccom130d.t$pstc) CEP,nvl(tccom130.t$dsca,tccom130d.t$dsca) MUNICIPIO,nvl(tccom130.t$cste,tccom130d.t$cste) UF,nvl(tccom130.t$telp,tccom130d.t$telp) TEL1,nvl(tccom130.t$telx,tccom130d.t$telx) TEL2,nvl(tccom130.t$enfs$l,tccom130d.t$enfs$l) EMAIL,sli940.t$fdtc$l ID_TIPO_DOC_FIS,tcmcs966.t$dsca$l DESCR_TIPO_DOC_FIS,FGET.DESC_TIPO_DOCTO DESC_TIPO_DOCTO,tccom130f.t$fovn$l CNPJ_FABRICANTE,tcmcs060.t$dsca NOME_FABRICANTE,Q1.CMV_UNIT FROM baandb.tcisli940601 sli940 INNER JOIN (select emm030.t$eunt CHAVE_FILIAL,emm030.t$dsca DSC_FILIAL,emm124.t$cwoc from baandb.ttcemm124601 emm124,baandb.ttcemm030601 emm030 where emm030.t$eunt=emm124.t$grid and emm124.t$loco=601) FILIAL ON FILIAL.t$cwoc=sli940.t$cofc$l LEFT JOIN baandb.ttcmcs940601 mcs940 ON mcs940.T$OFSO$L=sli940.t$ccfo$l INNER JOIN baandb.tcisli941601 sli941 ON sli941.t$fire$l=sli940.t$fire$l LEFT JOIN (select whwmd217.t$item,whwmd217.t$cwar,case when (max(whwmd215.t$qhnd) - max(whwmd215.t$qchd) - max(whwmd215.t$qnhd))=0 then 0 else round(sum(whwmd217.t$mauc$1) / (max(whwmd215.t$qhnd) - max(whwmd215.t$qchd) - max(whwmd215.t$qnhd)),4) end cmv_unit from baandb.twhwmd217601 whwmd217 inner join baandb.twhwmd215601 whwmd215 on whwmd215.t$cwar=whwmd217.t$cwar and whwmd215.t$item=whwmd217.t$item group by whwmd217.t$item,whwmd217.t$cwar) Q1 ON Q1.t$item=sli941.t$item$l AND Q1.t$cwar=sli941.t$cwar$l LEFT JOIN baandb.tcisli245601 cisli245 ON cisli245.t$fire$l=sli941.t$fire$l AND cisli245.t$line$l=sli941.t$line$l LEFT JOIN baandb.tcisli951601 cisli951 ON cisli951.t$fire$l=sli941.t$fire$l AND cisli951.t$line$l=sli941.t$line$l LEFT JOIN baandb.tznsls401601 znsls401 ON znsls401.t$orno$c=cisli245.t$slso AND znsls401.t$pono$c=cisli245.t$pono LEFT JOIN baandb.ttdsls401601 tdsls401 ON tdsls401.t$orno=cisli245.t$slso AND tdsls401.t$pono=cisli245.t$pono LEFT JOIN baandb.tznsls400601 sls400 ON sls400.t$ncia$c=znsls401.t$ncia$c AND sls400.t$uneg$c=znsls401.t$uneg$c AND sls400.t$pecl$c=znsls401.t$pecl$c AND sls400.t$sqpd$c=znsls401.t$sqpd$c LEFT JOIN baandb.ttccom130601 tccom130 ON tccom130.t$cadr=sli940.t$itoa$l LEFT JOIN baandb.ttccom130601 tccom130d ON tccom130d.t$cadr=sli940.t$IFBA$l INNER JOIN baandb.ttcibd001601 tcibd001 ON tcibd001.t$item=sli941.t$item$l LEFT JOIN baandb.ttcmcs060601 tcmcs060 ON tcmcs060.t$cmnf=tcibd001.t$cmnf LEFT JOIN baandb.ttccom130601 tccom130f ON tccom130f.t$cadr=tcmcs060.t$cadr LEFT JOIN baandb.ttcmcs966601 tcmcs966 ON tcmcs966.t$fdtc$l=sli940.t$fdtc$l LEFT JOIN (SELECT d.t$cnst CNST,l.t$desc DESC_TIPO_DOCTO FROM baandb.tttadv401000 d,baandb.tttadv140000 l WHERE d.t$cpac='ci' AND d.t$cdom='sli.tdff.l' AND l.t$clan='p' AND l.t$cpac='ci' AND l.t$clab=d.t$za_clab AND rpad(d.t$vers,4) || rpad(d.t$rele,2) || rpad(d.t$cust,4)=(select max(rpad(l1.t$vers,4) || rpad(l1.t$rele,2) || rpad(l1.t$cust,4)) from baandb.tttadv401000 l1 where l1.t$cpac=d.t$cpac and l1.t$cdom=d.t$cdom) AND rpad(l.t$vers,4) || rpad(l.t$rele,2) || rpad(l.t$cust,4)=(select max(rpad(l1.t$vers,4) || rpad(l1.t$rele,2) || rpad(l1.t$cust,4)) from baandb.tttadv140000 l1 where l1.t$clab=l.t$clab and l1.t$clan=l.t$clan and l1.t$cpac=l.t$cpac)) FGET ON sli940.t$fdty$l=FGET.CNST INNER JOIN WMWHSE9.ORDERS@DL_LN_WMS ORDERS_SH ON SUBSTR(ORDERS_SH.EXTERNORDERKEY,5,9)=nvl(CISLI245.T$SHPM,cisli951.t$shpm$l) LEFT JOIN (select MAX(a.ORDERKEY) ORDERKEY,MAX(a.TYPE) TYPE,a.REFERENCEDOCUMENT from WMWHSE9.ORDERS@DL_LN_WMS a group by a.REFERENCEDOCUMENT) ORDERS_OA ON SUBSTR(ORDERS_OA.REFERENCEDOCUMENT,4,9)=nvl(CISLI245.T$SLSO,cisli951.t$slso$l) LEFT JOIN (select MAX(a.ORDERKEY) ORDERKEY,MAX(a.TYPE) TYPE,a.REFERENCEDOCUMENT from WMWHSE9.ORDERS@DL_LN_WMS a group by a.REFERENCEDOCUMENT) ORDERS_OV ON ORDERS_OV.REFERENCEDOCUMENT=nvl(CISLI245.T$SLSO,cisli951.t$slso$l) LEFT JOIN WMWHSE9.CODELKUP@DL_LN_WMS CODELKUP_SH ON CODELKUP_SH.LISTNAME='ORDERTYPE' AND CODELKUP_SH.CODE=ORDERS_SH.TYPE LEFT JOIN WMWHSE9.CODELKUP@DL_LN_WMS CODELKUP_OA ON CODELKUP_OA.LISTNAME='ORDERTYPE' AND CODELKUP_OA.CODE=ORDERS_OA.TYPE LEFT JOIN WMWHSE9.CODELKUP@DL_LN_WMS CODELKUP_OV ON CODELKUP_OV.LISTNAME='ORDERTYPE' AND CODELKUP_OV.CODE=ORDERS_OV.TYPE LEFT JOIN baandb.tznsls000601 znsls000 ON znsls000.t$indt$c=TO_DATE('01-01-1970','DD-MM-YYYY') WHERE sli940.t$fdty$l NOT IN (11,14) AND sli940.t$stat$l NOT IN (2,101) AND sli940.t$docn$l !=0 AND sli941.t$item$l !=znsls000.t$itmd$c AND sli941.t$item$l !=znsls000.t$itmf$c AND sli941.t$item$l !=znsls000.t$itjl$c AND FILIAL.CHAVE_FILIAL='" + Parameters!Filial.Value + "' AND Trunc(CAST((FROM_TZ(TO_TIMESTAMP(TO_CHAR(sli940.t$date$l,'DD-MON-YYYY HH24:MI:SS'),'DD-MON-YYYY HH24:MI:SS'),'GMT') AT time zone 'America/Sao_Paulo') AS DATE)) Between '" + Parameters!EmissaoDe.Value + "' And '" + Parameters!EmissaoAte.Value + "' GROUP BY FILIAL.DSC_FILIAL,sli940.t$docn$l,sli940.t$seri$l,NVL(ORDERS_SH.ORDERKEY,NVL(ORDERS_OV.ORDERKEY,ORDERS_OA.ORDERKEY)),NVL(ORDERS_SH.REFERENCEDOCUMENT,NVL(ORDERS_OV.REFERENCEDOCUMENT,ORDERS_OA.REFERENCEDOCUMENT)),NVL(CODELKUP_SH.DESCRIPTION,NVL(CODELKUP_OV.DESCRIPTION,CODELKUP_OA.DESCRIPTION)),CAST((FROM_TZ(TO_TIMESTAMP(TO_CHAR(sli940.t$date$l,'DD-MON-YYYY HH24:MI:SS'),'DD-MON-YYYY HH24:MI:SS'),'GMT') AT time zone 'America/Sao_Paulo') AS DATE),sli940.t$ccfo$l,sli940.t$opor$l,mcs940.t$dsca$l,sls400.t$idca$c,TRIM(sli941.t$item$l),tcibd001.t$dsca ,CASE WHEN sli941.t$iprt$l=0 THEN round(tdsls401.t$pric,2) ELSE round(sli941.t$pric$l,2) END,CASE WHEN sli941.t$gamt$l=0 THEN round(tdsls401.t$pric,2) ELSE round(sli941.t$gamt$l,2) END,sli940.t$itbp$l,sli940.t$ifbp$l,sli940.t$itbn$l,sli940.t$ifbn$l,nvl(tccom130.t$namc,tccom130d.t$namc),nvl(tccom130.t$dist$l,tccom130d.t$dist$l),nvl(tccom130.t$pstc,tccom130d.t$pstc),nvl(tccom130.t$dsca,tccom130d.t$dsca),nvl(tccom130.t$cste,tccom130d.t$cste),nvl(tccom130.t$telp,tccom130d.t$telp),nvl(tccom130.t$telx,tccom130d.t$telx),nvl(tccom130.t$enfs$l,tccom130d.t$enfs$l),sli940.t$fdtc$l,tcmcs966.t$dsca$l,FGET.DESC_TIPO_DOCTO,tccom130f.t$fovn$l,tcmcs060.t$dsca,Q1.CMV_UNIT,ORDERS_SH.ORDERKEY,ORDERS_OV.orderkey,ORDERS_OA.orderkey,CISLI245.T$SHPM,cisli951.t$shpm$l,CISLI245.T$SLSO,cisli951.t$slso$l " &
"    ORDER BY FILIAL,DT_EMISSAO,NF"

,

"      SELECT FILIAL.DSC_FILIAL FILIAL,sli940.t$docn$l NF,sli940.t$seri$l SERIE,NVL(ORDERS_SH.ORDERKEY,NVL(ORDERS_OV.ORDERKEY,ORDERS_OA.ORDERKEY)) PEDIDO_WMS,NVL(ORDERS_SH.REFERENCEDOCUMENT,NVL(ORDERS_OV.REFERENCEDOCUMENT,ORDERS_OA.REFERENCEDOCUMENT)) ORDEM_MOVIMENTACAO,NVL(CODELKUP_SH.DESCRIPTION,NVL(CODELKUP_OV.DESCRIPTION,CODELKUP_OA.DESCRIPTION)) DESCRICAO_PEDIDO,CAST((FROM_TZ(TO_TIMESTAMP(TO_CHAR(sli940.t$date$l,'DD-MON-YYYY HH24:MI:SS'),'DD-MON-YYYY HH24:MI:SS'),'GMT') AT time zone 'America/Sao_Paulo') AS DATE) DT_EMISSAO,sli940.t$ccfo$l CFO,sli940.t$opor$l SEQ_CFO,mcs940.t$dsca$l NOME_CFO,sls400.t$idca$c CANAL,TRIM(sli941.t$item$l) ID_ITEM,tcibd001.t$dsca NOME_ITEM,sum(sli941.t$dqua$l) QTD_FATURADA,CASE WHEN sli941.t$iprt$l=0 THEN round(tdsls401.t$pric,2) ELSE round(sli941.t$pric$l,2) END VL_PRODUTO,CASE WHEN sum(sli941.t$amnt$l)=0 THEN sum(tdsls401.t$oamt) ELSE sum(sli941.t$amnt$l) END VL_TOTAL_ITEM,CASE WHEN sli941.t$gamt$l=0 THEN round(tdsls401.t$pric,2) ELSE round(sli941.t$gamt$l,2) END VL_MERCADORIA,CASE WHEN sum(sli941.t$fght$l)=0 THEN sum(nvl(znsls401.t$vlfr$c,0)) ELSE sum(sli941.t$fght$l) END VL_FRETE,CASE WHEN sum(sli941.t$ldam$l)=0 THEN sum(nvl(znsls401.t$vlde$c,0)) ELSE sum(sli941.t$ldam$l) END VL_DESC_INC,sum(NVL((select sum(cisli943.t$amnt$l) from baandb.tcisli943602 cisli943 where cisli943.t$fire$l=sli941.t$fire$l and cisli943.t$LINE$l=sli941.t$LINE$l and cisli943.t$brty$l=1),0))VL_ICMS,sum(NVL((select sum(cisli943.t$amnt$l) from baandb.tcisli943602 cisli943 where cisli943.t$fire$l=sli941.t$fire$l and cisli943.t$line$l=sli941.t$line$l and cisli943.t$brty$l=5),0))VL_PIS,sum(NVL((select sum(cisli943.t$amnt$l) from baandb.tcisli943602 cisli943 where cisli943.t$fire$l=sli941.t$fire$l and cisli943.t$line$l=sli941.t$line$l and cisli943.t$brty$l=6),0))VL_COFINS,case when sli940.t$itbp$l=' ' then sli940.t$ifbp$l else sli940.t$itbp$l end ID_CLIENTE,case when sli940.t$itbn$l=' ' then sli940.t$ifbn$l else sli940.t$itbn$l end NOME_CLIENTE,nvl(tccom130.t$namc,tccom130d.t$namc) ENDERECO,nvl(tccom130.t$dist$l,tccom130d.t$dist$l) BAIRRO,nvl(tccom130.t$pstc,tccom130d.t$pstc) CEP,nvl(tccom130.t$dsca,tccom130d.t$dsca) MUNICIPIO,nvl(tccom130.t$cste,tccom130d.t$cste) UF,nvl(tccom130.t$telp,tccom130d.t$telp) TEL1,nvl(tccom130.t$telx,tccom130d.t$telx) TEL2,nvl(tccom130.t$enfs$l,tccom130d.t$enfs$l) EMAIL,sli940.t$fdtc$l ID_TIPO_DOC_FIS,tcmcs966.t$dsca$l DESCR_TIPO_DOC_FIS,FGET.DESC_TIPO_DOCTO DESC_TIPO_DOCTO,tccom130f.t$fovn$l CNPJ_FABRICANTE,tcmcs060.t$dsca NOME_FABRICANTE,Q1.CMV_UNIT FROM baandb.tcisli940602 sli940 INNER JOIN (select emm030.t$eunt CHAVE_FILIAL,emm030.t$dsca DSC_FILIAL,emm124.t$cwoc from baandb.ttcemm124602 emm124,baandb.ttcemm030602 emm030 where emm030.t$eunt=emm124.t$grid and emm124.t$loco=602) FILIAL ON FILIAL.t$cwoc=sli940.t$cofc$l LEFT JOIN baandb.ttcmcs940602 mcs940 ON mcs940.T$OFSO$L=sli940.t$ccfo$l INNER JOIN baandb.tcisli941602 sli941 ON sli941.t$fire$l=sli940.t$fire$l LEFT JOIN (select whwmd217.t$item,whwmd217.t$cwar,case when (max(whwmd215.t$qhnd) - max(whwmd215.t$qchd) - max(whwmd215.t$qnhd))=0 then 0 else round(sum(whwmd217.t$mauc$1) / (max(whwmd215.t$qhnd) - max(whwmd215.t$qchd) - max(whwmd215.t$qnhd)),4) end cmv_unit from baandb.twhwmd217602 whwmd217 inner join baandb.twhwmd215602 whwmd215 on whwmd215.t$cwar=whwmd217.t$cwar and whwmd215.t$item=whwmd217.t$item group by whwmd217.t$item,whwmd217.t$cwar) Q1 ON Q1.t$item=sli941.t$item$l AND Q1.t$cwar=sli941.t$cwar$l LEFT JOIN baandb.tcisli245602 cisli245 ON cisli245.t$fire$l=sli941.t$fire$l AND cisli245.t$line$l=sli941.t$line$l LEFT JOIN baandb.tcisli951602 cisli951 ON cisli951.t$fire$l=sli941.t$fire$l AND cisli951.t$line$l=sli941.t$line$l LEFT JOIN baandb.tznsls401602 znsls401 ON znsls401.t$orno$c=cisli245.t$slso AND znsls401.t$pono$c=cisli245.t$pono LEFT JOIN baandb.ttdsls401602 tdsls401 ON tdsls401.t$orno=cisli245.t$slso AND tdsls401.t$pono=cisli245.t$pono LEFT JOIN baandb.tznsls400602 sls400 ON sls400.t$ncia$c=znsls401.t$ncia$c AND sls400.t$uneg$c=znsls401.t$uneg$c AND sls400.t$pecl$c=znsls401.t$pecl$c AND sls400.t$sqpd$c=znsls401.t$sqpd$c LEFT JOIN baandb.ttccom130602 tccom130 ON tccom130.t$cadr=sli940.t$itoa$l LEFT JOIN baandb.ttccom130602 tccom130d ON tccom130d.t$cadr=sli940.t$IFBA$l INNER JOIN baandb.ttcibd001602 tcibd001 ON tcibd001.t$item=sli941.t$item$l LEFT JOIN baandb.ttcmcs060602 tcmcs060 ON tcmcs060.t$cmnf=tcibd001.t$cmnf LEFT JOIN baandb.ttccom130602 tccom130f ON tccom130f.t$cadr=tcmcs060.t$cadr LEFT JOIN baandb.ttcmcs966602 tcmcs966 ON tcmcs966.t$fdtc$l=sli940.t$fdtc$l LEFT JOIN (SELECT d.t$cnst CNST,l.t$desc DESC_TIPO_DOCTO FROM baandb.tttadv401000 d,baandb.tttadv140000 l WHERE d.t$cpac='ci' AND d.t$cdom='sli.tdff.l' AND l.t$clan='p' AND l.t$cpac='ci' AND l.t$clab=d.t$za_clab AND rpad(d.t$vers,4) || rpad(d.t$rele,2) || rpad(d.t$cust,4)=(select max(rpad(l1.t$vers,4) || rpad(l1.t$rele,2) || rpad(l1.t$cust,4)) from baandb.tttadv401000 l1 where l1.t$cpac=d.t$cpac and l1.t$cdom=d.t$cdom) AND rpad(l.t$vers,4) || rpad(l.t$rele,2) || rpad(l.t$cust,4)=(select max(rpad(l1.t$vers,4) || rpad(l1.t$rele,2) || rpad(l1.t$cust,4)) from baandb.tttadv140000 l1 where l1.t$clab=l.t$clab and l1.t$clan=l.t$clan and l1.t$cpac=l.t$cpac)) FGET ON sli940.t$fdty$l=FGET.CNST INNER JOIN WMWHSE10.ORDERS@DL_LN_WMS ORDERS_SH ON SUBSTR(ORDERS_SH.EXTERNORDERKEY,5,9)=nvl(CISLI245.T$SHPM,cisli951.t$shpm$l) LEFT JOIN (select MAX(a.ORDERKEY) ORDERKEY,MAX(a.TYPE) TYPE,a.REFERENCEDOCUMENT from WMWHSE10.ORDERS@DL_LN_WMS a group by a.REFERENCEDOCUMENT) ORDERS_OA ON SUBSTR(ORDERS_OA.REFERENCEDOCUMENT,4,9)=nvl(CISLI245.T$SLSO,cisli951.t$slso$l) LEFT JOIN (select MAX(a.ORDERKEY) ORDERKEY,MAX(a.TYPE) TYPE,a.REFERENCEDOCUMENT from WMWHSE10.ORDERS@DL_LN_WMS a group by a.REFERENCEDOCUMENT) ORDERS_OV ON ORDERS_OV.REFERENCEDOCUMENT=nvl(CISLI245.T$SLSO,cisli951.t$slso$l) LEFT JOIN WMWHSE10.CODELKUP@DL_LN_WMS CODELKUP_SH ON CODELKUP_SH.LISTNAME='ORDERTYPE' AND CODELKUP_SH.CODE=ORDERS_SH.TYPE LEFT JOIN WMWHSE10.CODELKUP@DL_LN_WMS CODELKUP_OA ON CODELKUP_OA.LISTNAME='ORDERTYPE' AND CODELKUP_OA.CODE=ORDERS_OA.TYPE LEFT JOIN WMWHSE10.CODELKUP@DL_LN_WMS CODELKUP_OV ON CODELKUP_OV.LISTNAME='ORDERTYPE' AND CODELKUP_OV.CODE=ORDERS_OV.TYPE LEFT JOIN baandb.tznsls000602 znsls000 ON znsls000.t$indt$c=TO_DATE('01-01-1970','DD-MM-YYYY') WHERE sli940.t$fdty$l NOT IN (11,14) AND sli940.t$stat$l NOT IN (2,101) AND sli940.t$docn$l !=0 AND sli941.t$item$l !=znsls000.t$itmd$c AND sli941.t$item$l !=znsls000.t$itmf$c AND sli941.t$item$l !=znsls000.t$itjl$c AND FILIAL.CHAVE_FILIAL='" + Parameters!Filial.Value + "' AND Trunc(CAST((FROM_TZ(TO_TIMESTAMP(TO_CHAR(sli940.t$date$l,'DD-MON-YYYY HH24:MI:SS'),'DD-MON-YYYY HH24:MI:SS'),'GMT') AT time zone 'America/Sao_Paulo') AS DATE)) Between '" + Parameters!EmissaoDe.Value + "' And '" + Parameters!EmissaoAte.Value + "' GROUP BY FILIAL.DSC_FILIAL,sli940.t$docn$l,sli940.t$seri$l,NVL(ORDERS_SH.ORDERKEY,NVL(ORDERS_OV.ORDERKEY,ORDERS_OA.ORDERKEY)),NVL(ORDERS_SH.REFERENCEDOCUMENT,NVL(ORDERS_OV.REFERENCEDOCUMENT,ORDERS_OA.REFERENCEDOCUMENT)),NVL(CODELKUP_SH.DESCRIPTION,NVL(CODELKUP_OV.DESCRIPTION,CODELKUP_OA.DESCRIPTION)),CAST((FROM_TZ(TO_TIMESTAMP(TO_CHAR(sli940.t$date$l,'DD-MON-YYYY HH24:MI:SS'),'DD-MON-YYYY HH24:MI:SS'),'GMT') AT time zone 'America/Sao_Paulo') AS DATE),sli940.t$ccfo$l,sli940.t$opor$l,mcs940.t$dsca$l,sls400.t$idca$c,TRIM(sli941.t$item$l),tcibd001.t$dsca ,CASE WHEN sli941.t$iprt$l=0 THEN round(tdsls401.t$pric,2) ELSE round(sli941.t$pric$l,2) END,CASE WHEN sli941.t$gamt$l=0 THEN round(tdsls401.t$pric,2) ELSE round(sli941.t$gamt$l,2) END,sli940.t$itbp$l,sli940.t$ifbp$l,sli940.t$itbn$l,sli940.t$ifbn$l,nvl(tccom130.t$namc,tccom130d.t$namc),nvl(tccom130.t$dist$l,tccom130d.t$dist$l),nvl(tccom130.t$pstc,tccom130d.t$pstc),nvl(tccom130.t$dsca,tccom130d.t$dsca),nvl(tccom130.t$cste,tccom130d.t$cste),nvl(tccom130.t$telp,tccom130d.t$telp),nvl(tccom130.t$telx,tccom130d.t$telx),nvl(tccom130.t$enfs$l,tccom130d.t$enfs$l),sli940.t$fdtc$l,tcmcs966.t$dsca$l,FGET.DESC_TIPO_DOCTO,tccom130f.t$fovn$l,tcmcs060.t$dsca,Q1.CMV_UNIT,ORDERS_SH.ORDERKEY,ORDERS_OV.orderkey,ORDERS_OA.orderkey,CISLI245.T$SHPM,cisli951.t$shpm$l,CISLI245.T$SLSO,cisli951.t$slso$l " &
"    ORDER BY FILIAL,DT_EMISSAO,NF"

)
